<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"><title>lj_dispatch.c source code [luajit/lj_dispatch.c] - Woboq Code Browser</title>
<link rel="stylesheet" href=".././data/qtcreator.css" title="QtCreator"/>
<link rel="alternate stylesheet" href=".././data/kdevelop.css" title="KDevelop"/>
<script type="text/javascript" src=".././data/jquery/jquery.min.js"></script>
<script type="text/javascript" src=".././data/jquery/jquery-ui.min.js"></script>
<script>var file = 'luajit/lj_dispatch.c'; var root_path = '..'; var data_path = '.././data'; var ecma_script_api_version = 2;</script>
<script src='.././data/codebrowser.js'></script>
</head>
<body><div id='header'><h1 id='breadcrumb'><span>Browse the source code of </span><a href='./'>luajit</a>/<a href='lj_dispatch.c.html'>lj_dispatch.c</a></h1></div>
<hr/><div id='content'><table class="code">
<tr><th id="1">1</th><td><i>/*</i></td></tr>
<tr><th id="2">2</th><td><i>** Instruction dispatch handling.</i></td></tr>
<tr><th id="3">3</th><td><i>** Copyright (C) 2005-2021 Mike Pall. See Copyright Notice in luajit.h</i></td></tr>
<tr><th id="4">4</th><td><i>*/</i></td></tr>
<tr><th id="5">5</th><td></td></tr>
<tr><th id="6">6</th><td><u>#define <dfn class="macro" id="_M/lj_dispatch_c" data-ref="_M/lj_dispatch_c">lj_dispatch_c</dfn></u></td></tr>
<tr><th id="7">7</th><td><u>#define <dfn class="macro" id="_M/LUA_CORE" data-ref="_M/LUA_CORE">LUA_CORE</dfn></u></td></tr>
<tr><th id="8">8</th><td></td></tr>
<tr><th id="9">9</th><td><u>#include <a href="lj_obj.h.html">"lj_obj.h"</a></u></td></tr>
<tr><th id="10">10</th><td><u>#include <a href="lj_err.h.html">"lj_err.h"</a></u></td></tr>
<tr><th id="11">11</th><td><u>#include <a href="lj_buf.h.html">"lj_buf.h"</a></u></td></tr>
<tr><th id="12">12</th><td><u>#include <a href="lj_func.h.html">"lj_func.h"</a></u></td></tr>
<tr><th id="13">13</th><td><u>#include <a href="lj_str.h.html">"lj_str.h"</a></u></td></tr>
<tr><th id="14">14</th><td><u>#include <a href="lj_tab.h.html">"lj_tab.h"</a></u></td></tr>
<tr><th id="15">15</th><td><u>#include <a href="lj_meta.h.html">"lj_meta.h"</a></u></td></tr>
<tr><th id="16">16</th><td><u>#include <a href="lj_debug.h.html">"lj_debug.h"</a></u></td></tr>
<tr><th id="17">17</th><td><u>#include <a href="lj_state.h.html">"lj_state.h"</a></u></td></tr>
<tr><th id="18">18</th><td><u>#include <a href="lj_frame.h.html">"lj_frame.h"</a></u></td></tr>
<tr><th id="19">19</th><td><u>#include <a href="lj_bc.h.html">"lj_bc.h"</a></u></td></tr>
<tr><th id="20">20</th><td><u>#include <a href="lj_ff.h.html">"lj_ff.h"</a></u></td></tr>
<tr><th id="21">21</th><td><u>#include <a href="lj_strfmt.h.html">"lj_strfmt.h"</a></u></td></tr>
<tr><th id="22">22</th><td><u>#<span data-ppcond="22">if</span> <a class="macro" href="lj_arch.h.html#542" title="1" data-ref="_M/LJ_HASJIT">LJ_HASJIT</a></u></td></tr>
<tr><th id="23">23</th><td><u>#include <a href="lj_jit.h.html">"lj_jit.h"</a></u></td></tr>
<tr><th id="24">24</th><td><u>#<span data-ppcond="22">endif</span></u></td></tr>
<tr><th id="25">25</th><td><u>#<span data-ppcond="25">if</span> <a class="macro" href="lj_arch.h.html#549" title="1" data-ref="_M/LJ_HASFFI">LJ_HASFFI</a></u></td></tr>
<tr><th id="26">26</th><td><u>#include <a href="lj_ccallback.h.html">"lj_ccallback.h"</a></u></td></tr>
<tr><th id="27">27</th><td><u>#<span data-ppcond="25">endif</span></u></td></tr>
<tr><th id="28">28</th><td><u>#include <a href="lj_trace.h.html">"lj_trace.h"</a></u></td></tr>
<tr><th id="29">29</th><td><u>#include <a href="lj_dispatch.h.html">"lj_dispatch.h"</a></u></td></tr>
<tr><th id="30">30</th><td><u>#<span data-ppcond="30">if</span> <a class="macro" href="lj_arch.h.html#562" title="1" data-ref="_M/LJ_HASPROFILE">LJ_HASPROFILE</a></u></td></tr>
<tr><th id="31">31</th><td><u>#include <a href="lj_profile.h.html">"lj_profile.h"</a></u></td></tr>
<tr><th id="32">32</th><td><u>#<span data-ppcond="30">endif</span></u></td></tr>
<tr><th id="33">33</th><td><u>#include <a href="lj_vm.h.html">"lj_vm.h"</a></u></td></tr>
<tr><th id="34">34</th><td><u>#include <a href="luajit.h.html">"luajit.h"</a></u></td></tr>
<tr><th id="35">35</th><td></td></tr>
<tr><th id="36">36</th><td><i>/* Bump GG_NUM_ASMFF in lj_dispatch.h as needed. Ugly. */</i></td></tr>
<tr><th id="37">37</th><td><a class="macro" href="lj_def.h.html#369" title="extern void lj_assert_46(int STATIC_ASSERTION_FAILED[(57 == 57)?1:-1])" data-ref="_M/LJ_STATIC_ASSERT">LJ_STATIC_ASSERT</a>(<a class="macro" href="lj_dispatch.h.html#82" title="57" data-ref="_M/GG_NUM_ASMFF">GG_NUM_ASMFF</a> == <a class="macro" href="lj_ffdef.h.html#228" title="57" data-ref="_M/FF_NUM_ASMFUNC">FF_NUM_ASMFUNC</a>);</td></tr>
<tr><th id="38">38</th><td></td></tr>
<tr><th id="39">39</th><td><i>/* -- Dispatch table management ------------------------------------------- */</i></td></tr>
<tr><th id="40">40</th><td></td></tr>
<tr><th id="41">41</th><td><u>#<span data-ppcond="41">if</span> LJ_TARGET_MIPS</u></td></tr>
<tr><th id="42">42</th><td><u>#include &lt;math.h&gt;</u></td></tr>
<tr><th id="43">43</th><td>LJ_FUNCA_NORET <em>void</em> LJ_FASTCALL lj_ffh_coroutine_wrap_err(lua_State *L,</td></tr>
<tr><th id="44">44</th><td>							  lua_State *co);</td></tr>
<tr><th id="45">45</th><td><u>#if !LJ_HASJIT</u></td></tr>
<tr><th id="46">46</th><td><u>#define lj_dispatch_stitch	lj_dispatch_ins</u></td></tr>
<tr><th id="47">47</th><td><u>#endif</u></td></tr>
<tr><th id="48">48</th><td><u>#if !LJ_HASPROFILE</u></td></tr>
<tr><th id="49">49</th><td><u>#define lj_dispatch_profile	lj_dispatch_ins</u></td></tr>
<tr><th id="50">50</th><td><u>#endif</u></td></tr>
<tr><th id="51">51</th><td></td></tr>
<tr><th id="52">52</th><td><u>#define GOTFUNC(name)	(ASMFunction)name,</u></td></tr>
<tr><th id="53">53</th><td><em>static</em> <em>const</em> ASMFunction dispatch_got[] = {</td></tr>
<tr><th id="54">54</th><td>  GOTDEF(GOTFUNC)</td></tr>
<tr><th id="55">55</th><td>};</td></tr>
<tr><th id="56">56</th><td><u>#undef GOTFUNC</u></td></tr>
<tr><th id="57">57</th><td><u>#<span data-ppcond="41">endif</span></u></td></tr>
<tr><th id="58">58</th><td></td></tr>
<tr><th id="59">59</th><td><i>/* Initialize instruction dispatch table and hot counters. */</i></td></tr>
<tr><th id="60">60</th><td><em>void</em> <dfn class="decl def fn" id="lj_dispatch_init" title='lj_dispatch_init' data-ref="lj_dispatch_init" data-ref-filename="lj_dispatch_init">lj_dispatch_init</dfn>(<a class="typedef" href="lj_dispatch.h.html#GG_State" title='GG_State' data-type='struct GG_State' data-ref="GG_State" data-ref-filename="GG_State">GG_State</a> *<dfn class="local col2 decl" id="2GG" title='GG' data-type='GG_State *' data-ref="2GG" data-ref-filename="2GG">GG</dfn>)</td></tr>
<tr><th id="61">61</th><td>{</td></tr>
<tr><th id="62">62</th><td>  <a class="typedef" href="../include/x86_64-linux-gnu/bits/stdint-uintn.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col3 decl" id="3i" title='i' data-type='uint32_t' data-ref="3i" data-ref-filename="3i">i</dfn>;</td></tr>
<tr><th id="63">63</th><td>  <a class="typedef" href="lj_obj.h.html#ASMFunction" title='ASMFunction' data-type='void (*)(void)' data-ref="ASMFunction" data-ref-filename="ASMFunction">ASMFunction</a> *<dfn class="local col4 decl" id="4disp" title='disp' data-type='ASMFunction *' data-ref="4disp" data-ref-filename="4disp">disp</dfn> = <a class="local col2 ref" href="#2GG" title='GG' data-ref="2GG" data-ref-filename="2GG">GG</a>-&gt;<a class="ref field" href="lj_dispatch.h.html#GG_State::dispatch" title='GG_State::dispatch' data-ref="GG_State::dispatch" data-ref-filename="GG_State..dispatch">dispatch</a>;</td></tr>
<tr><th id="64">64</th><td>  <b>for</b> (<a class="local col3 ref" href="#3i" title='i' data-ref="3i" data-ref-filename="3i">i</a> = <var>0</var>; <a class="local col3 ref" href="#3i" title='i' data-ref="3i" data-ref-filename="3i">i</a> &lt; <a class="macro" href="lj_dispatch.h.html#85" title="BC_FUNCF" data-ref="_M/GG_LEN_SDISP">GG_LEN_SDISP</a>; <a class="local col3 ref" href="#3i" title='i' data-ref="3i" data-ref-filename="3i">i</a>++)</td></tr>
<tr><th id="65">65</th><td>    <a class="local col4 ref" href="#4disp" title='disp' data-ref="4disp" data-ref-filename="4disp">disp</a>[<a class="macro" href="lj_dispatch.h.html#84" title="(BC__MAX + 57)" data-ref="_M/GG_LEN_DDISP">GG_LEN_DDISP</a>+<a class="local col3 ref" href="#3i" title='i' data-ref="3i" data-ref-filename="3i">i</a>] = <a class="local col4 ref" href="#4disp" title='disp' data-ref="4disp" data-ref-filename="4disp">disp</a>[<a class="local col3 ref" href="#3i" title='i' data-ref="3i" data-ref-filename="3i">i</a>] = <a class="macro" href="lj_vm.h.html#116" title="((ASMFunction)(lj_vm_asm_begin + (lj_bc_ofs[i])))" data-ref="_M/makeasmfunc">makeasmfunc</a>(<a class="ref" href="lj_bc.h.html#lj_bc_ofs" title='lj_bc_ofs' data-ref="lj_bc_ofs" data-ref-filename="lj_bc_ofs">lj_bc_ofs</a>[<a class="local col3 ref" href="#3i" title='i' data-ref="3i" data-ref-filename="3i">i</a>]);</td></tr>
<tr><th id="66">66</th><td>  <b>for</b> (<a class="local col3 ref" href="#3i" title='i' data-ref="3i" data-ref-filename="3i">i</a> = <a class="macro" href="lj_dispatch.h.html#85" title="BC_FUNCF" data-ref="_M/GG_LEN_SDISP">GG_LEN_SDISP</a>; <a class="local col3 ref" href="#3i" title='i' data-ref="3i" data-ref-filename="3i">i</a> &lt; <a class="macro" href="lj_dispatch.h.html#84" title="(BC__MAX + 57)" data-ref="_M/GG_LEN_DDISP">GG_LEN_DDISP</a>; <a class="local col3 ref" href="#3i" title='i' data-ref="3i" data-ref-filename="3i">i</a>++)</td></tr>
<tr><th id="67">67</th><td>    <a class="local col4 ref" href="#4disp" title='disp' data-ref="4disp" data-ref-filename="4disp">disp</a>[<a class="local col3 ref" href="#3i" title='i' data-ref="3i" data-ref-filename="3i">i</a>] = <a class="macro" href="lj_vm.h.html#116" title="((ASMFunction)(lj_vm_asm_begin + (lj_bc_ofs[i])))" data-ref="_M/makeasmfunc">makeasmfunc</a>(<a class="ref" href="lj_bc.h.html#lj_bc_ofs" title='lj_bc_ofs' data-ref="lj_bc_ofs" data-ref-filename="lj_bc_ofs">lj_bc_ofs</a>[<a class="local col3 ref" href="#3i" title='i' data-ref="3i" data-ref-filename="3i">i</a>]);</td></tr>
<tr><th id="68">68</th><td>  <i>/* The JIT engine is off by default. luaopen_jit() turns it on. */</i></td></tr>
<tr><th id="69">69</th><td>  <a class="local col4 ref" href="#4disp" title='disp' data-ref="4disp" data-ref-filename="4disp">disp</a>[<a class="enum" href="lj_bc.h.html#202" title='BC_FORL' data-ref="BC_FORL" data-ref-filename="BC_FORL">BC_FORL</a>] = <a class="local col4 ref" href="#4disp" title='disp' data-ref="4disp" data-ref-filename="4disp">disp</a>[<a class="enum" href="lj_bc.h.html#202" title='BC_IFORL' data-ref="BC_IFORL" data-ref-filename="BC_IFORL">BC_IFORL</a>];</td></tr>
<tr><th id="70">70</th><td>  <a class="local col4 ref" href="#4disp" title='disp' data-ref="4disp" data-ref-filename="4disp">disp</a>[<a class="enum" href="lj_bc.h.html#202" title='BC_ITERL' data-ref="BC_ITERL" data-ref-filename="BC_ITERL">BC_ITERL</a>] = <a class="local col4 ref" href="#4disp" title='disp' data-ref="4disp" data-ref-filename="4disp">disp</a>[<a class="enum" href="lj_bc.h.html#202" title='BC_IITERL' data-ref="BC_IITERL" data-ref-filename="BC_IITERL">BC_IITERL</a>];</td></tr>
<tr><th id="71">71</th><td>  <a class="local col4 ref" href="#4disp" title='disp' data-ref="4disp" data-ref-filename="4disp">disp</a>[<a class="enum" href="lj_bc.h.html#202" title='BC_LOOP' data-ref="BC_LOOP" data-ref-filename="BC_LOOP">BC_LOOP</a>] = <a class="local col4 ref" href="#4disp" title='disp' data-ref="4disp" data-ref-filename="4disp">disp</a>[<a class="enum" href="lj_bc.h.html#202" title='BC_ILOOP' data-ref="BC_ILOOP" data-ref-filename="BC_ILOOP">BC_ILOOP</a>];</td></tr>
<tr><th id="72">72</th><td>  <a class="local col4 ref" href="#4disp" title='disp' data-ref="4disp" data-ref-filename="4disp">disp</a>[<a class="enum" href="lj_bc.h.html#202" title='BC_FUNCF' data-ref="BC_FUNCF" data-ref-filename="BC_FUNCF">BC_FUNCF</a>] = <a class="local col4 ref" href="#4disp" title='disp' data-ref="4disp" data-ref-filename="4disp">disp</a>[<a class="enum" href="lj_bc.h.html#202" title='BC_IFUNCF' data-ref="BC_IFUNCF" data-ref-filename="BC_IFUNCF">BC_IFUNCF</a>];</td></tr>
<tr><th id="73">73</th><td>  <a class="local col4 ref" href="#4disp" title='disp' data-ref="4disp" data-ref-filename="4disp">disp</a>[<a class="enum" href="lj_bc.h.html#202" title='BC_FUNCV' data-ref="BC_FUNCV" data-ref-filename="BC_FUNCV">BC_FUNCV</a>] = <a class="local col4 ref" href="#4disp" title='disp' data-ref="4disp" data-ref-filename="4disp">disp</a>[<a class="enum" href="lj_bc.h.html#202" title='BC_IFUNCV' data-ref="BC_IFUNCV" data-ref-filename="BC_IFUNCV">BC_IFUNCV</a>];</td></tr>
<tr><th id="74">74</th><td>  <a class="local col2 ref" href="#2GG" title='GG' data-ref="2GG" data-ref-filename="2GG">GG</a>-&gt;<a class="ref field" href="lj_dispatch.h.html#GG_State::g" title='GG_State::g' data-ref="GG_State::g" data-ref-filename="GG_State..g">g</a>.<a class="ref field" href="lj_obj.h.html#global_State::bc_cfunc_ext" title='global_State::bc_cfunc_ext' data-ref="global_State::bc_cfunc_ext" data-ref-filename="global_State..bc_cfunc_ext">bc_cfunc_ext</a> = <a class="local col2 ref" href="#2GG" title='GG' data-ref="2GG" data-ref-filename="2GG">GG</a>-&gt;<a class="ref field" href="lj_dispatch.h.html#GG_State::g" title='GG_State::g' data-ref="GG_State::g" data-ref-filename="GG_State..g">g</a>.<a class="ref field" href="lj_obj.h.html#global_State::bc_cfunc_int" title='global_State::bc_cfunc_int' data-ref="global_State::bc_cfunc_int" data-ref-filename="global_State..bc_cfunc_int">bc_cfunc_int</a> = <a class="macro" href="lj_bc.h.html#55" title="(((BCIns)(BC_FUNCC))|((BCIns)(20)&lt;&lt;8)|((BCIns)(0)&lt;&lt;16))" data-ref="_M/BCINS_AD">BCINS_AD</a>(<a class="enum" href="lj_bc.h.html#202" title='BC_FUNCC' data-ref="BC_FUNCC" data-ref-filename="BC_FUNCC">BC_FUNCC</a>, <a class="macro" href="lua.h.html#88" title="20" data-ref="_M/LUA_MINSTACK">LUA_MINSTACK</a>, <var>0</var>);</td></tr>
<tr><th id="75">75</th><td>  <b>for</b> (<a class="local col3 ref" href="#3i" title='i' data-ref="3i" data-ref-filename="3i">i</a> = <var>0</var>; <a class="local col3 ref" href="#3i" title='i' data-ref="3i" data-ref-filename="3i">i</a> &lt; <a class="macro" href="lj_dispatch.h.html#82" title="57" data-ref="_M/GG_NUM_ASMFF">GG_NUM_ASMFF</a>; <a class="local col3 ref" href="#3i" title='i' data-ref="3i" data-ref-filename="3i">i</a>++)</td></tr>
<tr><th id="76">76</th><td>    <a class="local col2 ref" href="#2GG" title='GG' data-ref="2GG" data-ref-filename="2GG">GG</a>-&gt;<a class="ref field" href="lj_dispatch.h.html#GG_State::bcff" title='GG_State::bcff' data-ref="GG_State::bcff" data-ref-filename="GG_State..bcff">bcff</a>[<a class="local col3 ref" href="#3i" title='i' data-ref="3i" data-ref-filename="3i">i</a>] = <a class="macro" href="lj_bc.h.html#55" title="(((BCIns)(BC__MAX+i))|((BCIns)(0)&lt;&lt;8)|((BCIns)(0)&lt;&lt;16))" data-ref="_M/BCINS_AD">BCINS_AD</a>(<a class="enum" href="lj_bc.h.html#BC__MAX" title='BC__MAX' data-ref="BC__MAX" data-ref-filename="BC__MAX">BC__MAX</a>+<a class="local col3 ref" href="#3i" title='i' data-ref="3i" data-ref-filename="3i">i</a>, <var>0</var>, <var>0</var>);</td></tr>
<tr><th id="77">77</th><td><u>#<span data-ppcond="77">if</span> LJ_TARGET_MIPS</u></td></tr>
<tr><th id="78">78</th><td>  memcpy(GG-&gt;got, dispatch_got, LJ_GOT__MAX*<b>sizeof</b>(ASMFunction *));</td></tr>
<tr><th id="79">79</th><td><u>#<span data-ppcond="77">endif</span></u></td></tr>
<tr><th id="80">80</th><td>}</td></tr>
<tr><th id="81">81</th><td></td></tr>
<tr><th id="82">82</th><td><u>#<span data-ppcond="82">if</span> <a class="macro" href="lj_arch.h.html#542" title="1" data-ref="_M/LJ_HASJIT">LJ_HASJIT</a></u></td></tr>
<tr><th id="83">83</th><td><i>/* Initialize hotcount table. */</i></td></tr>
<tr><th id="84">84</th><td><em>void</em> <dfn class="decl def fn" id="lj_dispatch_init_hotcount" title='lj_dispatch_init_hotcount' data-ref="lj_dispatch_init_hotcount" data-ref-filename="lj_dispatch_init_hotcount">lj_dispatch_init_hotcount</dfn>(<a class="typedef" href="lj_obj.h.html#global_State" title='global_State' data-type='struct global_State' data-ref="global_State" data-ref-filename="global_State">global_State</a> *<dfn class="local col5 decl" id="5g" title='g' data-type='global_State *' data-ref="5g" data-ref-filename="5g">g</dfn>)</td></tr>
<tr><th id="85">85</th><td>{</td></tr>
<tr><th id="86">86</th><td>  <a class="typedef" href="../include/x86_64-linux-gnu/bits/stdint-intn.h.html#int32_t" title='int32_t' data-type='__int32_t' data-ref="int32_t" data-ref-filename="int32_t">int32_t</a> <dfn class="local col6 decl" id="6hotloop" title='hotloop' data-type='int32_t' data-ref="6hotloop" data-ref-filename="6hotloop">hotloop</dfn> = <a class="macro" href="lj_dispatch.h.html#116" title="(&amp;((GG_State *)((char *)(g) - ((int)__builtin_offsetof(GG_State, g))))-&gt;J)" data-ref="_M/G2J">G2J</a>(<a class="local col5 ref" href="#5g" title='g' data-ref="5g" data-ref-filename="5g">g</a>)-&gt;<a class="ref field" href="lj_jit.h.html#jit_State::param" title='jit_State::param' data-ref="jit_State::param" data-ref-filename="jit_State..param">param</a>[<a class="enum" href="lj_jit.h.html#138" title='JIT_P_hotloop' data-ref="JIT_P_hotloop" data-ref-filename="JIT_P_hotloop">JIT_P_hotloop</a>];</td></tr>
<tr><th id="87">87</th><td>  <a class="typedef" href="lj_dispatch.h.html#HotCount" title='HotCount' data-type='uint16_t' data-ref="HotCount" data-ref-filename="HotCount">HotCount</a> <dfn class="local col7 decl" id="7start" title='start' data-type='HotCount' data-ref="7start" data-ref-filename="7start">start</dfn> = (<a class="typedef" href="lj_dispatch.h.html#HotCount" title='HotCount' data-type='uint16_t' data-ref="HotCount" data-ref-filename="HotCount">HotCount</a>)(<a class="local col6 ref" href="#6hotloop" title='hotloop' data-ref="6hotloop" data-ref-filename="6hotloop">hotloop</a>*<a class="macro" href="lj_dispatch.h.html#78" title="2" data-ref="_M/HOTCOUNT_LOOP">HOTCOUNT_LOOP</a> - <var>1</var>);</td></tr>
<tr><th id="88">88</th><td>  <a class="typedef" href="lj_dispatch.h.html#HotCount" title='HotCount' data-type='uint16_t' data-ref="HotCount" data-ref-filename="HotCount">HotCount</a> *<dfn class="local col8 decl" id="8hotcount" title='hotcount' data-type='HotCount *' data-ref="8hotcount" data-ref-filename="8hotcount">hotcount</dfn> = <a class="macro" href="lj_dispatch.h.html#112" title="((GG_State *)((char *)(g) - ((int)__builtin_offsetof(GG_State, g))))" data-ref="_M/G2GG">G2GG</a>(<a class="local col5 ref" href="#5g" title='g' data-ref="5g" data-ref-filename="5g">g</a>)-&gt;<a class="ref field" href="lj_dispatch.h.html#GG_State::hotcount" title='GG_State::hotcount' data-ref="GG_State::hotcount" data-ref-filename="GG_State..hotcount">hotcount</a>;</td></tr>
<tr><th id="89">89</th><td>  <a class="typedef" href="../include/x86_64-linux-gnu/bits/stdint-uintn.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col9 decl" id="9i" title='i' data-type='uint32_t' data-ref="9i" data-ref-filename="9i">i</dfn>;</td></tr>
<tr><th id="90">90</th><td>  <b>for</b> (<a class="local col9 ref" href="#9i" title='i' data-ref="9i" data-ref-filename="9i">i</a> = <var>0</var>; <a class="local col9 ref" href="#9i" title='i' data-ref="9i" data-ref-filename="9i">i</a> &lt; <a class="macro" href="lj_dispatch.h.html#74" title="64" data-ref="_M/HOTCOUNT_SIZE">HOTCOUNT_SIZE</a>; <a class="local col9 ref" href="#9i" title='i' data-ref="9i" data-ref-filename="9i">i</a>++)</td></tr>
<tr><th id="91">91</th><td>    <a class="local col8 ref" href="#8hotcount" title='hotcount' data-ref="8hotcount" data-ref-filename="8hotcount">hotcount</a>[<a class="local col9 ref" href="#9i" title='i' data-ref="9i" data-ref-filename="9i">i</a>] = <a class="local col7 ref" href="#7start" title='start' data-ref="7start" data-ref-filename="7start">start</a>;</td></tr>
<tr><th id="92">92</th><td>}</td></tr>
<tr><th id="93">93</th><td><u>#<span data-ppcond="82">endif</span></u></td></tr>
<tr><th id="94">94</th><td></td></tr>
<tr><th id="95">95</th><td><i>/* Internal dispatch mode bits. */</i></td></tr>
<tr><th id="96">96</th><td><u>#define <dfn class="macro" id="_M/DISPMODE_CALL" data-ref="_M/DISPMODE_CALL">DISPMODE_CALL</dfn>	0x01	/* Override call dispatch. */</u></td></tr>
<tr><th id="97">97</th><td><u>#define <dfn class="macro" id="_M/DISPMODE_RET" data-ref="_M/DISPMODE_RET">DISPMODE_RET</dfn>	0x02	/* Override return dispatch. */</u></td></tr>
<tr><th id="98">98</th><td><u>#define <dfn class="macro" id="_M/DISPMODE_INS" data-ref="_M/DISPMODE_INS">DISPMODE_INS</dfn>	0x04	/* Override instruction dispatch. */</u></td></tr>
<tr><th id="99">99</th><td><u>#define <dfn class="macro" id="_M/DISPMODE_JIT" data-ref="_M/DISPMODE_JIT">DISPMODE_JIT</dfn>	0x10	/* JIT compiler on. */</u></td></tr>
<tr><th id="100">100</th><td><u>#define <dfn class="macro" id="_M/DISPMODE_REC" data-ref="_M/DISPMODE_REC">DISPMODE_REC</dfn>	0x20	/* Recording active. */</u></td></tr>
<tr><th id="101">101</th><td><u>#define <dfn class="macro" id="_M/DISPMODE_PROF" data-ref="_M/DISPMODE_PROF">DISPMODE_PROF</dfn>	0x40	/* Profiling active. */</u></td></tr>
<tr><th id="102">102</th><td></td></tr>
<tr><th id="103">103</th><td><i>/* Update dispatch table depending on various flags. */</i></td></tr>
<tr><th id="104">104</th><td><em>void</em> <dfn class="decl def fn" id="lj_dispatch_update" title='lj_dispatch_update' data-ref="lj_dispatch_update" data-ref-filename="lj_dispatch_update">lj_dispatch_update</dfn>(<a class="typedef" href="lj_obj.h.html#global_State" title='global_State' data-type='struct global_State' data-ref="global_State" data-ref-filename="global_State">global_State</a> *<dfn class="local col0 decl" id="10g" title='g' data-type='global_State *' data-ref="10g" data-ref-filename="10g">g</dfn>)</td></tr>
<tr><th id="105">105</th><td>{</td></tr>
<tr><th id="106">106</th><td>  <a class="typedef" href="../include/x86_64-linux-gnu/bits/stdint-uintn.h.html#uint8_t" title='uint8_t' data-type='__uint8_t' data-ref="uint8_t" data-ref-filename="uint8_t">uint8_t</a> <dfn class="local col1 decl" id="11oldmode" title='oldmode' data-type='uint8_t' data-ref="11oldmode" data-ref-filename="11oldmode">oldmode</dfn> = <a class="local col0 ref" href="#10g" title='g' data-ref="10g" data-ref-filename="10g">g</a>-&gt;<a class="ref field" href="lj_obj.h.html#global_State::dispatchmode" title='global_State::dispatchmode' data-ref="global_State::dispatchmode" data-ref-filename="global_State..dispatchmode">dispatchmode</a>;</td></tr>
<tr><th id="107">107</th><td>  <a class="typedef" href="../include/x86_64-linux-gnu/bits/stdint-uintn.h.html#uint8_t" title='uint8_t' data-type='__uint8_t' data-ref="uint8_t" data-ref-filename="uint8_t">uint8_t</a> <dfn class="local col2 decl" id="12mode" title='mode' data-type='uint8_t' data-ref="12mode" data-ref-filename="12mode">mode</dfn> = <var>0</var>;</td></tr>
<tr><th id="108">108</th><td><u>#<span data-ppcond="108">if</span> <a class="macro" href="lj_arch.h.html#542" title="1" data-ref="_M/LJ_HASJIT">LJ_HASJIT</a></u></td></tr>
<tr><th id="109">109</th><td>  <a class="local col2 ref" href="#12mode" title='mode' data-ref="12mode" data-ref-filename="12mode">mode</a> |= (<a class="macro" href="lj_dispatch.h.html#116" title="(&amp;((GG_State *)((char *)(g) - ((int)__builtin_offsetof(GG_State, g))))-&gt;J)" data-ref="_M/G2J">G2J</a>(<a class="local col0 ref" href="#10g" title='g' data-ref="10g" data-ref-filename="10g">g</a>)-&gt;<a class="ref field" href="lj_jit.h.html#jit_State::flags" title='jit_State::flags' data-ref="jit_State::flags" data-ref-filename="jit_State..flags">flags</a> &amp; <a class="macro" href="lj_jit.h.html#15" title="0x00000001" data-ref="_M/JIT_F_ON">JIT_F_ON</a>) ? <a class="macro" href="#99" title="0x10" data-ref="_M/DISPMODE_JIT">DISPMODE_JIT</a> : <var>0</var>;</td></tr>
<tr><th id="110">110</th><td>  <a class="local col2 ref" href="#12mode" title='mode' data-ref="12mode" data-ref-filename="12mode">mode</a> |= <a class="macro" href="lj_dispatch.h.html#116" title="(&amp;((GG_State *)((char *)(g) - ((int)__builtin_offsetof(GG_State, g))))-&gt;J)" data-ref="_M/G2J">G2J</a>(<a class="local col0 ref" href="#10g" title='g' data-ref="10g" data-ref-filename="10g">g</a>)-&gt;<a class="ref field" href="lj_jit.h.html#jit_State::state" title='jit_State::state' data-ref="jit_State::state" data-ref-filename="jit_State..state">state</a> != <a class="enum" href="lj_jit.h.html#LJ_TRACE_IDLE" title='LJ_TRACE_IDLE' data-ref="LJ_TRACE_IDLE" data-ref-filename="LJ_TRACE_IDLE">LJ_TRACE_IDLE</a> ?</td></tr>
<tr><th id="111">111</th><td>	    (<a class="macro" href="#100" title="0x20" data-ref="_M/DISPMODE_REC">DISPMODE_REC</a>|<a class="macro" href="#98" title="0x04" data-ref="_M/DISPMODE_INS">DISPMODE_INS</a>|<a class="macro" href="#96" title="0x01" data-ref="_M/DISPMODE_CALL">DISPMODE_CALL</a>) : <var>0</var>;</td></tr>
<tr><th id="112">112</th><td><u>#<span data-ppcond="108">endif</span></u></td></tr>
<tr><th id="113">113</th><td><u>#<span data-ppcond="113">if</span> <a class="macro" href="lj_arch.h.html#562" title="1" data-ref="_M/LJ_HASPROFILE">LJ_HASPROFILE</a></u></td></tr>
<tr><th id="114">114</th><td>  <a class="local col2 ref" href="#12mode" title='mode' data-ref="12mode" data-ref-filename="12mode">mode</a> |= (<a class="local col0 ref" href="#10g" title='g' data-ref="10g" data-ref-filename="10g">g</a>-&gt;<a class="ref field" href="lj_obj.h.html#global_State::hookmask" title='global_State::hookmask' data-ref="global_State::hookmask" data-ref-filename="global_State..hookmask">hookmask</a> &amp; <a class="macro" href="lj_obj.h.html#671" title="0x80" data-ref="_M/HOOK_PROFILE">HOOK_PROFILE</a>) ? (<a class="macro" href="#101" title="0x40" data-ref="_M/DISPMODE_PROF">DISPMODE_PROF</a>|<a class="macro" href="#98" title="0x04" data-ref="_M/DISPMODE_INS">DISPMODE_INS</a>) : <var>0</var>;</td></tr>
<tr><th id="115">115</th><td><u>#<span data-ppcond="113">endif</span></u></td></tr>
<tr><th id="116">116</th><td>  <a class="local col2 ref" href="#12mode" title='mode' data-ref="12mode" data-ref-filename="12mode">mode</a> |= (<a class="local col0 ref" href="#10g" title='g' data-ref="10g" data-ref-filename="10g">g</a>-&gt;<a class="ref field" href="lj_obj.h.html#global_State::hookmask" title='global_State::hookmask' data-ref="global_State::hookmask" data-ref-filename="global_State..hookmask">hookmask</a> &amp; (<a class="macro" href="lua.h.html#325" title="(1 &lt;&lt; 2)" data-ref="_M/LUA_MASKLINE">LUA_MASKLINE</a>|<a class="macro" href="lua.h.html#326" title="(1 &lt;&lt; 3)" data-ref="_M/LUA_MASKCOUNT">LUA_MASKCOUNT</a>)) ? <a class="macro" href="#98" title="0x04" data-ref="_M/DISPMODE_INS">DISPMODE_INS</a> : <var>0</var>;</td></tr>
<tr><th id="117">117</th><td>  <a class="local col2 ref" href="#12mode" title='mode' data-ref="12mode" data-ref-filename="12mode">mode</a> |= (<a class="local col0 ref" href="#10g" title='g' data-ref="10g" data-ref-filename="10g">g</a>-&gt;<a class="ref field" href="lj_obj.h.html#global_State::hookmask" title='global_State::hookmask' data-ref="global_State::hookmask" data-ref-filename="global_State..hookmask">hookmask</a> &amp; <a class="macro" href="lua.h.html#323" title="(1 &lt;&lt; 0)" data-ref="_M/LUA_MASKCALL">LUA_MASKCALL</a>) ? <a class="macro" href="#96" title="0x01" data-ref="_M/DISPMODE_CALL">DISPMODE_CALL</a> : <var>0</var>;</td></tr>
<tr><th id="118">118</th><td>  <a class="local col2 ref" href="#12mode" title='mode' data-ref="12mode" data-ref-filename="12mode">mode</a> |= (<a class="local col0 ref" href="#10g" title='g' data-ref="10g" data-ref-filename="10g">g</a>-&gt;<a class="ref field" href="lj_obj.h.html#global_State::hookmask" title='global_State::hookmask' data-ref="global_State::hookmask" data-ref-filename="global_State..hookmask">hookmask</a> &amp; <a class="macro" href="lua.h.html#324" title="(1 &lt;&lt; 1)" data-ref="_M/LUA_MASKRET">LUA_MASKRET</a>) ? <a class="macro" href="#97" title="0x02" data-ref="_M/DISPMODE_RET">DISPMODE_RET</a> : <var>0</var>;</td></tr>
<tr><th id="119">119</th><td>  <b>if</b> (<a class="local col1 ref" href="#11oldmode" title='oldmode' data-ref="11oldmode" data-ref-filename="11oldmode">oldmode</a> != <a class="local col2 ref" href="#12mode" title='mode' data-ref="12mode" data-ref-filename="12mode">mode</a>) {  <i>/* Mode changed? */</i></td></tr>
<tr><th id="120">120</th><td>    <a class="typedef" href="lj_obj.h.html#ASMFunction" title='ASMFunction' data-type='void (*)(void)' data-ref="ASMFunction" data-ref-filename="ASMFunction">ASMFunction</a> *<dfn class="local col3 decl" id="13disp" title='disp' data-type='ASMFunction *' data-ref="13disp" data-ref-filename="13disp">disp</dfn> = <a class="macro" href="lj_dispatch.h.html#112" title="((GG_State *)((char *)(g) - ((int)__builtin_offsetof(GG_State, g))))" data-ref="_M/G2GG">G2GG</a>(<a class="local col0 ref" href="#10g" title='g' data-ref="10g" data-ref-filename="10g">g</a>)-&gt;<a class="ref field" href="lj_dispatch.h.html#GG_State::dispatch" title='GG_State::dispatch' data-ref="GG_State::dispatch" data-ref-filename="GG_State..dispatch">dispatch</a>;</td></tr>
<tr><th id="121">121</th><td>    <a class="typedef" href="lj_obj.h.html#ASMFunction" title='ASMFunction' data-type='void (*)(void)' data-ref="ASMFunction" data-ref-filename="ASMFunction">ASMFunction</a> <dfn class="local col4 decl" id="14f_forl" title='f_forl' data-type='ASMFunction' data-ref="14f_forl" data-ref-filename="14f_forl">f_forl</dfn>, <dfn class="local col5 decl" id="15f_iterl" title='f_iterl' data-type='ASMFunction' data-ref="15f_iterl" data-ref-filename="15f_iterl">f_iterl</dfn>, <dfn class="local col6 decl" id="16f_loop" title='f_loop' data-type='ASMFunction' data-ref="16f_loop" data-ref-filename="16f_loop">f_loop</dfn>, <dfn class="local col7 decl" id="17f_funcf" title='f_funcf' data-type='ASMFunction' data-ref="17f_funcf" data-ref-filename="17f_funcf">f_funcf</dfn>, <dfn class="local col8 decl" id="18f_funcv" title='f_funcv' data-type='ASMFunction' data-ref="18f_funcv" data-ref-filename="18f_funcv">f_funcv</dfn>;</td></tr>
<tr><th id="122">122</th><td>    <a class="local col0 ref" href="#10g" title='g' data-ref="10g" data-ref-filename="10g">g</a>-&gt;<a class="ref field" href="lj_obj.h.html#global_State::dispatchmode" title='global_State::dispatchmode' data-ref="global_State::dispatchmode" data-ref-filename="global_State..dispatchmode">dispatchmode</a> = <a class="local col2 ref" href="#12mode" title='mode' data-ref="12mode" data-ref-filename="12mode">mode</a>;</td></tr>
<tr><th id="123">123</th><td></td></tr>
<tr><th id="124">124</th><td>    <i>/* Hotcount if JIT is on, but not while recording. */</i></td></tr>
<tr><th id="125">125</th><td>    <b>if</b> ((<a class="local col2 ref" href="#12mode" title='mode' data-ref="12mode" data-ref-filename="12mode">mode</a> &amp; (<a class="macro" href="#99" title="0x10" data-ref="_M/DISPMODE_JIT">DISPMODE_JIT</a>|<a class="macro" href="#100" title="0x20" data-ref="_M/DISPMODE_REC">DISPMODE_REC</a>)) == <a class="macro" href="#99" title="0x10" data-ref="_M/DISPMODE_JIT">DISPMODE_JIT</a>) {</td></tr>
<tr><th id="126">126</th><td>      <a class="local col4 ref" href="#14f_forl" title='f_forl' data-ref="14f_forl" data-ref-filename="14f_forl">f_forl</a> = <a class="macro" href="lj_vm.h.html#116" title="((ASMFunction)(lj_vm_asm_begin + (lj_bc_ofs[BC_FORL])))" data-ref="_M/makeasmfunc">makeasmfunc</a>(<a class="ref" href="lj_bc.h.html#lj_bc_ofs" title='lj_bc_ofs' data-ref="lj_bc_ofs" data-ref-filename="lj_bc_ofs">lj_bc_ofs</a>[<a class="enum" href="lj_bc.h.html#202" title='BC_FORL' data-ref="BC_FORL" data-ref-filename="BC_FORL">BC_FORL</a>]);</td></tr>
<tr><th id="127">127</th><td>      <a class="local col5 ref" href="#15f_iterl" title='f_iterl' data-ref="15f_iterl" data-ref-filename="15f_iterl">f_iterl</a> = <a class="macro" href="lj_vm.h.html#116" title="((ASMFunction)(lj_vm_asm_begin + (lj_bc_ofs[BC_ITERL])))" data-ref="_M/makeasmfunc">makeasmfunc</a>(<a class="ref" href="lj_bc.h.html#lj_bc_ofs" title='lj_bc_ofs' data-ref="lj_bc_ofs" data-ref-filename="lj_bc_ofs">lj_bc_ofs</a>[<a class="enum" href="lj_bc.h.html#202" title='BC_ITERL' data-ref="BC_ITERL" data-ref-filename="BC_ITERL">BC_ITERL</a>]);</td></tr>
<tr><th id="128">128</th><td>      <a class="local col6 ref" href="#16f_loop" title='f_loop' data-ref="16f_loop" data-ref-filename="16f_loop">f_loop</a> = <a class="macro" href="lj_vm.h.html#116" title="((ASMFunction)(lj_vm_asm_begin + (lj_bc_ofs[BC_LOOP])))" data-ref="_M/makeasmfunc">makeasmfunc</a>(<a class="ref" href="lj_bc.h.html#lj_bc_ofs" title='lj_bc_ofs' data-ref="lj_bc_ofs" data-ref-filename="lj_bc_ofs">lj_bc_ofs</a>[<a class="enum" href="lj_bc.h.html#202" title='BC_LOOP' data-ref="BC_LOOP" data-ref-filename="BC_LOOP">BC_LOOP</a>]);</td></tr>
<tr><th id="129">129</th><td>      <a class="local col7 ref" href="#17f_funcf" title='f_funcf' data-ref="17f_funcf" data-ref-filename="17f_funcf">f_funcf</a> = <a class="macro" href="lj_vm.h.html#116" title="((ASMFunction)(lj_vm_asm_begin + (lj_bc_ofs[BC_FUNCF])))" data-ref="_M/makeasmfunc">makeasmfunc</a>(<a class="ref" href="lj_bc.h.html#lj_bc_ofs" title='lj_bc_ofs' data-ref="lj_bc_ofs" data-ref-filename="lj_bc_ofs">lj_bc_ofs</a>[<a class="enum" href="lj_bc.h.html#202" title='BC_FUNCF' data-ref="BC_FUNCF" data-ref-filename="BC_FUNCF">BC_FUNCF</a>]);</td></tr>
<tr><th id="130">130</th><td>      <a class="local col8 ref" href="#18f_funcv" title='f_funcv' data-ref="18f_funcv" data-ref-filename="18f_funcv">f_funcv</a> = <a class="macro" href="lj_vm.h.html#116" title="((ASMFunction)(lj_vm_asm_begin + (lj_bc_ofs[BC_FUNCV])))" data-ref="_M/makeasmfunc">makeasmfunc</a>(<a class="ref" href="lj_bc.h.html#lj_bc_ofs" title='lj_bc_ofs' data-ref="lj_bc_ofs" data-ref-filename="lj_bc_ofs">lj_bc_ofs</a>[<a class="enum" href="lj_bc.h.html#202" title='BC_FUNCV' data-ref="BC_FUNCV" data-ref-filename="BC_FUNCV">BC_FUNCV</a>]);</td></tr>
<tr><th id="131">131</th><td>    } <b>else</b> {  <i>/* Otherwise use the non-hotcounting instructions. */</i></td></tr>
<tr><th id="132">132</th><td>      <a class="local col4 ref" href="#14f_forl" title='f_forl' data-ref="14f_forl" data-ref-filename="14f_forl">f_forl</a> = <a class="local col3 ref" href="#13disp" title='disp' data-ref="13disp" data-ref-filename="13disp">disp</a>[<a class="macro" href="lj_dispatch.h.html#84" title="(BC__MAX + 57)" data-ref="_M/GG_LEN_DDISP">GG_LEN_DDISP</a>+<a class="enum" href="lj_bc.h.html#202" title='BC_IFORL' data-ref="BC_IFORL" data-ref-filename="BC_IFORL">BC_IFORL</a>];</td></tr>
<tr><th id="133">133</th><td>      <a class="local col5 ref" href="#15f_iterl" title='f_iterl' data-ref="15f_iterl" data-ref-filename="15f_iterl">f_iterl</a> = <a class="local col3 ref" href="#13disp" title='disp' data-ref="13disp" data-ref-filename="13disp">disp</a>[<a class="macro" href="lj_dispatch.h.html#84" title="(BC__MAX + 57)" data-ref="_M/GG_LEN_DDISP">GG_LEN_DDISP</a>+<a class="enum" href="lj_bc.h.html#202" title='BC_IITERL' data-ref="BC_IITERL" data-ref-filename="BC_IITERL">BC_IITERL</a>];</td></tr>
<tr><th id="134">134</th><td>      <a class="local col6 ref" href="#16f_loop" title='f_loop' data-ref="16f_loop" data-ref-filename="16f_loop">f_loop</a> = <a class="local col3 ref" href="#13disp" title='disp' data-ref="13disp" data-ref-filename="13disp">disp</a>[<a class="macro" href="lj_dispatch.h.html#84" title="(BC__MAX + 57)" data-ref="_M/GG_LEN_DDISP">GG_LEN_DDISP</a>+<a class="enum" href="lj_bc.h.html#202" title='BC_ILOOP' data-ref="BC_ILOOP" data-ref-filename="BC_ILOOP">BC_ILOOP</a>];</td></tr>
<tr><th id="135">135</th><td>      <a class="local col7 ref" href="#17f_funcf" title='f_funcf' data-ref="17f_funcf" data-ref-filename="17f_funcf">f_funcf</a> = <a class="macro" href="lj_vm.h.html#116" title="((ASMFunction)(lj_vm_asm_begin + (lj_bc_ofs[BC_IFUNCF])))" data-ref="_M/makeasmfunc">makeasmfunc</a>(<a class="ref" href="lj_bc.h.html#lj_bc_ofs" title='lj_bc_ofs' data-ref="lj_bc_ofs" data-ref-filename="lj_bc_ofs">lj_bc_ofs</a>[<a class="enum" href="lj_bc.h.html#202" title='BC_IFUNCF' data-ref="BC_IFUNCF" data-ref-filename="BC_IFUNCF">BC_IFUNCF</a>]);</td></tr>
<tr><th id="136">136</th><td>      <a class="local col8 ref" href="#18f_funcv" title='f_funcv' data-ref="18f_funcv" data-ref-filename="18f_funcv">f_funcv</a> = <a class="macro" href="lj_vm.h.html#116" title="((ASMFunction)(lj_vm_asm_begin + (lj_bc_ofs[BC_IFUNCV])))" data-ref="_M/makeasmfunc">makeasmfunc</a>(<a class="ref" href="lj_bc.h.html#lj_bc_ofs" title='lj_bc_ofs' data-ref="lj_bc_ofs" data-ref-filename="lj_bc_ofs">lj_bc_ofs</a>[<a class="enum" href="lj_bc.h.html#202" title='BC_IFUNCV' data-ref="BC_IFUNCV" data-ref-filename="BC_IFUNCV">BC_IFUNCV</a>]);</td></tr>
<tr><th id="137">137</th><td>    }</td></tr>
<tr><th id="138">138</th><td>    <i>/* Init static counting instruction dispatch first (may be copied below). */</i></td></tr>
<tr><th id="139">139</th><td>    <a class="local col3 ref" href="#13disp" title='disp' data-ref="13disp" data-ref-filename="13disp">disp</a>[<a class="macro" href="lj_dispatch.h.html#84" title="(BC__MAX + 57)" data-ref="_M/GG_LEN_DDISP">GG_LEN_DDISP</a>+<a class="enum" href="lj_bc.h.html#202" title='BC_FORL' data-ref="BC_FORL" data-ref-filename="BC_FORL">BC_FORL</a>] = <a class="local col4 ref" href="#14f_forl" title='f_forl' data-ref="14f_forl" data-ref-filename="14f_forl">f_forl</a>;</td></tr>
<tr><th id="140">140</th><td>    <a class="local col3 ref" href="#13disp" title='disp' data-ref="13disp" data-ref-filename="13disp">disp</a>[<a class="macro" href="lj_dispatch.h.html#84" title="(BC__MAX + 57)" data-ref="_M/GG_LEN_DDISP">GG_LEN_DDISP</a>+<a class="enum" href="lj_bc.h.html#202" title='BC_ITERL' data-ref="BC_ITERL" data-ref-filename="BC_ITERL">BC_ITERL</a>] = <a class="local col5 ref" href="#15f_iterl" title='f_iterl' data-ref="15f_iterl" data-ref-filename="15f_iterl">f_iterl</a>;</td></tr>
<tr><th id="141">141</th><td>    <a class="local col3 ref" href="#13disp" title='disp' data-ref="13disp" data-ref-filename="13disp">disp</a>[<a class="macro" href="lj_dispatch.h.html#84" title="(BC__MAX + 57)" data-ref="_M/GG_LEN_DDISP">GG_LEN_DDISP</a>+<a class="enum" href="lj_bc.h.html#202" title='BC_LOOP' data-ref="BC_LOOP" data-ref-filename="BC_LOOP">BC_LOOP</a>] = <a class="local col6 ref" href="#16f_loop" title='f_loop' data-ref="16f_loop" data-ref-filename="16f_loop">f_loop</a>;</td></tr>
<tr><th id="142">142</th><td></td></tr>
<tr><th id="143">143</th><td>    <i>/* Set dynamic instruction dispatch. */</i></td></tr>
<tr><th id="144">144</th><td>    <b>if</b> ((<a class="local col1 ref" href="#11oldmode" title='oldmode' data-ref="11oldmode" data-ref-filename="11oldmode">oldmode</a> ^ <a class="local col2 ref" href="#12mode" title='mode' data-ref="12mode" data-ref-filename="12mode">mode</a>) &amp; (<a class="macro" href="#101" title="0x40" data-ref="_M/DISPMODE_PROF">DISPMODE_PROF</a>|<a class="macro" href="#100" title="0x20" data-ref="_M/DISPMODE_REC">DISPMODE_REC</a>|<a class="macro" href="#98" title="0x04" data-ref="_M/DISPMODE_INS">DISPMODE_INS</a>)) {</td></tr>
<tr><th id="145">145</th><td>      <i>/* Need to update the whole table. */</i></td></tr>
<tr><th id="146">146</th><td>      <b>if</b> (!(<a class="local col2 ref" href="#12mode" title='mode' data-ref="12mode" data-ref-filename="12mode">mode</a> &amp; <a class="macro" href="#98" title="0x04" data-ref="_M/DISPMODE_INS">DISPMODE_INS</a>)) {  <i>/* No ins dispatch? */</i></td></tr>
<tr><th id="147">147</th><td>	<i>/* Copy static dispatch table to dynamic dispatch table. */</i></td></tr>
<tr><th id="148">148</th><td>	<a class="ref fn" href="../include/string.h.html#memcpy" title='memcpy' data-ref="memcpy" data-ref-filename="memcpy">memcpy</a>(&amp;<a class="local col3 ref" href="#13disp" title='disp' data-ref="13disp" data-ref-filename="13disp">disp</a>[<var>0</var>], &amp;<a class="local col3 ref" href="#13disp" title='disp' data-ref="13disp" data-ref-filename="13disp">disp</a>[<a class="macro" href="lj_dispatch.h.html#84" title="(BC__MAX + 57)" data-ref="_M/GG_LEN_DDISP">GG_LEN_DDISP</a>], <a class="macro" href="lj_dispatch.h.html#85" title="BC_FUNCF" data-ref="_M/GG_LEN_SDISP">GG_LEN_SDISP</a>*<b>sizeof</b>(<a class="typedef" href="lj_obj.h.html#ASMFunction" title='ASMFunction' data-type='void (*)(void)' data-ref="ASMFunction" data-ref-filename="ASMFunction">ASMFunction</a>));</td></tr>
<tr><th id="149">149</th><td>	<i>/* Overwrite with dynamic return dispatch. */</i></td></tr>
<tr><th id="150">150</th><td>	<b>if</b> ((<a class="local col2 ref" href="#12mode" title='mode' data-ref="12mode" data-ref-filename="12mode">mode</a> &amp; <a class="macro" href="#97" title="0x02" data-ref="_M/DISPMODE_RET">DISPMODE_RET</a>)) {</td></tr>
<tr><th id="151">151</th><td>	  <a class="local col3 ref" href="#13disp" title='disp' data-ref="13disp" data-ref-filename="13disp">disp</a>[<a class="enum" href="lj_bc.h.html#202" title='BC_RETM' data-ref="BC_RETM" data-ref-filename="BC_RETM">BC_RETM</a>] = <a class="ref fn" href="lj_vm.h.html#lj_vm_rethook" title='lj_vm_rethook' data-ref="lj_vm_rethook" data-ref-filename="lj_vm_rethook">lj_vm_rethook</a>;</td></tr>
<tr><th id="152">152</th><td>	  <a class="local col3 ref" href="#13disp" title='disp' data-ref="13disp" data-ref-filename="13disp">disp</a>[<a class="enum" href="lj_bc.h.html#202" title='BC_RET' data-ref="BC_RET" data-ref-filename="BC_RET">BC_RET</a>] = <a class="ref fn" href="lj_vm.h.html#lj_vm_rethook" title='lj_vm_rethook' data-ref="lj_vm_rethook" data-ref-filename="lj_vm_rethook">lj_vm_rethook</a>;</td></tr>
<tr><th id="153">153</th><td>	  <a class="local col3 ref" href="#13disp" title='disp' data-ref="13disp" data-ref-filename="13disp">disp</a>[<a class="enum" href="lj_bc.h.html#202" title='BC_RET0' data-ref="BC_RET0" data-ref-filename="BC_RET0">BC_RET0</a>] = <a class="ref fn" href="lj_vm.h.html#lj_vm_rethook" title='lj_vm_rethook' data-ref="lj_vm_rethook" data-ref-filename="lj_vm_rethook">lj_vm_rethook</a>;</td></tr>
<tr><th id="154">154</th><td>	  <a class="local col3 ref" href="#13disp" title='disp' data-ref="13disp" data-ref-filename="13disp">disp</a>[<a class="enum" href="lj_bc.h.html#202" title='BC_RET1' data-ref="BC_RET1" data-ref-filename="BC_RET1">BC_RET1</a>] = <a class="ref fn" href="lj_vm.h.html#lj_vm_rethook" title='lj_vm_rethook' data-ref="lj_vm_rethook" data-ref-filename="lj_vm_rethook">lj_vm_rethook</a>;</td></tr>
<tr><th id="155">155</th><td>	}</td></tr>
<tr><th id="156">156</th><td>      } <b>else</b> {</td></tr>
<tr><th id="157">157</th><td>	<i>/* The recording dispatch also checks for hooks. */</i></td></tr>
<tr><th id="158">158</th><td>	<a class="typedef" href="lj_obj.h.html#ASMFunction" title='ASMFunction' data-type='void (*)(void)' data-ref="ASMFunction" data-ref-filename="ASMFunction">ASMFunction</a> <dfn class="local col9 decl" id="19f" title='f' data-type='ASMFunction' data-ref="19f" data-ref-filename="19f">f</dfn> = (<a class="local col2 ref" href="#12mode" title='mode' data-ref="12mode" data-ref-filename="12mode">mode</a> &amp; <a class="macro" href="#101" title="0x40" data-ref="_M/DISPMODE_PROF">DISPMODE_PROF</a>) ? <a class="ref fn" href="lj_vm.h.html#lj_vm_profhook" title='lj_vm_profhook' data-ref="lj_vm_profhook" data-ref-filename="lj_vm_profhook">lj_vm_profhook</a> :</td></tr>
<tr><th id="159">159</th><td>			(<a class="local col2 ref" href="#12mode" title='mode' data-ref="12mode" data-ref-filename="12mode">mode</a> &amp; <a class="macro" href="#100" title="0x20" data-ref="_M/DISPMODE_REC">DISPMODE_REC</a>) ? <a class="ref fn" href="lj_vm.h.html#lj_vm_record" title='lj_vm_record' data-ref="lj_vm_record" data-ref-filename="lj_vm_record">lj_vm_record</a> : <a class="ref fn" href="lj_vm.h.html#lj_vm_inshook" title='lj_vm_inshook' data-ref="lj_vm_inshook" data-ref-filename="lj_vm_inshook">lj_vm_inshook</a>;</td></tr>
<tr><th id="160">160</th><td>	<a class="typedef" href="../include/x86_64-linux-gnu/bits/stdint-uintn.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col0 decl" id="20i" title='i' data-type='uint32_t' data-ref="20i" data-ref-filename="20i">i</dfn>;</td></tr>
<tr><th id="161">161</th><td>	<b>for</b> (<a class="local col0 ref" href="#20i" title='i' data-ref="20i" data-ref-filename="20i">i</a> = <var>0</var>; <a class="local col0 ref" href="#20i" title='i' data-ref="20i" data-ref-filename="20i">i</a> &lt; <a class="macro" href="lj_dispatch.h.html#85" title="BC_FUNCF" data-ref="_M/GG_LEN_SDISP">GG_LEN_SDISP</a>; <a class="local col0 ref" href="#20i" title='i' data-ref="20i" data-ref-filename="20i">i</a>++)</td></tr>
<tr><th id="162">162</th><td>	  <a class="local col3 ref" href="#13disp" title='disp' data-ref="13disp" data-ref-filename="13disp">disp</a>[<a class="local col0 ref" href="#20i" title='i' data-ref="20i" data-ref-filename="20i">i</a>] = <a class="local col9 ref" href="#19f" title='f' data-ref="19f" data-ref-filename="19f">f</a>;</td></tr>
<tr><th id="163">163</th><td>      }</td></tr>
<tr><th id="164">164</th><td>    } <b>else</b> <b>if</b> (!(<a class="local col2 ref" href="#12mode" title='mode' data-ref="12mode" data-ref-filename="12mode">mode</a> &amp; <a class="macro" href="#98" title="0x04" data-ref="_M/DISPMODE_INS">DISPMODE_INS</a>)) {</td></tr>
<tr><th id="165">165</th><td>      <i>/* Otherwise set dynamic counting ins. */</i></td></tr>
<tr><th id="166">166</th><td>      <a class="local col3 ref" href="#13disp" title='disp' data-ref="13disp" data-ref-filename="13disp">disp</a>[<a class="enum" href="lj_bc.h.html#202" title='BC_FORL' data-ref="BC_FORL" data-ref-filename="BC_FORL">BC_FORL</a>] = <a class="local col4 ref" href="#14f_forl" title='f_forl' data-ref="14f_forl" data-ref-filename="14f_forl">f_forl</a>;</td></tr>
<tr><th id="167">167</th><td>      <a class="local col3 ref" href="#13disp" title='disp' data-ref="13disp" data-ref-filename="13disp">disp</a>[<a class="enum" href="lj_bc.h.html#202" title='BC_ITERL' data-ref="BC_ITERL" data-ref-filename="BC_ITERL">BC_ITERL</a>] = <a class="local col5 ref" href="#15f_iterl" title='f_iterl' data-ref="15f_iterl" data-ref-filename="15f_iterl">f_iterl</a>;</td></tr>
<tr><th id="168">168</th><td>      <a class="local col3 ref" href="#13disp" title='disp' data-ref="13disp" data-ref-filename="13disp">disp</a>[<a class="enum" href="lj_bc.h.html#202" title='BC_LOOP' data-ref="BC_LOOP" data-ref-filename="BC_LOOP">BC_LOOP</a>] = <a class="local col6 ref" href="#16f_loop" title='f_loop' data-ref="16f_loop" data-ref-filename="16f_loop">f_loop</a>;</td></tr>
<tr><th id="169">169</th><td>      <i>/* Set dynamic return dispatch. */</i></td></tr>
<tr><th id="170">170</th><td>      <b>if</b> ((<a class="local col2 ref" href="#12mode" title='mode' data-ref="12mode" data-ref-filename="12mode">mode</a> &amp; <a class="macro" href="#97" title="0x02" data-ref="_M/DISPMODE_RET">DISPMODE_RET</a>)) {</td></tr>
<tr><th id="171">171</th><td>	<a class="local col3 ref" href="#13disp" title='disp' data-ref="13disp" data-ref-filename="13disp">disp</a>[<a class="enum" href="lj_bc.h.html#202" title='BC_RETM' data-ref="BC_RETM" data-ref-filename="BC_RETM">BC_RETM</a>] = <a class="ref fn" href="lj_vm.h.html#lj_vm_rethook" title='lj_vm_rethook' data-ref="lj_vm_rethook" data-ref-filename="lj_vm_rethook">lj_vm_rethook</a>;</td></tr>
<tr><th id="172">172</th><td>	<a class="local col3 ref" href="#13disp" title='disp' data-ref="13disp" data-ref-filename="13disp">disp</a>[<a class="enum" href="lj_bc.h.html#202" title='BC_RET' data-ref="BC_RET" data-ref-filename="BC_RET">BC_RET</a>] = <a class="ref fn" href="lj_vm.h.html#lj_vm_rethook" title='lj_vm_rethook' data-ref="lj_vm_rethook" data-ref-filename="lj_vm_rethook">lj_vm_rethook</a>;</td></tr>
<tr><th id="173">173</th><td>	<a class="local col3 ref" href="#13disp" title='disp' data-ref="13disp" data-ref-filename="13disp">disp</a>[<a class="enum" href="lj_bc.h.html#202" title='BC_RET0' data-ref="BC_RET0" data-ref-filename="BC_RET0">BC_RET0</a>] = <a class="ref fn" href="lj_vm.h.html#lj_vm_rethook" title='lj_vm_rethook' data-ref="lj_vm_rethook" data-ref-filename="lj_vm_rethook">lj_vm_rethook</a>;</td></tr>
<tr><th id="174">174</th><td>	<a class="local col3 ref" href="#13disp" title='disp' data-ref="13disp" data-ref-filename="13disp">disp</a>[<a class="enum" href="lj_bc.h.html#202" title='BC_RET1' data-ref="BC_RET1" data-ref-filename="BC_RET1">BC_RET1</a>] = <a class="ref fn" href="lj_vm.h.html#lj_vm_rethook" title='lj_vm_rethook' data-ref="lj_vm_rethook" data-ref-filename="lj_vm_rethook">lj_vm_rethook</a>;</td></tr>
<tr><th id="175">175</th><td>      } <b>else</b> {</td></tr>
<tr><th id="176">176</th><td>	<a class="local col3 ref" href="#13disp" title='disp' data-ref="13disp" data-ref-filename="13disp">disp</a>[<a class="enum" href="lj_bc.h.html#202" title='BC_RETM' data-ref="BC_RETM" data-ref-filename="BC_RETM">BC_RETM</a>] = <a class="local col3 ref" href="#13disp" title='disp' data-ref="13disp" data-ref-filename="13disp">disp</a>[<a class="macro" href="lj_dispatch.h.html#84" title="(BC__MAX + 57)" data-ref="_M/GG_LEN_DDISP">GG_LEN_DDISP</a>+<a class="enum" href="lj_bc.h.html#202" title='BC_RETM' data-ref="BC_RETM" data-ref-filename="BC_RETM">BC_RETM</a>];</td></tr>
<tr><th id="177">177</th><td>	<a class="local col3 ref" href="#13disp" title='disp' data-ref="13disp" data-ref-filename="13disp">disp</a>[<a class="enum" href="lj_bc.h.html#202" title='BC_RET' data-ref="BC_RET" data-ref-filename="BC_RET">BC_RET</a>] = <a class="local col3 ref" href="#13disp" title='disp' data-ref="13disp" data-ref-filename="13disp">disp</a>[<a class="macro" href="lj_dispatch.h.html#84" title="(BC__MAX + 57)" data-ref="_M/GG_LEN_DDISP">GG_LEN_DDISP</a>+<a class="enum" href="lj_bc.h.html#202" title='BC_RET' data-ref="BC_RET" data-ref-filename="BC_RET">BC_RET</a>];</td></tr>
<tr><th id="178">178</th><td>	<a class="local col3 ref" href="#13disp" title='disp' data-ref="13disp" data-ref-filename="13disp">disp</a>[<a class="enum" href="lj_bc.h.html#202" title='BC_RET0' data-ref="BC_RET0" data-ref-filename="BC_RET0">BC_RET0</a>] = <a class="local col3 ref" href="#13disp" title='disp' data-ref="13disp" data-ref-filename="13disp">disp</a>[<a class="macro" href="lj_dispatch.h.html#84" title="(BC__MAX + 57)" data-ref="_M/GG_LEN_DDISP">GG_LEN_DDISP</a>+<a class="enum" href="lj_bc.h.html#202" title='BC_RET0' data-ref="BC_RET0" data-ref-filename="BC_RET0">BC_RET0</a>];</td></tr>
<tr><th id="179">179</th><td>	<a class="local col3 ref" href="#13disp" title='disp' data-ref="13disp" data-ref-filename="13disp">disp</a>[<a class="enum" href="lj_bc.h.html#202" title='BC_RET1' data-ref="BC_RET1" data-ref-filename="BC_RET1">BC_RET1</a>] = <a class="local col3 ref" href="#13disp" title='disp' data-ref="13disp" data-ref-filename="13disp">disp</a>[<a class="macro" href="lj_dispatch.h.html#84" title="(BC__MAX + 57)" data-ref="_M/GG_LEN_DDISP">GG_LEN_DDISP</a>+<a class="enum" href="lj_bc.h.html#202" title='BC_RET1' data-ref="BC_RET1" data-ref-filename="BC_RET1">BC_RET1</a>];</td></tr>
<tr><th id="180">180</th><td>      }</td></tr>
<tr><th id="181">181</th><td>    }</td></tr>
<tr><th id="182">182</th><td></td></tr>
<tr><th id="183">183</th><td>    <i>/* Set dynamic call dispatch. */</i></td></tr>
<tr><th id="184">184</th><td>    <b>if</b> ((<a class="local col1 ref" href="#11oldmode" title='oldmode' data-ref="11oldmode" data-ref-filename="11oldmode">oldmode</a> ^ <a class="local col2 ref" href="#12mode" title='mode' data-ref="12mode" data-ref-filename="12mode">mode</a>) &amp; <a class="macro" href="#96" title="0x01" data-ref="_M/DISPMODE_CALL">DISPMODE_CALL</a>) {  <i>/* Update the whole table? */</i></td></tr>
<tr><th id="185">185</th><td>      <a class="typedef" href="../include/x86_64-linux-gnu/bits/stdint-uintn.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col1 decl" id="21i" title='i' data-type='uint32_t' data-ref="21i" data-ref-filename="21i">i</dfn>;</td></tr>
<tr><th id="186">186</th><td>      <b>if</b> ((<a class="local col2 ref" href="#12mode" title='mode' data-ref="12mode" data-ref-filename="12mode">mode</a> &amp; <a class="macro" href="#96" title="0x01" data-ref="_M/DISPMODE_CALL">DISPMODE_CALL</a>) == <var>0</var>) {  <i>/* No call hooks? */</i></td></tr>
<tr><th id="187">187</th><td>	<b>for</b> (<a class="local col1 ref" href="#21i" title='i' data-ref="21i" data-ref-filename="21i">i</a> = <a class="macro" href="lj_dispatch.h.html#85" title="BC_FUNCF" data-ref="_M/GG_LEN_SDISP">GG_LEN_SDISP</a>; <a class="local col1 ref" href="#21i" title='i' data-ref="21i" data-ref-filename="21i">i</a> &lt; <a class="macro" href="lj_dispatch.h.html#84" title="(BC__MAX + 57)" data-ref="_M/GG_LEN_DDISP">GG_LEN_DDISP</a>; <a class="local col1 ref" href="#21i" title='i' data-ref="21i" data-ref-filename="21i">i</a>++)</td></tr>
<tr><th id="188">188</th><td>	  <a class="local col3 ref" href="#13disp" title='disp' data-ref="13disp" data-ref-filename="13disp">disp</a>[<a class="local col1 ref" href="#21i" title='i' data-ref="21i" data-ref-filename="21i">i</a>] = <a class="macro" href="lj_vm.h.html#116" title="((ASMFunction)(lj_vm_asm_begin + (lj_bc_ofs[i])))" data-ref="_M/makeasmfunc">makeasmfunc</a>(<a class="ref" href="lj_bc.h.html#lj_bc_ofs" title='lj_bc_ofs' data-ref="lj_bc_ofs" data-ref-filename="lj_bc_ofs">lj_bc_ofs</a>[<a class="local col1 ref" href="#21i" title='i' data-ref="21i" data-ref-filename="21i">i</a>]);</td></tr>
<tr><th id="189">189</th><td>      } <b>else</b> {</td></tr>
<tr><th id="190">190</th><td>	<b>for</b> (<a class="local col1 ref" href="#21i" title='i' data-ref="21i" data-ref-filename="21i">i</a> = <a class="macro" href="lj_dispatch.h.html#85" title="BC_FUNCF" data-ref="_M/GG_LEN_SDISP">GG_LEN_SDISP</a>; <a class="local col1 ref" href="#21i" title='i' data-ref="21i" data-ref-filename="21i">i</a> &lt; <a class="macro" href="lj_dispatch.h.html#84" title="(BC__MAX + 57)" data-ref="_M/GG_LEN_DDISP">GG_LEN_DDISP</a>; <a class="local col1 ref" href="#21i" title='i' data-ref="21i" data-ref-filename="21i">i</a>++)</td></tr>
<tr><th id="191">191</th><td>	  <a class="local col3 ref" href="#13disp" title='disp' data-ref="13disp" data-ref-filename="13disp">disp</a>[<a class="local col1 ref" href="#21i" title='i' data-ref="21i" data-ref-filename="21i">i</a>] = <a class="ref fn" href="lj_vm.h.html#lj_vm_callhook" title='lj_vm_callhook' data-ref="lj_vm_callhook" data-ref-filename="lj_vm_callhook">lj_vm_callhook</a>;</td></tr>
<tr><th id="192">192</th><td>      }</td></tr>
<tr><th id="193">193</th><td>    }</td></tr>
<tr><th id="194">194</th><td>    <b>if</b> (!(<a class="local col2 ref" href="#12mode" title='mode' data-ref="12mode" data-ref-filename="12mode">mode</a> &amp; <a class="macro" href="#96" title="0x01" data-ref="_M/DISPMODE_CALL">DISPMODE_CALL</a>)) {  <i>/* Overwrite dynamic counting ins. */</i></td></tr>
<tr><th id="195">195</th><td>      <a class="local col3 ref" href="#13disp" title='disp' data-ref="13disp" data-ref-filename="13disp">disp</a>[<a class="enum" href="lj_bc.h.html#202" title='BC_FUNCF' data-ref="BC_FUNCF" data-ref-filename="BC_FUNCF">BC_FUNCF</a>] = <a class="local col7 ref" href="#17f_funcf" title='f_funcf' data-ref="17f_funcf" data-ref-filename="17f_funcf">f_funcf</a>;</td></tr>
<tr><th id="196">196</th><td>      <a class="local col3 ref" href="#13disp" title='disp' data-ref="13disp" data-ref-filename="13disp">disp</a>[<a class="enum" href="lj_bc.h.html#202" title='BC_FUNCV' data-ref="BC_FUNCV" data-ref-filename="BC_FUNCV">BC_FUNCV</a>] = <a class="local col8 ref" href="#18f_funcv" title='f_funcv' data-ref="18f_funcv" data-ref-filename="18f_funcv">f_funcv</a>;</td></tr>
<tr><th id="197">197</th><td>    }</td></tr>
<tr><th id="198">198</th><td></td></tr>
<tr><th id="199">199</th><td><u>#<span data-ppcond="199">if</span> <a class="macro" href="lj_arch.h.html#542" title="1" data-ref="_M/LJ_HASJIT">LJ_HASJIT</a></u></td></tr>
<tr><th id="200">200</th><td>    <i>/* Reset hotcounts for JIT off to on transition. */</i></td></tr>
<tr><th id="201">201</th><td>    <b>if</b> ((<a class="local col2 ref" href="#12mode" title='mode' data-ref="12mode" data-ref-filename="12mode">mode</a> &amp; <a class="macro" href="#99" title="0x10" data-ref="_M/DISPMODE_JIT">DISPMODE_JIT</a>) &amp;&amp; !(<a class="local col1 ref" href="#11oldmode" title='oldmode' data-ref="11oldmode" data-ref-filename="11oldmode">oldmode</a> &amp; <a class="macro" href="#99" title="0x10" data-ref="_M/DISPMODE_JIT">DISPMODE_JIT</a>))</td></tr>
<tr><th id="202">202</th><td>      <a class="ref fn" href="#lj_dispatch_init_hotcount" title='lj_dispatch_init_hotcount' data-ref="lj_dispatch_init_hotcount" data-ref-filename="lj_dispatch_init_hotcount">lj_dispatch_init_hotcount</a>(<a class="local col0 ref" href="#10g" title='g' data-ref="10g" data-ref-filename="10g">g</a>);</td></tr>
<tr><th id="203">203</th><td><u>#<span data-ppcond="199">endif</span></u></td></tr>
<tr><th id="204">204</th><td>  }</td></tr>
<tr><th id="205">205</th><td>}</td></tr>
<tr><th id="206">206</th><td></td></tr>
<tr><th id="207">207</th><td><i>/* -- JIT mode setting ---------------------------------------------------- */</i></td></tr>
<tr><th id="208">208</th><td></td></tr>
<tr><th id="209">209</th><td><u>#<span data-ppcond="209">if</span> <a class="macro" href="lj_arch.h.html#542" title="1" data-ref="_M/LJ_HASJIT">LJ_HASJIT</a></u></td></tr>
<tr><th id="210">210</th><td><i  data-doc="setptmode">/* Set JIT mode for a single prototype. */</i></td></tr>
<tr><th id="211">211</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="setptmode" title='setptmode' data-type='void setptmode(global_State * g, GCproto * pt, int mode)' data-ref="setptmode" data-ref-filename="setptmode">setptmode</dfn>(<a class="typedef" href="lj_obj.h.html#global_State" title='global_State' data-type='struct global_State' data-ref="global_State" data-ref-filename="global_State">global_State</a> *<dfn class="local col2 decl" id="22g" title='g' data-type='global_State *' data-ref="22g" data-ref-filename="22g">g</dfn>, <a class="typedef" href="lj_obj.h.html#GCproto" title='GCproto' data-type='struct GCproto' data-ref="GCproto" data-ref-filename="GCproto">GCproto</a> *<dfn class="local col3 decl" id="23pt" title='pt' data-type='GCproto *' data-ref="23pt" data-ref-filename="23pt">pt</dfn>, <em>int</em> <dfn class="local col4 decl" id="24mode" title='mode' data-type='int' data-ref="24mode" data-ref-filename="24mode">mode</dfn>)</td></tr>
<tr><th id="212">212</th><td>{</td></tr>
<tr><th id="213">213</th><td>  <b>if</b> ((<a class="local col4 ref" href="#24mode" title='mode' data-ref="24mode" data-ref-filename="24mode">mode</a> &amp; <a class="macro" href="luajit.h.html#59" title="0x0100" data-ref="_M/LUAJIT_MODE_ON">LUAJIT_MODE_ON</a>)) {  <i>/* (Re-)enable JIT compilation. */</i></td></tr>
<tr><th id="214">214</th><td>    <a class="local col3 ref" href="#23pt" title='pt' data-ref="23pt" data-ref-filename="23pt">pt</a>-&gt;<a class="ref field" href="lj_obj.h.html#GCproto::flags" title='GCproto::flags' data-ref="GCproto::flags" data-ref-filename="GCproto..flags">flags</a> &amp;= ~<a class="macro" href="lj_obj.h.html#399" title="0x08" data-ref="_M/PROTO_NOJIT">PROTO_NOJIT</a>;</td></tr>
<tr><th id="215">215</th><td>    <a class="ref fn" href="lj_trace.h.html#lj_trace_reenableproto" title='lj_trace_reenableproto' data-ref="lj_trace_reenableproto" data-ref-filename="lj_trace_reenableproto">lj_trace_reenableproto</a>(<a class="local col3 ref" href="#23pt" title='pt' data-ref="23pt" data-ref-filename="23pt">pt</a>);  <i>/* Unpatch all ILOOP etc. bytecodes. */</i></td></tr>
<tr><th id="216">216</th><td>  } <b>else</b> {  <i>/* Flush and/or disable JIT compilation. */</i></td></tr>
<tr><th id="217">217</th><td>    <b>if</b> (!(<a class="local col4 ref" href="#24mode" title='mode' data-ref="24mode" data-ref-filename="24mode">mode</a> &amp; <a class="macro" href="luajit.h.html#60" title="0x0200" data-ref="_M/LUAJIT_MODE_FLUSH">LUAJIT_MODE_FLUSH</a>))</td></tr>
<tr><th id="218">218</th><td>      <a class="local col3 ref" href="#23pt" title='pt' data-ref="23pt" data-ref-filename="23pt">pt</a>-&gt;<a class="ref field" href="lj_obj.h.html#GCproto::flags" title='GCproto::flags' data-ref="GCproto::flags" data-ref-filename="GCproto..flags">flags</a> |= <a class="macro" href="lj_obj.h.html#399" title="0x08" data-ref="_M/PROTO_NOJIT">PROTO_NOJIT</a>;</td></tr>
<tr><th id="219">219</th><td>    <a class="ref fn" href="lj_trace.h.html#lj_trace_flushproto" title='lj_trace_flushproto' data-ref="lj_trace_flushproto" data-ref-filename="lj_trace_flushproto">lj_trace_flushproto</a>(<a class="local col2 ref" href="#22g" title='g' data-ref="22g" data-ref-filename="22g">g</a>, <a class="local col3 ref" href="#23pt" title='pt' data-ref="23pt" data-ref-filename="23pt">pt</a>);  <i>/* Flush all traces of prototype. */</i></td></tr>
<tr><th id="220">220</th><td>  }</td></tr>
<tr><th id="221">221</th><td>}</td></tr>
<tr><th id="222">222</th><td></td></tr>
<tr><th id="223">223</th><td><i  data-doc="setptmode_all">/* Recursively set the JIT mode for all children of a prototype. */</i></td></tr>
<tr><th id="224">224</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="setptmode_all" title='setptmode_all' data-type='void setptmode_all(global_State * g, GCproto * pt, int mode)' data-ref="setptmode_all" data-ref-filename="setptmode_all">setptmode_all</dfn>(<a class="typedef" href="lj_obj.h.html#global_State" title='global_State' data-type='struct global_State' data-ref="global_State" data-ref-filename="global_State">global_State</a> *<dfn class="local col5 decl" id="25g" title='g' data-type='global_State *' data-ref="25g" data-ref-filename="25g">g</dfn>, <a class="typedef" href="lj_obj.h.html#GCproto" title='GCproto' data-type='struct GCproto' data-ref="GCproto" data-ref-filename="GCproto">GCproto</a> *<dfn class="local col6 decl" id="26pt" title='pt' data-type='GCproto *' data-ref="26pt" data-ref-filename="26pt">pt</dfn>, <em>int</em> <dfn class="local col7 decl" id="27mode" title='mode' data-type='int' data-ref="27mode" data-ref-filename="27mode">mode</dfn>)</td></tr>
<tr><th id="225">225</th><td>{</td></tr>
<tr><th id="226">226</th><td>  <span class='typedef' title='ptrdiff_t' data-type='long' data-ref="ptrdiff_t" data-ref-filename="ptrdiff_t">ptrdiff_t</span> <dfn class="local col8 decl" id="28i" title='i' data-type='ptrdiff_t' data-ref="28i" data-ref-filename="28i">i</dfn>;</td></tr>
<tr><th id="227">227</th><td>  <b>if</b> (!(<a class="local col6 ref" href="#26pt" title='pt' data-ref="26pt" data-ref-filename="26pt">pt</a>-&gt;<a class="ref field" href="lj_obj.h.html#GCproto::flags" title='GCproto::flags' data-ref="GCproto::flags" data-ref-filename="GCproto..flags">flags</a> &amp; <a class="macro" href="lj_obj.h.html#396" title="0x01" data-ref="_M/PROTO_CHILD">PROTO_CHILD</a>)) <b>return</b>;</td></tr>
<tr><th id="228">228</th><td>  <b>for</b> (<a class="local col8 ref" href="#28i" title='i' data-ref="28i" data-ref-filename="28i">i</a> = -(<span class='typedef' title='ptrdiff_t' data-type='long' data-ref="ptrdiff_t" data-ref-filename="ptrdiff_t">ptrdiff_t</span>)<a class="local col6 ref" href="#26pt" title='pt' data-ref="26pt" data-ref-filename="26pt">pt</a>-&gt;<a class="ref field" href="lj_obj.h.html#GCproto::sizekgc" title='GCproto::sizekgc' data-ref="GCproto::sizekgc" data-ref-filename="GCproto..sizekgc">sizekgc</a>; <a class="local col8 ref" href="#28i" title='i' data-ref="28i" data-ref-filename="28i">i</a> &lt; <var>0</var>; <a class="local col8 ref" href="#28i" title='i' data-ref="28i" data-ref-filename="28i">i</a>++) {</td></tr>
<tr><th id="229">229</th><td>    <a class="typedef" href="lj_obj.h.html#GCobj" title='GCobj' data-type='union GCobj' data-ref="GCobj" data-ref-filename="GCobj">GCobj</a> *<dfn class="local col9 decl" id="29o" title='o' data-type='GCobj *' data-ref="29o" data-ref-filename="29o">o</dfn> = <a class="macro" href="lj_obj.h.html#412" title="(((GCobj *)(((GCRef *)(void *)((pt)-&gt;k).ptr64)[(i)]).gcptr64))" data-ref="_M/proto_kgc">proto_kgc</a>(<a class="local col6 ref" href="#26pt" title='pt' data-ref="26pt" data-ref-filename="26pt">pt</a>, <a class="local col8 ref" href="#28i" title='i' data-ref="28i" data-ref-filename="28i">i</a>);</td></tr>
<tr><th id="230">230</th><td>    <b>if</b> (<a class="local col9 ref" href="#29o" title='o' data-ref="29o" data-ref-filename="29o">o</a>-&gt;<a class="ref field" href="lj_obj.h.html#GCobj::gch" title='GCobj::gch' data-ref="GCobj::gch" data-ref-filename="GCobj..gch">gch</a>.<a class="ref field" href="lj_obj.h.html#724" title='GChead::gct' data-ref="GChead::gct" data-ref-filename="GChead..gct">gct</a> == ~<a class="macro" href="lj_obj.h.html#267" title="(~7u)" data-ref="_M/LJ_TPROTO">LJ_TPROTO</a>) {</td></tr>
<tr><th id="231">231</th><td>      <a class="tu ref fn" href="#setptmode" title='setptmode' data-use='c' data-ref="setptmode" data-ref-filename="setptmode">setptmode</a>(<a class="local col5 ref" href="#25g" title='g' data-ref="25g" data-ref-filename="25g">g</a>, <a class="macro" href="lj_obj.h.html#762" title="(&amp;(o)-&gt;pt)" data-ref="_M/gco2pt">gco2pt</a>(<a class="local col9 ref" href="#29o" title='o' data-ref="29o" data-ref-filename="29o">o</a>), <a class="local col7 ref" href="#27mode" title='mode' data-ref="27mode" data-ref-filename="27mode">mode</a>);</td></tr>
<tr><th id="232">232</th><td>      <a class="tu ref fn" href="#setptmode_all" title='setptmode_all' data-use='c' data-ref="setptmode_all" data-ref-filename="setptmode_all">setptmode_all</a>(<a class="local col5 ref" href="#25g" title='g' data-ref="25g" data-ref-filename="25g">g</a>, <a class="macro" href="lj_obj.h.html#762" title="(&amp;(o)-&gt;pt)" data-ref="_M/gco2pt">gco2pt</a>(<a class="local col9 ref" href="#29o" title='o' data-ref="29o" data-ref-filename="29o">o</a>), <a class="local col7 ref" href="#27mode" title='mode' data-ref="27mode" data-ref-filename="27mode">mode</a>);</td></tr>
<tr><th id="233">233</th><td>    }</td></tr>
<tr><th id="234">234</th><td>  }</td></tr>
<tr><th id="235">235</th><td>}</td></tr>
<tr><th id="236">236</th><td><u>#<span data-ppcond="209">endif</span></u></td></tr>
<tr><th id="237">237</th><td></td></tr>
<tr><th id="238">238</th><td><i>/* Public API function: control the JIT engine. */</i></td></tr>
<tr><th id="239">239</th><td><em>int</em> <dfn class="decl def fn" id="luaJIT_setmode" title='luaJIT_setmode' data-ref="luaJIT_setmode" data-ref-filename="luaJIT_setmode">luaJIT_setmode</dfn>(<a class="typedef" href="lua.h.html#lua_State" title='lua_State' data-type='struct lua_State' data-ref="lua_State" data-ref-filename="lua_State">lua_State</a> *<dfn class="local col0 decl" id="30L" title='L' data-type='lua_State *' data-ref="30L" data-ref-filename="30L">L</dfn>, <em>int</em> <dfn class="local col1 decl" id="31idx" title='idx' data-type='int' data-ref="31idx" data-ref-filename="31idx">idx</dfn>, <em>int</em> <dfn class="local col2 decl" id="32mode" title='mode' data-type='int' data-ref="32mode" data-ref-filename="32mode">mode</dfn>)</td></tr>
<tr><th id="240">240</th><td>{</td></tr>
<tr><th id="241">241</th><td>  <a class="typedef" href="lj_obj.h.html#global_State" title='global_State' data-type='struct global_State' data-ref="global_State" data-ref-filename="global_State">global_State</a> *<dfn class="local col3 decl" id="33g" title='g' data-type='global_State *' data-ref="33g" data-ref-filename="33g">g</dfn> = <a class="macro" href="lj_obj.h.html#699" title="(((global_State *)(void *)(L-&gt;glref).ptr64))" data-ref="_M/G">G</a>(<a class="local col0 ref" href="#30L" title='L' data-ref="30L" data-ref-filename="30L">L</a>);</td></tr>
<tr><th id="242">242</th><td>  <em>int</em> <dfn class="local col4 decl" id="34mm" title='mm' data-type='int' data-ref="34mm" data-ref-filename="34mm">mm</dfn> = <a class="local col2 ref" href="#32mode" title='mode' data-ref="32mode" data-ref-filename="32mode">mode</a> &amp; <a class="macro" href="luajit.h.html#40" title="0x00ff" data-ref="_M/LUAJIT_MODE_MASK">LUAJIT_MODE_MASK</a>;</td></tr>
<tr><th id="243">243</th><td>  <a class="macro" href="lj_trace.h.html#45" title="((&amp;((GG_State *)((char *)(g) - ((int)__builtin_offsetof(GG_State, g))))-&gt;J)-&gt;state &amp;= ~LJ_TRACE_ACTIVE)" data-ref="_M/lj_trace_abort">lj_trace_abort</a>(<a class="local col3 ref" href="#33g" title='g' data-ref="33g" data-ref-filename="33g">g</a>);  <i>/* Abort recording on any state change. */</i></td></tr>
<tr><th id="244">244</th><td>  <i>/* Avoid pulling the rug from under our own feet. */</i></td></tr>
<tr><th id="245">245</th><td>  <b>if</b> ((<a class="local col3 ref" href="#33g" title='g' data-ref="33g" data-ref-filename="33g">g</a>-&gt;<a class="ref field" href="lj_obj.h.html#global_State::hookmask" title='global_State::hookmask' data-ref="global_State::hookmask" data-ref-filename="global_State..hookmask">hookmask</a> &amp; <a class="macro" href="lj_obj.h.html#670" title="0x40" data-ref="_M/HOOK_GC">HOOK_GC</a>))</td></tr>
<tr><th id="246">246</th><td>    <a class="ref fn" href="lj_err.h.html#lj_err_caller" title='lj_err_caller' data-ref="lj_err_caller" data-ref-filename="lj_err_caller">lj_err_caller</a>(<a class="local col0 ref" href="#30L" title='L' data-ref="30L" data-ref-filename="30L">L</a>, <a class="enum" href="lj_errmsg.h.html#59" title='LJ_ERR_NOGCMM' data-ref="LJ_ERR_NOGCMM" data-ref-filename="LJ_ERR_NOGCMM">LJ_ERR_NOGCMM</a>);</td></tr>
<tr><th id="247">247</th><td>  <b>switch</b> (<a class="local col4 ref" href="#34mm" title='mm' data-ref="34mm" data-ref-filename="34mm">mm</a>) {</td></tr>
<tr><th id="248">248</th><td><u>#<span data-ppcond="248">if</span> <a class="macro" href="lj_arch.h.html#542" title="1" data-ref="_M/LJ_HASJIT">LJ_HASJIT</a></u></td></tr>
<tr><th id="249">249</th><td>  <b>case</b> <a class="enum" href="luajit.h.html#LUAJIT_MODE_ENGINE" title='LUAJIT_MODE_ENGINE' data-ref="LUAJIT_MODE_ENGINE" data-ref-filename="LUAJIT_MODE_ENGINE">LUAJIT_MODE_ENGINE</a>:</td></tr>
<tr><th id="250">250</th><td>    <b>if</b> ((<a class="local col2 ref" href="#32mode" title='mode' data-ref="32mode" data-ref-filename="32mode">mode</a> &amp; <a class="macro" href="luajit.h.html#60" title="0x0200" data-ref="_M/LUAJIT_MODE_FLUSH">LUAJIT_MODE_FLUSH</a>)) {</td></tr>
<tr><th id="251">251</th><td>      <a class="ref fn" href="lj_trace.h.html#lj_trace_flushall" title='lj_trace_flushall' data-ref="lj_trace_flushall" data-ref-filename="lj_trace_flushall">lj_trace_flushall</a>(<a class="local col0 ref" href="#30L" title='L' data-ref="30L" data-ref-filename="30L">L</a>);</td></tr>
<tr><th id="252">252</th><td>    } <b>else</b> {</td></tr>
<tr><th id="253">253</th><td>      <b>if</b> (!(<a class="local col2 ref" href="#32mode" title='mode' data-ref="32mode" data-ref-filename="32mode">mode</a> &amp; <a class="macro" href="luajit.h.html#59" title="0x0100" data-ref="_M/LUAJIT_MODE_ON">LUAJIT_MODE_ON</a>))</td></tr>
<tr><th id="254">254</th><td>	<a class="macro" href="lj_dispatch.h.html#116" title="(&amp;((GG_State *)((char *)(g) - ((int)__builtin_offsetof(GG_State, g))))-&gt;J)" data-ref="_M/G2J">G2J</a>(<a class="local col3 ref" href="#33g" title='g' data-ref="33g" data-ref-filename="33g">g</a>)-&gt;<a class="ref field" href="lj_jit.h.html#jit_State::flags" title='jit_State::flags' data-ref="jit_State::flags" data-ref-filename="jit_State..flags">flags</a> &amp;= ~(<a class="typedef" href="../include/x86_64-linux-gnu/bits/stdint-uintn.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a>)<a class="macro" href="lj_jit.h.html#15" title="0x00000001" data-ref="_M/JIT_F_ON">JIT_F_ON</a>;</td></tr>
<tr><th id="255">255</th><td>      <b>else</b></td></tr>
<tr><th id="256">256</th><td>	<a class="macro" href="lj_dispatch.h.html#116" title="(&amp;((GG_State *)((char *)(g) - ((int)__builtin_offsetof(GG_State, g))))-&gt;J)" data-ref="_M/G2J">G2J</a>(<a class="local col3 ref" href="#33g" title='g' data-ref="33g" data-ref-filename="33g">g</a>)-&gt;<a class="ref field" href="lj_jit.h.html#jit_State::flags" title='jit_State::flags' data-ref="jit_State::flags" data-ref-filename="jit_State..flags">flags</a> |= (<a class="typedef" href="../include/x86_64-linux-gnu/bits/stdint-uintn.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a>)<a class="macro" href="lj_jit.h.html#15" title="0x00000001" data-ref="_M/JIT_F_ON">JIT_F_ON</a>;</td></tr>
<tr><th id="257">257</th><td>      <a class="ref fn" href="#lj_dispatch_update" title='lj_dispatch_update' data-ref="lj_dispatch_update" data-ref-filename="lj_dispatch_update">lj_dispatch_update</a>(<a class="local col3 ref" href="#33g" title='g' data-ref="33g" data-ref-filename="33g">g</a>);</td></tr>
<tr><th id="258">258</th><td>    }</td></tr>
<tr><th id="259">259</th><td>    <b>break</b>;</td></tr>
<tr><th id="260">260</th><td>  <b>case</b> <a class="enum" href="luajit.h.html#LUAJIT_MODE_FUNC" title='LUAJIT_MODE_FUNC' data-ref="LUAJIT_MODE_FUNC" data-ref-filename="LUAJIT_MODE_FUNC">LUAJIT_MODE_FUNC</a>:</td></tr>
<tr><th id="261">261</th><td>  <b>case</b> <a class="enum" href="luajit.h.html#LUAJIT_MODE_ALLFUNC" title='LUAJIT_MODE_ALLFUNC' data-ref="LUAJIT_MODE_ALLFUNC" data-ref-filename="LUAJIT_MODE_ALLFUNC">LUAJIT_MODE_ALLFUNC</a>:</td></tr>
<tr><th id="262">262</th><td>  <b>case</b> <a class="enum" href="luajit.h.html#LUAJIT_MODE_ALLSUBFUNC" title='LUAJIT_MODE_ALLSUBFUNC' data-ref="LUAJIT_MODE_ALLSUBFUNC" data-ref-filename="LUAJIT_MODE_ALLSUBFUNC">LUAJIT_MODE_ALLSUBFUNC</a>: {</td></tr>
<tr><th id="263">263</th><td>    <a class="typedef" href="lj_obj.h.html#cTValue" title='cTValue' data-type='const TValue' data-ref="cTValue" data-ref-filename="cTValue">cTValue</a> *<dfn class="local col5 decl" id="35tv" title='tv' data-type='cTValue *' data-ref="35tv" data-ref-filename="35tv">tv</dfn> = <a class="local col1 ref" href="#31idx" title='idx' data-ref="31idx" data-ref-filename="31idx">idx</a> == <var>0</var> ? <a class="macro" href="lj_frame.h.html#110" title="(((((ptrdiff_t)(L-&gt;base-1)-&gt;ftsz) &amp; 3) == FRAME_LUA)?((L-&gt;base-1) - (1+1+((BCReg)(((((const BCIns *)((ptrdiff_t)(L-&gt;base-1)-&gt;ftsz))[-1])&gt;&gt;8)&amp;0xff)))):((TValue *)((char *)(L-&gt;base-1) - (((ptrdiff_t)(L-&gt;base-1)-&gt;ftsz) &amp; ~(3|4)))))" data-ref="_M/frame_prev">frame_prev</a>(<a class="local col0 ref" href="#30L" title='L' data-ref="30L" data-ref-filename="30L">L</a>-&gt;<a class="ref field" href="lj_obj.h.html#lua_State::base" title='lua_State::base' data-ref="lua_State::base" data-ref-filename="lua_State..base">base</a>-<var>1</var>)-<a class="macro" href="lj_arch.h.html#533" title="1" data-ref="_M/LJ_FR2">LJ_FR2</a> :</td></tr>
<tr><th id="264">264</th><td>		  <a class="local col1 ref" href="#31idx" title='idx' data-ref="31idx" data-ref-filename="31idx">idx</a> &gt; <var>0</var> ? <a class="local col0 ref" href="#30L" title='L' data-ref="30L" data-ref-filename="30L">L</a>-&gt;<a class="ref field" href="lj_obj.h.html#lua_State::base" title='lua_State::base' data-ref="lua_State::base" data-ref-filename="lua_State..base">base</a> + (<a class="local col1 ref" href="#31idx" title='idx' data-ref="31idx" data-ref-filename="31idx">idx</a>-<var>1</var>) : <a class="local col0 ref" href="#30L" title='L' data-ref="30L" data-ref-filename="30L">L</a>-&gt;<a class="ref field" href="lj_obj.h.html#lua_State::top" title='lua_State::top' data-ref="lua_State::top" data-ref-filename="lua_State..top">top</a> + <a class="local col1 ref" href="#31idx" title='idx' data-ref="31idx" data-ref-filename="31idx">idx</a>;</td></tr>
<tr><th id="265">265</th><td>    <a class="typedef" href="lj_obj.h.html#GCproto" title='GCproto' data-type='struct GCproto' data-ref="GCproto" data-ref-filename="GCproto">GCproto</a> *<dfn class="local col6 decl" id="36pt" title='pt' data-type='GCproto *' data-ref="36pt" data-ref-filename="36pt">pt</dfn>;</td></tr>
<tr><th id="266">266</th><td>    <b>if</b> ((<a class="local col1 ref" href="#31idx" title='idx' data-ref="31idx" data-ref-filename="31idx">idx</a> == <var>0</var> || <a class="macro" href="lj_obj.h.html#790" title="(((uint32_t)((tv)-&gt;it64 &gt;&gt; 47)) == (~8u))" data-ref="_M/tvisfunc">tvisfunc</a>(<a class="local col5 ref" href="#35tv" title='tv' data-ref="35tv" data-ref-filename="35tv">tv</a>)) &amp;&amp; <a class="macro" href="lj_obj.h.html#473" title="((&amp;((GCobj *)((((tv)-&gt;gcr).gcptr64) &amp; (((uint64_t)1 &lt;&lt; 47) - 1)))-&gt;fn)-&gt;c.ffid == 0)" data-ref="_M/isluafunc">isluafunc</a>(&amp;<a class="macro" href="lj_obj.h.html#827" title="((GCobj *)((((tv)-&gt;gcr).gcptr64) &amp; (((uint64_t)1 &lt;&lt; 47) - 1)))" data-ref="_M/gcval">gcval</a>(<a class="local col5 ref" href="#35tv" title='tv' data-ref="35tv" data-ref-filename="35tv">tv</a>)-&gt;<a class="ref field" href="lj_obj.h.html#GCobj::fn" title='GCobj::fn' data-ref="GCobj::fn" data-ref-filename="GCobj..fn">fn</a>))</td></tr>
<tr><th id="267">267</th><td>      <a class="local col6 ref" href="#36pt" title='pt' data-ref="36pt" data-ref-filename="36pt">pt</a> = <a class="macro" href="lj_obj.h.html#476" title="((GCproto *)(((char *)(void *)((&amp;((GCobj *)((((tv)-&gt;gcr).gcptr64) &amp; (((uint64_t)1 &lt;&lt; 47) - 1)))-&gt;fn)-&gt;l.pc).ptr64)-sizeof(GCproto)))" data-ref="_M/funcproto">funcproto</a>(&amp;<a class="macro" href="lj_obj.h.html#827" title="((GCobj *)((((tv)-&gt;gcr).gcptr64) &amp; (((uint64_t)1 &lt;&lt; 47) - 1)))" data-ref="_M/gcval">gcval</a>(<a class="local col5 ref" href="#35tv" title='tv' data-ref="35tv" data-ref-filename="35tv">tv</a>)-&gt;<a class="ref field" href="lj_obj.h.html#GCobj::fn" title='GCobj::fn' data-ref="GCobj::fn" data-ref-filename="GCobj..fn">fn</a>);  <i>/* Cannot use funcV() for frame slot. */</i></td></tr>
<tr><th id="268">268</th><td>    <b>else</b> <b>if</b> (<a class="macro" href="lj_obj.h.html#792" title="(((uint32_t)((tv)-&gt;it64 &gt;&gt; 47)) == (~7u))" data-ref="_M/tvisproto">tvisproto</a>(<a class="local col5 ref" href="#35tv" title='tv' data-ref="35tv" data-ref-filename="35tv">tv</a>))</td></tr>
<tr><th id="269">269</th><td>      <a class="local col6 ref" href="#36pt" title='pt' data-ref="36pt" data-ref-filename="36pt">pt</a> = <a class="macro" href="lj_obj.h.html#855" title="(&amp;((GCobj *)((((tv)-&gt;gcr).gcptr64) &amp; (((uint64_t)1 &lt;&lt; 47) - 1)))-&gt;pt)" data-ref="_M/protoV">protoV</a>(<a class="local col5 ref" href="#35tv" title='tv' data-ref="35tv" data-ref-filename="35tv">tv</a>);</td></tr>
<tr><th id="270">270</th><td>    <b>else</b></td></tr>
<tr><th id="271">271</th><td>      <b>return</b> <var>0</var>;  <i>/* Failed. */</i></td></tr>
<tr><th id="272">272</th><td>    <b>if</b> (<a class="local col4 ref" href="#34mm" title='mm' data-ref="34mm" data-ref-filename="34mm">mm</a> != <a class="enum" href="luajit.h.html#LUAJIT_MODE_ALLSUBFUNC" title='LUAJIT_MODE_ALLSUBFUNC' data-ref="LUAJIT_MODE_ALLSUBFUNC" data-ref-filename="LUAJIT_MODE_ALLSUBFUNC">LUAJIT_MODE_ALLSUBFUNC</a>)</td></tr>
<tr><th id="273">273</th><td>      <a class="tu ref fn" href="#setptmode" title='setptmode' data-use='c' data-ref="setptmode" data-ref-filename="setptmode">setptmode</a>(<a class="local col3 ref" href="#33g" title='g' data-ref="33g" data-ref-filename="33g">g</a>, <a class="local col6 ref" href="#36pt" title='pt' data-ref="36pt" data-ref-filename="36pt">pt</a>, <a class="local col2 ref" href="#32mode" title='mode' data-ref="32mode" data-ref-filename="32mode">mode</a>);</td></tr>
<tr><th id="274">274</th><td>    <b>if</b> (<a class="local col4 ref" href="#34mm" title='mm' data-ref="34mm" data-ref-filename="34mm">mm</a> != <a class="enum" href="luajit.h.html#LUAJIT_MODE_FUNC" title='LUAJIT_MODE_FUNC' data-ref="LUAJIT_MODE_FUNC" data-ref-filename="LUAJIT_MODE_FUNC">LUAJIT_MODE_FUNC</a>)</td></tr>
<tr><th id="275">275</th><td>      <a class="tu ref fn" href="#setptmode_all" title='setptmode_all' data-use='c' data-ref="setptmode_all" data-ref-filename="setptmode_all">setptmode_all</a>(<a class="local col3 ref" href="#33g" title='g' data-ref="33g" data-ref-filename="33g">g</a>, <a class="local col6 ref" href="#36pt" title='pt' data-ref="36pt" data-ref-filename="36pt">pt</a>, <a class="local col2 ref" href="#32mode" title='mode' data-ref="32mode" data-ref-filename="32mode">mode</a>);</td></tr>
<tr><th id="276">276</th><td>    <b>break</b>;</td></tr>
<tr><th id="277">277</th><td>    }</td></tr>
<tr><th id="278">278</th><td>  <b>case</b> <a class="enum" href="luajit.h.html#LUAJIT_MODE_TRACE" title='LUAJIT_MODE_TRACE' data-ref="LUAJIT_MODE_TRACE" data-ref-filename="LUAJIT_MODE_TRACE">LUAJIT_MODE_TRACE</a>:</td></tr>
<tr><th id="279">279</th><td>    <b>if</b> (!(<a class="local col2 ref" href="#32mode" title='mode' data-ref="32mode" data-ref-filename="32mode">mode</a> &amp; <a class="macro" href="luajit.h.html#60" title="0x0200" data-ref="_M/LUAJIT_MODE_FLUSH">LUAJIT_MODE_FLUSH</a>))</td></tr>
<tr><th id="280">280</th><td>      <b>return</b> <var>0</var>;  <i>/* Failed. */</i></td></tr>
<tr><th id="281">281</th><td>    <a class="ref fn" href="lj_trace.h.html#lj_trace_flush" title='lj_trace_flush' data-ref="lj_trace_flush" data-ref-filename="lj_trace_flush">lj_trace_flush</a>(<a class="macro" href="lj_dispatch.h.html#116" title="(&amp;((GG_State *)((char *)(g) - ((int)__builtin_offsetof(GG_State, g))))-&gt;J)" data-ref="_M/G2J">G2J</a>(<a class="local col3 ref" href="#33g" title='g' data-ref="33g" data-ref-filename="33g">g</a>), <a class="local col1 ref" href="#31idx" title='idx' data-ref="31idx" data-ref-filename="31idx">idx</a>);</td></tr>
<tr><th id="282">282</th><td>    <b>break</b>;</td></tr>
<tr><th id="283">283</th><td><u>#<span data-ppcond="248">else</span></u></td></tr>
<tr><th id="284">284</th><td>  <b>case</b> LUAJIT_MODE_ENGINE:</td></tr>
<tr><th id="285">285</th><td>  <b>case</b> LUAJIT_MODE_FUNC:</td></tr>
<tr><th id="286">286</th><td>  <b>case</b> LUAJIT_MODE_ALLFUNC:</td></tr>
<tr><th id="287">287</th><td>  <b>case</b> LUAJIT_MODE_ALLSUBFUNC:</td></tr>
<tr><th id="288">288</th><td>    UNUSED(idx);</td></tr>
<tr><th id="289">289</th><td>    <b>if</b> ((mode &amp; LUAJIT_MODE_ON))</td></tr>
<tr><th id="290">290</th><td>      <b>return</b> <var>0</var>;  <i>/* Failed. */</i></td></tr>
<tr><th id="291">291</th><td>    <b>break</b>;</td></tr>
<tr><th id="292">292</th><td><u>#<span data-ppcond="248">endif</span></u></td></tr>
<tr><th id="293">293</th><td>  <b>case</b> <a class="enum" href="luajit.h.html#LUAJIT_MODE_WRAPCFUNC" title='LUAJIT_MODE_WRAPCFUNC' data-ref="LUAJIT_MODE_WRAPCFUNC" data-ref-filename="LUAJIT_MODE_WRAPCFUNC">LUAJIT_MODE_WRAPCFUNC</a>:</td></tr>
<tr><th id="294">294</th><td>    <b>if</b> ((<a class="local col2 ref" href="#32mode" title='mode' data-ref="32mode" data-ref-filename="32mode">mode</a> &amp; <a class="macro" href="luajit.h.html#59" title="0x0100" data-ref="_M/LUAJIT_MODE_ON">LUAJIT_MODE_ON</a>)) {</td></tr>
<tr><th id="295">295</th><td>      <b>if</b> (<a class="local col1 ref" href="#31idx" title='idx' data-ref="31idx" data-ref-filename="31idx">idx</a> != <var>0</var>) {</td></tr>
<tr><th id="296">296</th><td>	<a class="typedef" href="lj_obj.h.html#cTValue" title='cTValue' data-type='const TValue' data-ref="cTValue" data-ref-filename="cTValue">cTValue</a> *<dfn class="local col7 decl" id="37tv" title='tv' data-type='cTValue *' data-ref="37tv" data-ref-filename="37tv">tv</dfn> = <a class="local col1 ref" href="#31idx" title='idx' data-ref="31idx" data-ref-filename="31idx">idx</a> &gt; <var>0</var> ? <a class="local col0 ref" href="#30L" title='L' data-ref="30L" data-ref-filename="30L">L</a>-&gt;<a class="ref field" href="lj_obj.h.html#lua_State::base" title='lua_State::base' data-ref="lua_State::base" data-ref-filename="lua_State..base">base</a> + (<a class="local col1 ref" href="#31idx" title='idx' data-ref="31idx" data-ref-filename="31idx">idx</a>-<var>1</var>) : <a class="local col0 ref" href="#30L" title='L' data-ref="30L" data-ref-filename="30L">L</a>-&gt;<a class="ref field" href="lj_obj.h.html#lua_State::top" title='lua_State::top' data-ref="lua_State::top" data-ref-filename="lua_State..top">top</a> + <a class="local col1 ref" href="#31idx" title='idx' data-ref="31idx" data-ref-filename="31idx">idx</a>;</td></tr>
<tr><th id="297">297</th><td>	<b>if</b> (<a class="macro" href="lj_obj.h.html#787" title="(((uint32_t)((tv)-&gt;it64 &gt;&gt; 47)) == (~3u))" data-ref="_M/tvislightud">tvislightud</a>(<a class="local col7 ref" href="#37tv" title='tv' data-ref="37tv" data-ref-filename="37tv">tv</a>))</td></tr>
<tr><th id="298">298</th><td>	  <a class="local col3 ref" href="#33g" title='g' data-ref="33g" data-ref-filename="33g">g</a>-&gt;<a class="ref field" href="lj_obj.h.html#global_State::wrapf" title='global_State::wrapf' data-ref="global_State::wrapf" data-ref-filename="global_State..wrapf">wrapf</a> = (<a class="typedef" href="lua.h.html#lua_CFunction" title='lua_CFunction' data-type='int (*)(lua_State *)' data-ref="lua_CFunction" data-ref-filename="lua_CFunction">lua_CFunction</a>)<a class="ref fn" href="lj_obj.h.html#lightudV" title='lightudV' data-ref="lightudV" data-ref-filename="lightudV">lightudV</a>(<a class="local col3 ref" href="#33g" title='g' data-ref="33g" data-ref-filename="33g">g</a>, <a class="local col7 ref" href="#37tv" title='tv' data-ref="37tv" data-ref-filename="37tv">tv</a>);</td></tr>
<tr><th id="299">299</th><td>	<b>else</b></td></tr>
<tr><th id="300">300</th><td>	  <b>return</b> <var>0</var>;  <i>/* Failed. */</i></td></tr>
<tr><th id="301">301</th><td>      } <b>else</b> {</td></tr>
<tr><th id="302">302</th><td>	<b>return</b> <var>0</var>;  <i>/* Failed. */</i></td></tr>
<tr><th id="303">303</th><td>      }</td></tr>
<tr><th id="304">304</th><td>      <a class="local col3 ref" href="#33g" title='g' data-ref="33g" data-ref-filename="33g">g</a>-&gt;<a class="ref field" href="lj_obj.h.html#global_State::bc_cfunc_ext" title='global_State::bc_cfunc_ext' data-ref="global_State::bc_cfunc_ext" data-ref-filename="global_State..bc_cfunc_ext">bc_cfunc_ext</a> = <a class="macro" href="lj_bc.h.html#55" title="(((BCIns)(BC_FUNCCW))|((BCIns)(0)&lt;&lt;8)|((BCIns)(0)&lt;&lt;16))" data-ref="_M/BCINS_AD">BCINS_AD</a>(<a class="enum" href="lj_bc.h.html#202" title='BC_FUNCCW' data-ref="BC_FUNCCW" data-ref-filename="BC_FUNCCW">BC_FUNCCW</a>, <var>0</var>, <var>0</var>);</td></tr>
<tr><th id="305">305</th><td>    } <b>else</b> {</td></tr>
<tr><th id="306">306</th><td>      <a class="local col3 ref" href="#33g" title='g' data-ref="33g" data-ref-filename="33g">g</a>-&gt;<a class="ref field" href="lj_obj.h.html#global_State::bc_cfunc_ext" title='global_State::bc_cfunc_ext' data-ref="global_State::bc_cfunc_ext" data-ref-filename="global_State..bc_cfunc_ext">bc_cfunc_ext</a> = <a class="macro" href="lj_bc.h.html#55" title="(((BCIns)(BC_FUNCC))|((BCIns)(0)&lt;&lt;8)|((BCIns)(0)&lt;&lt;16))" data-ref="_M/BCINS_AD">BCINS_AD</a>(<a class="enum" href="lj_bc.h.html#202" title='BC_FUNCC' data-ref="BC_FUNCC" data-ref-filename="BC_FUNCC">BC_FUNCC</a>, <var>0</var>, <var>0</var>);</td></tr>
<tr><th id="307">307</th><td>    }</td></tr>
<tr><th id="308">308</th><td>    <b>break</b>;</td></tr>
<tr><th id="309">309</th><td>  <b>default</b>:</td></tr>
<tr><th id="310">310</th><td>    <b>return</b> <var>0</var>;  <i>/* Failed. */</i></td></tr>
<tr><th id="311">311</th><td>  }</td></tr>
<tr><th id="312">312</th><td>  <b>return</b> <var>1</var>;  <i>/* OK. */</i></td></tr>
<tr><th id="313">313</th><td>}</td></tr>
<tr><th id="314">314</th><td></td></tr>
<tr><th id="315">315</th><td><i>/* Enforce (dynamic) linker error for version mismatches. See luajit.c. */</i></td></tr>
<tr><th id="316">316</th><td><a class="macro" href="luaconf.h.html#134" title="extern" data-ref="_M/LUA_API">LUA_API</a> <em>void</em> <a class="macro" href="luajit.h.html#35" title="luaJIT_version_2_1_0_beta3" data-ref="_M/LUAJIT_VERSION_SYM">LUAJIT_VERSION_SYM</a>(<em>void</em>)</td></tr>
<tr><th id="317">317</th><td>{</td></tr>
<tr><th id="318">318</th><td>}</td></tr>
<tr><th id="319">319</th><td></td></tr>
<tr><th id="320">320</th><td><i>/* -- Hooks --------------------------------------------------------------- */</i></td></tr>
<tr><th id="321">321</th><td></td></tr>
<tr><th id="322">322</th><td><i>/* This function can be called asynchronously (e.g. during a signal). */</i></td></tr>
<tr><th id="323">323</th><td><a class="macro" href="luaconf.h.html#134" title="extern" data-ref="_M/LUA_API">LUA_API</a> <em>int</em> <dfn class="decl def fn" id="lua_sethook" title='lua_sethook' data-ref="lua_sethook" data-ref-filename="lua_sethook">lua_sethook</dfn>(<a class="typedef" href="lua.h.html#lua_State" title='lua_State' data-type='struct lua_State' data-ref="lua_State" data-ref-filename="lua_State">lua_State</a> *<dfn class="local col8 decl" id="38L" title='L' data-type='lua_State *' data-ref="38L" data-ref-filename="38L">L</dfn>, <a class="typedef" href="lua.h.html#lua_Hook" title='lua_Hook' data-type='void (*)(lua_State *, lua_Debug *)' data-ref="lua_Hook" data-ref-filename="lua_Hook">lua_Hook</a> <dfn class="local col9 decl" id="39func" title='func' data-type='lua_Hook' data-ref="39func" data-ref-filename="39func">func</dfn>, <em>int</em> <dfn class="local col0 decl" id="40mask" title='mask' data-type='int' data-ref="40mask" data-ref-filename="40mask">mask</dfn>, <em>int</em> <dfn class="local col1 decl" id="41count" title='count' data-type='int' data-ref="41count" data-ref-filename="41count">count</dfn>)</td></tr>
<tr><th id="324">324</th><td>{</td></tr>
<tr><th id="325">325</th><td>  <a class="typedef" href="lj_obj.h.html#global_State" title='global_State' data-type='struct global_State' data-ref="global_State" data-ref-filename="global_State">global_State</a> *<dfn class="local col2 decl" id="42g" title='g' data-type='global_State *' data-ref="42g" data-ref-filename="42g">g</dfn> = <a class="macro" href="lj_obj.h.html#699" title="(((global_State *)(void *)(L-&gt;glref).ptr64))" data-ref="_M/G">G</a>(<a class="local col8 ref" href="#38L" title='L' data-ref="38L" data-ref-filename="38L">L</a>);</td></tr>
<tr><th id="326">326</th><td>  <a class="local col0 ref" href="#40mask" title='mask' data-ref="40mask" data-ref-filename="40mask">mask</a> &amp;= <a class="macro" href="lj_obj.h.html#666" title="0x0f" data-ref="_M/HOOK_EVENTMASK">HOOK_EVENTMASK</a>;</td></tr>
<tr><th id="327">327</th><td>  <b>if</b> (<a class="local col9 ref" href="#39func" title='func' data-ref="39func" data-ref-filename="39func">func</a> == <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span> || <a class="local col0 ref" href="#40mask" title='mask' data-ref="40mask" data-ref-filename="40mask">mask</a> == <var>0</var>) { <a class="local col0 ref" href="#40mask" title='mask' data-ref="40mask" data-ref-filename="40mask">mask</a> = <var>0</var>; <a class="local col9 ref" href="#39func" title='func' data-ref="39func" data-ref-filename="39func">func</a> = <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>; }  <i>/* Consistency. */</i></td></tr>
<tr><th id="328">328</th><td>  <a class="local col2 ref" href="#42g" title='g' data-ref="42g" data-ref-filename="42g">g</a>-&gt;<a class="ref field" href="lj_obj.h.html#global_State::hookf" title='global_State::hookf' data-ref="global_State::hookf" data-ref-filename="global_State..hookf">hookf</a> = <a class="local col9 ref" href="#39func" title='func' data-ref="39func" data-ref-filename="39func">func</a>;</td></tr>
<tr><th id="329">329</th><td>  <a class="local col2 ref" href="#42g" title='g' data-ref="42g" data-ref-filename="42g">g</a>-&gt;<a class="ref field" href="lj_obj.h.html#global_State::hookcount" title='global_State::hookcount' data-ref="global_State::hookcount" data-ref-filename="global_State..hookcount">hookcount</a> = <a class="local col2 ref" href="#42g" title='g' data-ref="42g" data-ref-filename="42g">g</a>-&gt;<a class="ref field" href="lj_obj.h.html#global_State::hookcstart" title='global_State::hookcstart' data-ref="global_State::hookcstart" data-ref-filename="global_State..hookcstart">hookcstart</a> = (<a class="typedef" href="../include/x86_64-linux-gnu/bits/stdint-intn.h.html#int32_t" title='int32_t' data-type='__int32_t' data-ref="int32_t" data-ref-filename="int32_t">int32_t</a>)<a class="local col1 ref" href="#41count" title='count' data-ref="41count" data-ref-filename="41count">count</a>;</td></tr>
<tr><th id="330">330</th><td>  <a class="local col2 ref" href="#42g" title='g' data-ref="42g" data-ref-filename="42g">g</a>-&gt;<a class="ref field" href="lj_obj.h.html#global_State::hookmask" title='global_State::hookmask' data-ref="global_State::hookmask" data-ref-filename="global_State..hookmask">hookmask</a> = (<a class="typedef" href="../include/x86_64-linux-gnu/bits/stdint-uintn.h.html#uint8_t" title='uint8_t' data-type='__uint8_t' data-ref="uint8_t" data-ref-filename="uint8_t">uint8_t</a>)((<a class="local col2 ref" href="#42g" title='g' data-ref="42g" data-ref-filename="42g">g</a>-&gt;<a class="ref field" href="lj_obj.h.html#global_State::hookmask" title='global_State::hookmask' data-ref="global_State::hookmask" data-ref-filename="global_State..hookmask">hookmask</a> &amp; ~<a class="macro" href="lj_obj.h.html#666" title="0x0f" data-ref="_M/HOOK_EVENTMASK">HOOK_EVENTMASK</a>) | <a class="local col0 ref" href="#40mask" title='mask' data-ref="40mask" data-ref-filename="40mask">mask</a>);</td></tr>
<tr><th id="331">331</th><td>  <a class="macro" href="lj_trace.h.html#45" title="((&amp;((GG_State *)((char *)(g) - ((int)__builtin_offsetof(GG_State, g))))-&gt;J)-&gt;state &amp;= ~LJ_TRACE_ACTIVE)" data-ref="_M/lj_trace_abort">lj_trace_abort</a>(<a class="local col2 ref" href="#42g" title='g' data-ref="42g" data-ref-filename="42g">g</a>);  <i>/* Abort recording on any hook change. */</i></td></tr>
<tr><th id="332">332</th><td>  <a class="ref fn" href="#lj_dispatch_update" title='lj_dispatch_update' data-ref="lj_dispatch_update" data-ref-filename="lj_dispatch_update">lj_dispatch_update</a>(<a class="local col2 ref" href="#42g" title='g' data-ref="42g" data-ref-filename="42g">g</a>);</td></tr>
<tr><th id="333">333</th><td>  <b>return</b> <var>1</var>;</td></tr>
<tr><th id="334">334</th><td>}</td></tr>
<tr><th id="335">335</th><td></td></tr>
<tr><th id="336">336</th><td><a class="macro" href="luaconf.h.html#134" title="extern" data-ref="_M/LUA_API">LUA_API</a> <a class="typedef" href="lua.h.html#lua_Hook" title='lua_Hook' data-type='void (*)(lua_State *, lua_Debug *)' data-ref="lua_Hook" data-ref-filename="lua_Hook">lua_Hook</a> <dfn class="decl def fn" id="lua_gethook" title='lua_gethook' data-ref="lua_gethook" data-ref-filename="lua_gethook">lua_gethook</dfn>(<a class="typedef" href="lua.h.html#lua_State" title='lua_State' data-type='struct lua_State' data-ref="lua_State" data-ref-filename="lua_State">lua_State</a> *<dfn class="local col3 decl" id="43L" title='L' data-type='lua_State *' data-ref="43L" data-ref-filename="43L">L</dfn>)</td></tr>
<tr><th id="337">337</th><td>{</td></tr>
<tr><th id="338">338</th><td>  <b>return</b> <a class="macro" href="lj_obj.h.html#699" title="(((global_State *)(void *)(L-&gt;glref).ptr64))" data-ref="_M/G">G</a>(<a class="local col3 ref" href="#43L" title='L' data-ref="43L" data-ref-filename="43L">L</a>)-&gt;<a class="ref field" href="lj_obj.h.html#global_State::hookf" title='global_State::hookf' data-ref="global_State::hookf" data-ref-filename="global_State..hookf">hookf</a>;</td></tr>
<tr><th id="339">339</th><td>}</td></tr>
<tr><th id="340">340</th><td></td></tr>
<tr><th id="341">341</th><td><a class="macro" href="luaconf.h.html#134" title="extern" data-ref="_M/LUA_API">LUA_API</a> <em>int</em> <dfn class="decl def fn" id="lua_gethookmask" title='lua_gethookmask' data-ref="lua_gethookmask" data-ref-filename="lua_gethookmask">lua_gethookmask</dfn>(<a class="typedef" href="lua.h.html#lua_State" title='lua_State' data-type='struct lua_State' data-ref="lua_State" data-ref-filename="lua_State">lua_State</a> *<dfn class="local col4 decl" id="44L" title='L' data-type='lua_State *' data-ref="44L" data-ref-filename="44L">L</dfn>)</td></tr>
<tr><th id="342">342</th><td>{</td></tr>
<tr><th id="343">343</th><td>  <b>return</b> <a class="macro" href="lj_obj.h.html#699" title="(((global_State *)(void *)(L-&gt;glref).ptr64))" data-ref="_M/G">G</a>(<a class="local col4 ref" href="#44L" title='L' data-ref="44L" data-ref-filename="44L">L</a>)-&gt;<a class="ref field" href="lj_obj.h.html#global_State::hookmask" title='global_State::hookmask' data-ref="global_State::hookmask" data-ref-filename="global_State..hookmask">hookmask</a> &amp; <a class="macro" href="lj_obj.h.html#666" title="0x0f" data-ref="_M/HOOK_EVENTMASK">HOOK_EVENTMASK</a>;</td></tr>
<tr><th id="344">344</th><td>}</td></tr>
<tr><th id="345">345</th><td></td></tr>
<tr><th id="346">346</th><td><a class="macro" href="luaconf.h.html#134" title="extern" data-ref="_M/LUA_API">LUA_API</a> <em>int</em> <dfn class="decl def fn" id="lua_gethookcount" title='lua_gethookcount' data-ref="lua_gethookcount" data-ref-filename="lua_gethookcount">lua_gethookcount</dfn>(<a class="typedef" href="lua.h.html#lua_State" title='lua_State' data-type='struct lua_State' data-ref="lua_State" data-ref-filename="lua_State">lua_State</a> *<dfn class="local col5 decl" id="45L" title='L' data-type='lua_State *' data-ref="45L" data-ref-filename="45L">L</dfn>)</td></tr>
<tr><th id="347">347</th><td>{</td></tr>
<tr><th id="348">348</th><td>  <b>return</b> (<em>int</em>)<a class="macro" href="lj_obj.h.html#699" title="(((global_State *)(void *)(L-&gt;glref).ptr64))" data-ref="_M/G">G</a>(<a class="local col5 ref" href="#45L" title='L' data-ref="45L" data-ref-filename="45L">L</a>)-&gt;<a class="ref field" href="lj_obj.h.html#global_State::hookcstart" title='global_State::hookcstart' data-ref="global_State::hookcstart" data-ref-filename="global_State..hookcstart">hookcstart</a>;</td></tr>
<tr><th id="349">349</th><td>}</td></tr>
<tr><th id="350">350</th><td></td></tr>
<tr><th id="351">351</th><td><i  data-doc="callhook">/* Call a hook. */</i></td></tr>
<tr><th id="352">352</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="callhook" title='callhook' data-type='void callhook(lua_State * L, int event, BCLine line)' data-ref="callhook" data-ref-filename="callhook">callhook</dfn>(<a class="typedef" href="lua.h.html#lua_State" title='lua_State' data-type='struct lua_State' data-ref="lua_State" data-ref-filename="lua_State">lua_State</a> *<dfn class="local col6 decl" id="46L" title='L' data-type='lua_State *' data-ref="46L" data-ref-filename="46L">L</dfn>, <em>int</em> <dfn class="local col7 decl" id="47event" title='event' data-type='int' data-ref="47event" data-ref-filename="47event">event</dfn>, <a class="typedef" href="lj_obj.h.html#BCLine" title='BCLine' data-type='int32_t' data-ref="BCLine" data-ref-filename="BCLine">BCLine</a> <dfn class="local col8 decl" id="48line" title='line' data-type='BCLine' data-ref="48line" data-ref-filename="48line">line</dfn>)</td></tr>
<tr><th id="353">353</th><td>{</td></tr>
<tr><th id="354">354</th><td>  <a class="typedef" href="lj_obj.h.html#global_State" title='global_State' data-type='struct global_State' data-ref="global_State" data-ref-filename="global_State">global_State</a> *<dfn class="local col9 decl" id="49g" title='g' data-type='global_State *' data-ref="49g" data-ref-filename="49g">g</dfn> = <a class="macro" href="lj_obj.h.html#699" title="(((global_State *)(void *)(L-&gt;glref).ptr64))" data-ref="_M/G">G</a>(<a class="local col6 ref" href="#46L" title='L' data-ref="46L" data-ref-filename="46L">L</a>);</td></tr>
<tr><th id="355">355</th><td>  <a class="typedef" href="lua.h.html#lua_Hook" title='lua_Hook' data-type='void (*)(lua_State *, lua_Debug *)' data-ref="lua_Hook" data-ref-filename="lua_Hook">lua_Hook</a> <dfn class="local col0 decl" id="50hookf" title='hookf' data-type='lua_Hook' data-ref="50hookf" data-ref-filename="50hookf">hookf</dfn> = <a class="local col9 ref" href="#49g" title='g' data-ref="49g" data-ref-filename="49g">g</a>-&gt;<a class="ref field" href="lj_obj.h.html#global_State::hookf" title='global_State::hookf' data-ref="global_State::hookf" data-ref-filename="global_State..hookf">hookf</a>;</td></tr>
<tr><th id="356">356</th><td>  <b>if</b> (<a class="local col0 ref" href="#50hookf" title='hookf' data-ref="50hookf" data-ref-filename="50hookf">hookf</a> &amp;&amp; !<a class="macro" href="lj_obj.h.html#672" title="((g)-&gt;hookmask &amp; 0x10)" data-ref="_M/hook_active">hook_active</a>(<a class="local col9 ref" href="#49g" title='g' data-ref="49g" data-ref-filename="49g">g</a>)) {</td></tr>
<tr><th id="357">357</th><td>    <a class="typedef" href="lua.h.html#lua_Debug" title='lua_Debug' data-type='struct lua_Debug' data-ref="lua_Debug" data-ref-filename="lua_Debug">lua_Debug</a> <dfn class="local col1 decl" id="51ar" title='ar' data-type='lua_Debug' data-ref="51ar" data-ref-filename="51ar">ar</dfn>;</td></tr>
<tr><th id="358">358</th><td>    <a class="macro" href="lj_trace.h.html#45" title="((&amp;((GG_State *)((char *)(g) - ((int)__builtin_offsetof(GG_State, g))))-&gt;J)-&gt;state &amp;= ~LJ_TRACE_ACTIVE)" data-ref="_M/lj_trace_abort">lj_trace_abort</a>(<a class="local col9 ref" href="#49g" title='g' data-ref="49g" data-ref-filename="49g">g</a>);  <i>/* Abort recording on any hook call. */</i></td></tr>
<tr><th id="359">359</th><td>    <a class="local col1 ref" href="#51ar" title='ar' data-ref="51ar" data-ref-filename="51ar">ar</a>.<a class="ref field" href="lua.h.html#lua_Debug::event" title='lua_Debug::event' data-ref="lua_Debug::event" data-ref-filename="lua_Debug..event">event</a> = <a class="local col7 ref" href="#47event" title='event' data-ref="47event" data-ref-filename="47event">event</a>;</td></tr>
<tr><th id="360">360</th><td>    <a class="local col1 ref" href="#51ar" title='ar' data-ref="51ar" data-ref-filename="51ar">ar</a>.<a class="ref field" href="lua.h.html#lua_Debug::currentline" title='lua_Debug::currentline' data-ref="lua_Debug::currentline" data-ref-filename="lua_Debug..currentline">currentline</a> = <a class="local col8 ref" href="#48line" title='line' data-ref="48line" data-ref-filename="48line">line</a>;</td></tr>
<tr><th id="361">361</th><td>    <i>/* Top frame, nextframe = NULL. */</i></td></tr>
<tr><th id="362">362</th><td>    <a class="local col1 ref" href="#51ar" title='ar' data-ref="51ar" data-ref-filename="51ar">ar</a>.<a class="ref field" href="lua.h.html#lua_Debug::i_ci" title='lua_Debug::i_ci' data-ref="lua_Debug::i_ci" data-ref-filename="lua_Debug..i_ci">i_ci</a> = (<em>int</em>)((<a class="local col6 ref" href="#46L" title='L' data-ref="46L" data-ref-filename="46L">L</a>-&gt;<a class="ref field" href="lj_obj.h.html#lua_State::base" title='lua_State::base' data-ref="lua_State::base" data-ref-filename="lua_State..base">base</a>-<var>1</var>) - <a class="macro" href="lj_obj.h.html#217" title="(((TValue *)(void *)(L-&gt;stack).ptr64))" data-ref="_M/tvref">tvref</a>(<a class="local col6 ref" href="#46L" title='L' data-ref="46L" data-ref-filename="46L">L</a>-&gt;<a class="ref field" href="lj_obj.h.html#lua_State::stack" title='lua_State::stack' data-ref="lua_State::stack" data-ref-filename="lua_State..stack">stack</a>));</td></tr>
<tr><th id="363">363</th><td>    <a class="ref fn" href="lj_state.h.html#lj_state_checkstack" title='lj_state_checkstack' data-ref="lj_state_checkstack" data-ref-filename="lj_state_checkstack">lj_state_checkstack</a>(<a class="local col6 ref" href="#46L" title='L' data-ref="46L" data-ref-filename="46L">L</a>, <var>1</var>+<a class="macro" href="lua.h.html#88" title="20" data-ref="_M/LUA_MINSTACK">LUA_MINSTACK</a>);</td></tr>
<tr><th id="364">364</th><td><u>#<span data-ppcond="364">if</span> <a class="macro" href="lj_arch.h.html#562" title="1" data-ref="_M/LJ_HASPROFILE">LJ_HASPROFILE</a> &amp;&amp; !<a class="macro" href="lj_arch.h.html#563" title="1" data-ref="_M/LJ_PROFILE_SIGPROF">LJ_PROFILE_SIGPROF</a></u></td></tr>
<tr><th id="365">365</th><td>    lj_profile_hook_enter(g);</td></tr>
<tr><th id="366">366</th><td><u>#<span data-ppcond="364">else</span></u></td></tr>
<tr><th id="367">367</th><td>    <a class="macro" href="lj_obj.h.html#673" title="((g)-&gt;hookmask |= 0x10)" data-ref="_M/hook_enter">hook_enter</a>(<a class="local col9 ref" href="#49g" title='g' data-ref="49g" data-ref-filename="49g">g</a>);</td></tr>
<tr><th id="368">368</th><td><u>#<span data-ppcond="364">endif</span></u></td></tr>
<tr><th id="369">369</th><td>    <a class="local col0 ref" href="#50hookf" title='hookf' data-ref="50hookf" data-ref-filename="50hookf">hookf</a>(<a class="local col6 ref" href="#46L" title='L' data-ref="46L" data-ref-filename="46L">L</a>, &amp;<a class="local col1 ref" href="#51ar" title='ar' data-ref="51ar" data-ref-filename="51ar">ar</a>);</td></tr>
<tr><th id="370">370</th><td>    <a class="macro" href="lj_def.h.html#359" title="((void)g)" data-ref="_M/lj_assertG">lj_assertG</a>(hook_active(g), <q>"active hook flag removed"</q>);</td></tr>
<tr><th id="371">371</th><td>    <a class="macro" href="lj_obj.h.html#72" title="((g-&gt;cur_L).gcptr64 = (uint64_t)&amp;(((GCobj *)(L)))-&gt;gch)" data-ref="_M/setgcref">setgcref</a>(<a class="local col9 ref" href="#49g" title='g' data-ref="49g" data-ref-filename="49g">g</a>-&gt;<a class="ref field" href="lj_obj.h.html#global_State::cur_L" title='global_State::cur_L' data-ref="global_State::cur_L" data-ref-filename="global_State..cur_L">cur_L</a>, <a class="macro" href="lj_obj.h.html#769" title="((GCobj *)(L))" data-ref="_M/obj2gco">obj2gco</a>(<a class="local col6 ref" href="#46L" title='L' data-ref="46L" data-ref-filename="46L">L</a>));</td></tr>
<tr><th id="372">372</th><td><u>#<span data-ppcond="372">if</span> <a class="macro" href="lj_arch.h.html#562" title="1" data-ref="_M/LJ_HASPROFILE">LJ_HASPROFILE</a> &amp;&amp; !<a class="macro" href="lj_arch.h.html#563" title="1" data-ref="_M/LJ_PROFILE_SIGPROF">LJ_PROFILE_SIGPROF</a></u></td></tr>
<tr><th id="373">373</th><td>    lj_profile_hook_leave(g);</td></tr>
<tr><th id="374">374</th><td><u>#<span data-ppcond="372">else</span></u></td></tr>
<tr><th id="375">375</th><td>    <a class="macro" href="lj_obj.h.html#677" title="((g)-&gt;hookmask &amp;= ~0x10)" data-ref="_M/hook_leave">hook_leave</a>(<a class="local col9 ref" href="#49g" title='g' data-ref="49g" data-ref-filename="49g">g</a>);</td></tr>
<tr><th id="376">376</th><td><u>#<span data-ppcond="372">endif</span></u></td></tr>
<tr><th id="377">377</th><td>  }</td></tr>
<tr><th id="378">378</th><td>}</td></tr>
<tr><th id="379">379</th><td></td></tr>
<tr><th id="380">380</th><td><i>/* -- Dispatch callbacks -------------------------------------------------- */</i></td></tr>
<tr><th id="381">381</th><td></td></tr>
<tr><th id="382">382</th><td><i  data-doc="cur_topslot">/* Calculate number of used stack slots in the current frame. */</i></td></tr>
<tr><th id="383">383</th><td><em>static</em> <a class="typedef" href="lj_obj.h.html#BCReg" title='BCReg' data-type='uint32_t' data-ref="BCReg" data-ref-filename="BCReg">BCReg</a> <dfn class="tu decl def fn" id="cur_topslot" title='cur_topslot' data-type='BCReg cur_topslot(GCproto * pt, const BCIns * pc, uint32_t nres)' data-ref="cur_topslot" data-ref-filename="cur_topslot">cur_topslot</dfn>(<a class="typedef" href="lj_obj.h.html#GCproto" title='GCproto' data-type='struct GCproto' data-ref="GCproto" data-ref-filename="GCproto">GCproto</a> *<dfn class="local col2 decl" id="52pt" title='pt' data-type='GCproto *' data-ref="52pt" data-ref-filename="52pt">pt</dfn>, <em>const</em> <a class="typedef" href="lj_obj.h.html#BCIns" title='BCIns' data-type='uint32_t' data-ref="BCIns" data-ref-filename="BCIns">BCIns</a> *<dfn class="local col3 decl" id="53pc" title='pc' data-type='const BCIns *' data-ref="53pc" data-ref-filename="53pc">pc</dfn>, <a class="typedef" href="../include/x86_64-linux-gnu/bits/stdint-uintn.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col4 decl" id="54nres" title='nres' data-type='uint32_t' data-ref="54nres" data-ref-filename="54nres">nres</dfn>)</td></tr>
<tr><th id="384">384</th><td>{</td></tr>
<tr><th id="385">385</th><td>  <a class="typedef" href="lj_obj.h.html#BCIns" title='BCIns' data-type='uint32_t' data-ref="BCIns" data-ref-filename="BCIns">BCIns</a> <dfn class="local col5 decl" id="55ins" title='ins' data-type='BCIns' data-ref="55ins" data-ref-filename="55ins">ins</dfn> = <a class="local col3 ref" href="#53pc" title='pc' data-ref="53pc" data-ref-filename="53pc">pc</a>[-<var>1</var>];</td></tr>
<tr><th id="386">386</th><td>  <b>if</b> (<a class="macro" href="lj_bc.h.html#34" title="((BCOp)((ins)&amp;0xff))" data-ref="_M/bc_op">bc_op</a>(<a class="local col5 ref" href="#55ins" title='ins' data-ref="55ins" data-ref-filename="55ins">ins</a>) == <a class="enum" href="lj_bc.h.html#202" title='BC_UCLO' data-ref="BC_UCLO" data-ref-filename="BC_UCLO">BC_UCLO</a>)</td></tr>
<tr><th id="387">387</th><td>    <a class="local col5 ref" href="#55ins" title='ins' data-ref="55ins" data-ref-filename="55ins">ins</a> = <a class="local col3 ref" href="#53pc" title='pc' data-ref="53pc" data-ref-filename="53pc">pc</a>[<a class="macro" href="lj_bc.h.html#39" title="((ptrdiff_t)((BCReg)((ins)&gt;&gt;16))-0x8000)" data-ref="_M/bc_j">bc_j</a>(<a class="local col5 ref" href="#55ins" title='ins' data-ref="55ins" data-ref-filename="55ins">ins</a>)];</td></tr>
<tr><th id="388">388</th><td>  <b>switch</b> (<a class="macro" href="lj_bc.h.html#34" title="((BCOp)((ins)&amp;0xff))" data-ref="_M/bc_op">bc_op</a>(<a class="local col5 ref" href="#55ins" title='ins' data-ref="55ins" data-ref-filename="55ins">ins</a>)) {</td></tr>
<tr><th id="389">389</th><td>  <b>case</b> <a class="enum" href="lj_bc.h.html#202" title='BC_CALLM' data-ref="BC_CALLM" data-ref-filename="BC_CALLM">BC_CALLM</a>: <b>case</b> <a class="enum" href="lj_bc.h.html#202" title='BC_CALLMT' data-ref="BC_CALLMT" data-ref-filename="BC_CALLMT">BC_CALLMT</a>: <b>return</b> <a class="macro" href="lj_bc.h.html#35" title="((BCReg)(((ins)&gt;&gt;8)&amp;0xff))" data-ref="_M/bc_a">bc_a</a>(<a class="local col5 ref" href="#55ins" title='ins' data-ref="55ins" data-ref-filename="55ins">ins</a>) + <a class="macro" href="lj_bc.h.html#37" title="((BCReg)(((ins)&gt;&gt;16)&amp;0xff))" data-ref="_M/bc_c">bc_c</a>(<a class="local col5 ref" href="#55ins" title='ins' data-ref="55ins" data-ref-filename="55ins">ins</a>) + <a class="local col4 ref" href="#54nres" title='nres' data-ref="54nres" data-ref-filename="54nres">nres</a>-<var>1</var>+<var>1</var>+<a class="macro" href="lj_arch.h.html#533" title="1" data-ref="_M/LJ_FR2">LJ_FR2</a>;</td></tr>
<tr><th id="390">390</th><td>  <b>case</b> <a class="enum" href="lj_bc.h.html#202" title='BC_RETM' data-ref="BC_RETM" data-ref-filename="BC_RETM">BC_RETM</a>: <b>return</b> <a class="macro" href="lj_bc.h.html#35" title="((BCReg)(((ins)&gt;&gt;8)&amp;0xff))" data-ref="_M/bc_a">bc_a</a>(<a class="local col5 ref" href="#55ins" title='ins' data-ref="55ins" data-ref-filename="55ins">ins</a>) + <a class="macro" href="lj_bc.h.html#38" title="((BCReg)((ins)&gt;&gt;16))" data-ref="_M/bc_d">bc_d</a>(<a class="local col5 ref" href="#55ins" title='ins' data-ref="55ins" data-ref-filename="55ins">ins</a>) + <a class="local col4 ref" href="#54nres" title='nres' data-ref="54nres" data-ref-filename="54nres">nres</a>-<var>1</var>;</td></tr>
<tr><th id="391">391</th><td>  <b>case</b> <a class="enum" href="lj_bc.h.html#202" title='BC_TSETM' data-ref="BC_TSETM" data-ref-filename="BC_TSETM">BC_TSETM</a>: <b>return</b> <a class="macro" href="lj_bc.h.html#35" title="((BCReg)(((ins)&gt;&gt;8)&amp;0xff))" data-ref="_M/bc_a">bc_a</a>(<a class="local col5 ref" href="#55ins" title='ins' data-ref="55ins" data-ref-filename="55ins">ins</a>) + <a class="local col4 ref" href="#54nres" title='nres' data-ref="54nres" data-ref-filename="54nres">nres</a>-<var>1</var>;</td></tr>
<tr><th id="392">392</th><td>  <b>default</b>: <b>return</b> <a class="local col2 ref" href="#52pt" title='pt' data-ref="52pt" data-ref-filename="52pt">pt</a>-&gt;<a class="ref field" href="lj_obj.h.html#GCproto::framesize" title='GCproto::framesize' data-ref="GCproto::framesize" data-ref-filename="GCproto..framesize">framesize</a>;</td></tr>
<tr><th id="393">393</th><td>  }</td></tr>
<tr><th id="394">394</th><td>}</td></tr>
<tr><th id="395">395</th><td></td></tr>
<tr><th id="396">396</th><td><i>/* Instruction dispatch. Used by instr/line/return hooks or when recording. */</i></td></tr>
<tr><th id="397">397</th><td><em>void</em> <a class="macro" href="lj_def.h.html#314" title="" data-ref="_M/LJ_FASTCALL">LJ_FASTCALL</a> <dfn class="decl def fn" id="lj_dispatch_ins" title='lj_dispatch_ins' data-ref="lj_dispatch_ins" data-ref-filename="lj_dispatch_ins">lj_dispatch_ins</dfn>(<a class="typedef" href="lua.h.html#lua_State" title='lua_State' data-type='struct lua_State' data-ref="lua_State" data-ref-filename="lua_State">lua_State</a> *<dfn class="local col6 decl" id="56L" title='L' data-type='lua_State *' data-ref="56L" data-ref-filename="56L">L</dfn>, <em>const</em> <a class="typedef" href="lj_obj.h.html#BCIns" title='BCIns' data-type='uint32_t' data-ref="BCIns" data-ref-filename="BCIns">BCIns</a> *<dfn class="local col7 decl" id="57pc" title='pc' data-type='const BCIns *' data-ref="57pc" data-ref-filename="57pc">pc</dfn>)</td></tr>
<tr><th id="398">398</th><td>{</td></tr>
<tr><th id="399">399</th><td>  <a class="macro" href="lj_dispatch.h.html#156" title="int olderr = (*__errno_location ());" data-ref="_M/ERRNO_SAVE">ERRNO_SAVE</a></td></tr>
<tr><th id="400">400</th><td>  <a class="typedef" href="lj_obj.h.html#GCfunc" title='GCfunc' data-type='union GCfunc' data-ref="GCfunc" data-ref-filename="GCfunc">GCfunc</a> *<dfn class="local col8 decl" id="58fn" title='fn' data-type='GCfunc *' data-ref="58fn" data-ref-filename="58fn">fn</dfn> = <a class="macro" href="lj_obj.h.html#704" title="(&amp;((GCobj *)((((L-&gt;base-2)-&gt;gcr).gcptr64) &amp; (((uint64_t)1 &lt;&lt; 47) - 1)))-&gt;fn)" data-ref="_M/curr_func">curr_func</a>(<a class="local col6 ref" href="#56L" title='L' data-ref="56L" data-ref-filename="56L">L</a>);</td></tr>
<tr><th id="401">401</th><td>  <a class="typedef" href="lj_obj.h.html#GCproto" title='GCproto' data-type='struct GCproto' data-ref="GCproto" data-ref-filename="GCproto">GCproto</a> *<dfn class="local col9 decl" id="59pt" title='pt' data-type='GCproto *' data-ref="59pt" data-ref-filename="59pt">pt</dfn> = <a class="macro" href="lj_obj.h.html#476" title="((GCproto *)(((char *)(void *)((fn)-&gt;l.pc).ptr64)-sizeof(GCproto)))" data-ref="_M/funcproto">funcproto</a>(<a class="local col8 ref" href="#58fn" title='fn' data-ref="58fn" data-ref-filename="58fn">fn</a>);</td></tr>
<tr><th id="402">402</th><td>  <em>void</em> *<dfn class="local col0 decl" id="60cf" title='cf' data-type='void *' data-ref="60cf" data-ref-filename="60cf">cf</dfn> = <a class="macro" href="lj_frame.h.html#294" title="((void *)((intptr_t)(L-&gt;cframe) &amp; (~(intptr_t)(1|2))))" data-ref="_M/cframe_raw">cframe_raw</a>(<a class="local col6 ref" href="#56L" title='L' data-ref="56L" data-ref-filename="56L">L</a>-&gt;<a class="ref field" href="lj_obj.h.html#lua_State::cframe" title='lua_State::cframe' data-ref="lua_State::cframe" data-ref-filename="lua_State..cframe">cframe</a>);</td></tr>
<tr><th id="403">403</th><td>  <em>const</em> <a class="typedef" href="lj_obj.h.html#BCIns" title='BCIns' data-type='uint32_t' data-ref="BCIns" data-ref-filename="BCIns">BCIns</a> *<dfn class="local col1 decl" id="61oldpc" title='oldpc' data-type='const BCIns *' data-ref="61oldpc" data-ref-filename="61oldpc">oldpc</dfn> = <a class="macro" href="lj_frame.h.html#286" title="(((const BCIns *)(void *)(*(MRef *)(((char *)(cf))+(3*8))).ptr64))" data-ref="_M/cframe_pc">cframe_pc</a>(<a class="local col0 ref" href="#60cf" title='cf' data-ref="60cf" data-ref-filename="60cf">cf</a>);</td></tr>
<tr><th id="404">404</th><td>  <a class="typedef" href="lj_obj.h.html#global_State" title='global_State' data-type='struct global_State' data-ref="global_State" data-ref-filename="global_State">global_State</a> *<dfn class="local col2 decl" id="62g" title='g' data-type='global_State *' data-ref="62g" data-ref-filename="62g">g</dfn> = <a class="macro" href="lj_obj.h.html#699" title="(((global_State *)(void *)(L-&gt;glref).ptr64))" data-ref="_M/G">G</a>(<a class="local col6 ref" href="#56L" title='L' data-ref="56L" data-ref-filename="56L">L</a>);</td></tr>
<tr><th id="405">405</th><td>  <a class="typedef" href="lj_obj.h.html#BCReg" title='BCReg' data-type='uint32_t' data-ref="BCReg" data-ref-filename="BCReg">BCReg</a> <dfn class="local col3 decl" id="63slots" title='slots' data-type='BCReg' data-ref="63slots" data-ref-filename="63slots">slots</dfn>;</td></tr>
<tr><th id="406">406</th><td>  <a class="macro" href="lj_frame.h.html#290" title="(((*(MRef *)(((char *)(cf))+(3*8))).ptr64 = (uint64_t)(void *)((pc))))" data-ref="_M/setcframe_pc">setcframe_pc</a>(<a class="local col0 ref" href="#60cf" title='cf' data-ref="60cf" data-ref-filename="60cf">cf</a>, <a class="local col7 ref" href="#57pc" title='pc' data-ref="57pc" data-ref-filename="57pc">pc</a>);</td></tr>
<tr><th id="407">407</th><td>  <a class="local col3 ref" href="#63slots" title='slots' data-ref="63slots" data-ref-filename="63slots">slots</a> = <a class="tu ref fn" href="#cur_topslot" title='cur_topslot' data-use='c' data-ref="cur_topslot" data-ref-filename="cur_topslot">cur_topslot</a>(<a class="local col9 ref" href="#59pt" title='pt' data-ref="59pt" data-ref-filename="59pt">pt</a>, <a class="local col7 ref" href="#57pc" title='pc' data-ref="57pc" data-ref-filename="57pc">pc</a>, <a class="macro" href="lj_frame.h.html#283" title="((*(uint32_t *)(((char *)((cf)))+(0*4))) &gt;&gt; 0)" data-ref="_M/cframe_multres_n">cframe_multres_n</a>(<a class="local col0 ref" href="#60cf" title='cf' data-ref="60cf" data-ref-filename="60cf">cf</a>));</td></tr>
<tr><th id="408">408</th><td>  <a class="local col6 ref" href="#56L" title='L' data-ref="56L" data-ref-filename="56L">L</a>-&gt;<a class="ref field" href="lj_obj.h.html#lua_State::top" title='lua_State::top' data-ref="lua_State::top" data-ref-filename="lua_State..top">top</a> = <a class="local col6 ref" href="#56L" title='L' data-ref="56L" data-ref-filename="56L">L</a>-&gt;<a class="ref field" href="lj_obj.h.html#lua_State::base" title='lua_State::base' data-ref="lua_State::base" data-ref-filename="lua_State..base">base</a> + <a class="local col3 ref" href="#63slots" title='slots' data-ref="63slots" data-ref-filename="63slots">slots</a>;  <i>/* Fix top. */</i></td></tr>
<tr><th id="409">409</th><td><u>#<span data-ppcond="409">if</span> <a class="macro" href="lj_arch.h.html#542" title="1" data-ref="_M/LJ_HASJIT">LJ_HASJIT</a></u></td></tr>
<tr><th id="410">410</th><td>  {</td></tr>
<tr><th id="411">411</th><td>    <a class="typedef" href="lj_jit.h.html#jit_State" title='jit_State' data-type='struct jit_State' data-ref="jit_State" data-ref-filename="jit_State">jit_State</a> *<dfn class="local col4 decl" id="64J" title='J' data-type='jit_State *' data-ref="64J" data-ref-filename="64J">J</dfn> = <a class="macro" href="lj_dispatch.h.html#116" title="(&amp;((GG_State *)((char *)(g) - ((int)__builtin_offsetof(GG_State, g))))-&gt;J)" data-ref="_M/G2J">G2J</a>(<a class="local col2 ref" href="#62g" title='g' data-ref="62g" data-ref-filename="62g">g</a>);</td></tr>
<tr><th id="412">412</th><td>    <b>if</b> (<a class="local col4 ref" href="#64J" title='J' data-ref="64J" data-ref-filename="64J">J</a>-&gt;<a class="ref field" href="lj_jit.h.html#jit_State::state" title='jit_State::state' data-ref="jit_State::state" data-ref-filename="jit_State..state">state</a> != <a class="enum" href="lj_jit.h.html#LJ_TRACE_IDLE" title='LJ_TRACE_IDLE' data-ref="LJ_TRACE_IDLE" data-ref-filename="LJ_TRACE_IDLE">LJ_TRACE_IDLE</a>) {</td></tr>
<tr><th id="413">413</th><td><u>#<span data-ppcond="413">ifdef</span> <span class="macro" data-ref="_M/LUA_USE_ASSERT">LUA_USE_ASSERT</span></u></td></tr>
<tr><th id="414">414</th><td>      ptrdiff_t delta = L-&gt;top - L-&gt;base;</td></tr>
<tr><th id="415">415</th><td><u>#<span data-ppcond="413">endif</span></u></td></tr>
<tr><th id="416">416</th><td>      <a class="local col4 ref" href="#64J" title='J' data-ref="64J" data-ref-filename="64J">J</a>-&gt;<a class="ref field" href="lj_jit.h.html#jit_State::L" title='jit_State::L' data-ref="jit_State::L" data-ref-filename="jit_State..L">L</a> = <a class="local col6 ref" href="#56L" title='L' data-ref="56L" data-ref-filename="56L">L</a>;</td></tr>
<tr><th id="417">417</th><td>      <a class="ref fn" href="lj_trace.h.html#lj_trace_ins" title='lj_trace_ins' data-ref="lj_trace_ins" data-ref-filename="lj_trace_ins">lj_trace_ins</a>(<a class="local col4 ref" href="#64J" title='J' data-ref="64J" data-ref-filename="64J">J</a>, <a class="local col7 ref" href="#57pc" title='pc' data-ref="57pc" data-ref-filename="57pc">pc</a>-<var>1</var>);  <i>/* The interpreter bytecode PC is offset by 1. */</i></td></tr>
<tr><th id="418">418</th><td>      <a class="macro" href="lj_def.h.html#359" title="((void)g)" data-ref="_M/lj_assertG">lj_assertG</a>(L-&gt;top - L-&gt;base == delta,</td></tr>
<tr><th id="419">419</th><td>		 <q>"unbalanced stack after tracing of instruction"</q>);</td></tr>
<tr><th id="420">420</th><td>    }</td></tr>
<tr><th id="421">421</th><td>  }</td></tr>
<tr><th id="422">422</th><td><u>#<span data-ppcond="409">endif</span></u></td></tr>
<tr><th id="423">423</th><td>  <b>if</b> ((<a class="local col2 ref" href="#62g" title='g' data-ref="62g" data-ref-filename="62g">g</a>-&gt;<a class="ref field" href="lj_obj.h.html#global_State::hookmask" title='global_State::hookmask' data-ref="global_State::hookmask" data-ref-filename="global_State..hookmask">hookmask</a> &amp; <a class="macro" href="lua.h.html#326" title="(1 &lt;&lt; 3)" data-ref="_M/LUA_MASKCOUNT">LUA_MASKCOUNT</a>) &amp;&amp; <a class="local col2 ref" href="#62g" title='g' data-ref="62g" data-ref-filename="62g">g</a>-&gt;<a class="ref field" href="lj_obj.h.html#global_State::hookcount" title='global_State::hookcount' data-ref="global_State::hookcount" data-ref-filename="global_State..hookcount">hookcount</a> == <var>0</var>) {</td></tr>
<tr><th id="424">424</th><td>    <a class="local col2 ref" href="#62g" title='g' data-ref="62g" data-ref-filename="62g">g</a>-&gt;<a class="ref field" href="lj_obj.h.html#global_State::hookcount" title='global_State::hookcount' data-ref="global_State::hookcount" data-ref-filename="global_State..hookcount">hookcount</a> = <a class="local col2 ref" href="#62g" title='g' data-ref="62g" data-ref-filename="62g">g</a>-&gt;<a class="ref field" href="lj_obj.h.html#global_State::hookcstart" title='global_State::hookcstart' data-ref="global_State::hookcstart" data-ref-filename="global_State..hookcstart">hookcstart</a>;</td></tr>
<tr><th id="425">425</th><td>    <a class="tu ref fn" href="#callhook" title='callhook' data-use='c' data-ref="callhook" data-ref-filename="callhook">callhook</a>(<a class="local col6 ref" href="#56L" title='L' data-ref="56L" data-ref-filename="56L">L</a>, <a class="macro" href="lua.h.html#316" title="3" data-ref="_M/LUA_HOOKCOUNT">LUA_HOOKCOUNT</a>, -<var>1</var>);</td></tr>
<tr><th id="426">426</th><td>    <a class="local col6 ref" href="#56L" title='L' data-ref="56L" data-ref-filename="56L">L</a>-&gt;<a class="ref field" href="lj_obj.h.html#lua_State::top" title='lua_State::top' data-ref="lua_State::top" data-ref-filename="lua_State..top">top</a> = <a class="local col6 ref" href="#56L" title='L' data-ref="56L" data-ref-filename="56L">L</a>-&gt;<a class="ref field" href="lj_obj.h.html#lua_State::base" title='lua_State::base' data-ref="lua_State::base" data-ref-filename="lua_State..base">base</a> + <a class="local col3 ref" href="#63slots" title='slots' data-ref="63slots" data-ref-filename="63slots">slots</a>;  <i>/* Fix top again. */</i></td></tr>
<tr><th id="427">427</th><td>  }</td></tr>
<tr><th id="428">428</th><td>  <b>if</b> ((<a class="local col2 ref" href="#62g" title='g' data-ref="62g" data-ref-filename="62g">g</a>-&gt;<a class="ref field" href="lj_obj.h.html#global_State::hookmask" title='global_State::hookmask' data-ref="global_State::hookmask" data-ref-filename="global_State..hookmask">hookmask</a> &amp; <a class="macro" href="lua.h.html#325" title="(1 &lt;&lt; 2)" data-ref="_M/LUA_MASKLINE">LUA_MASKLINE</a>)) {</td></tr>
<tr><th id="429">429</th><td>    <a class="typedef" href="lj_obj.h.html#BCPos" title='BCPos' data-type='uint32_t' data-ref="BCPos" data-ref-filename="BCPos">BCPos</a> <dfn class="local col5 decl" id="65npc" title='npc' data-type='BCPos' data-ref="65npc" data-ref-filename="65npc">npc</dfn> = <a class="macro" href="lj_obj.h.html#418" title="((BCPos)((pc) - ((BCIns *)((char *)(pt) + sizeof(GCproto)))))" data-ref="_M/proto_bcpos">proto_bcpos</a>(<a class="local col9 ref" href="#59pt" title='pt' data-ref="59pt" data-ref-filename="59pt">pt</a>, <a class="local col7 ref" href="#57pc" title='pc' data-ref="57pc" data-ref-filename="57pc">pc</a>) - <var>1</var>;</td></tr>
<tr><th id="430">430</th><td>    <a class="typedef" href="lj_obj.h.html#BCPos" title='BCPos' data-type='uint32_t' data-ref="BCPos" data-ref-filename="BCPos">BCPos</a> <dfn class="local col6 decl" id="66opc" title='opc' data-type='BCPos' data-ref="66opc" data-ref-filename="66opc">opc</dfn> = <a class="macro" href="lj_obj.h.html#418" title="((BCPos)((oldpc) - ((BCIns *)((char *)(pt) + sizeof(GCproto)))))" data-ref="_M/proto_bcpos">proto_bcpos</a>(<a class="local col9 ref" href="#59pt" title='pt' data-ref="59pt" data-ref-filename="59pt">pt</a>, <a class="local col1 ref" href="#61oldpc" title='oldpc' data-ref="61oldpc" data-ref-filename="61oldpc">oldpc</a>) - <var>1</var>;</td></tr>
<tr><th id="431">431</th><td>    <a class="typedef" href="lj_obj.h.html#BCLine" title='BCLine' data-type='int32_t' data-ref="BCLine" data-ref-filename="BCLine">BCLine</a> <dfn class="local col7 decl" id="67line" title='line' data-type='BCLine' data-ref="67line" data-ref-filename="67line">line</dfn> = <a class="ref fn" href="lj_debug.h.html#lj_debug_line" title='lj_debug_line' data-ref="lj_debug_line" data-ref-filename="lj_debug_line">lj_debug_line</a>(<a class="local col9 ref" href="#59pt" title='pt' data-ref="59pt" data-ref-filename="59pt">pt</a>, <a class="local col5 ref" href="#65npc" title='npc' data-ref="65npc" data-ref-filename="65npc">npc</a>);</td></tr>
<tr><th id="432">432</th><td>    <b>if</b> (<a class="local col7 ref" href="#57pc" title='pc' data-ref="57pc" data-ref-filename="57pc">pc</a> &lt;= <a class="local col1 ref" href="#61oldpc" title='oldpc' data-ref="61oldpc" data-ref-filename="61oldpc">oldpc</a> || <a class="local col6 ref" href="#66opc" title='opc' data-ref="66opc" data-ref-filename="66opc">opc</a> &gt;= <a class="local col9 ref" href="#59pt" title='pt' data-ref="59pt" data-ref-filename="59pt">pt</a>-&gt;<a class="ref field" href="lj_obj.h.html#GCproto::sizebc" title='GCproto::sizebc' data-ref="GCproto::sizebc" data-ref-filename="GCproto..sizebc">sizebc</a> || <a class="local col7 ref" href="#67line" title='line' data-ref="67line" data-ref-filename="67line">line</a> != <a class="ref fn" href="lj_debug.h.html#lj_debug_line" title='lj_debug_line' data-ref="lj_debug_line" data-ref-filename="lj_debug_line">lj_debug_line</a>(<a class="local col9 ref" href="#59pt" title='pt' data-ref="59pt" data-ref-filename="59pt">pt</a>, <a class="local col6 ref" href="#66opc" title='opc' data-ref="66opc" data-ref-filename="66opc">opc</a>)) {</td></tr>
<tr><th id="433">433</th><td>      <a class="tu ref fn" href="#callhook" title='callhook' data-use='c' data-ref="callhook" data-ref-filename="callhook">callhook</a>(<a class="local col6 ref" href="#56L" title='L' data-ref="56L" data-ref-filename="56L">L</a>, <a class="macro" href="lua.h.html#315" title="2" data-ref="_M/LUA_HOOKLINE">LUA_HOOKLINE</a>, <a class="local col7 ref" href="#67line" title='line' data-ref="67line" data-ref-filename="67line">line</a>);</td></tr>
<tr><th id="434">434</th><td>      <a class="local col6 ref" href="#56L" title='L' data-ref="56L" data-ref-filename="56L">L</a>-&gt;<a class="ref field" href="lj_obj.h.html#lua_State::top" title='lua_State::top' data-ref="lua_State::top" data-ref-filename="lua_State..top">top</a> = <a class="local col6 ref" href="#56L" title='L' data-ref="56L" data-ref-filename="56L">L</a>-&gt;<a class="ref field" href="lj_obj.h.html#lua_State::base" title='lua_State::base' data-ref="lua_State::base" data-ref-filename="lua_State..base">base</a> + <a class="local col3 ref" href="#63slots" title='slots' data-ref="63slots" data-ref-filename="63slots">slots</a>;  <i>/* Fix top again. */</i></td></tr>
<tr><th id="435">435</th><td>    }</td></tr>
<tr><th id="436">436</th><td>  }</td></tr>
<tr><th id="437">437</th><td>  <b>if</b> ((<a class="local col2 ref" href="#62g" title='g' data-ref="62g" data-ref-filename="62g">g</a>-&gt;<a class="ref field" href="lj_obj.h.html#global_State::hookmask" title='global_State::hookmask' data-ref="global_State::hookmask" data-ref-filename="global_State..hookmask">hookmask</a> &amp; <a class="macro" href="lua.h.html#324" title="(1 &lt;&lt; 1)" data-ref="_M/LUA_MASKRET">LUA_MASKRET</a>) &amp;&amp; <a class="ref fn" href="lj_bc.h.html#bc_isret" title='bc_isret' data-ref="bc_isret" data-ref-filename="bc_isret">bc_isret</a>(<a class="macro" href="lj_bc.h.html#34" title="((BCOp)((pc[-1])&amp;0xff))" data-ref="_M/bc_op">bc_op</a>(<a class="local col7 ref" href="#57pc" title='pc' data-ref="57pc" data-ref-filename="57pc">pc</a>[-<var>1</var>])))</td></tr>
<tr><th id="438">438</th><td>    <a class="tu ref fn" href="#callhook" title='callhook' data-use='c' data-ref="callhook" data-ref-filename="callhook">callhook</a>(<a class="local col6 ref" href="#56L" title='L' data-ref="56L" data-ref-filename="56L">L</a>, <a class="macro" href="lua.h.html#314" title="1" data-ref="_M/LUA_HOOKRET">LUA_HOOKRET</a>, -<var>1</var>);</td></tr>
<tr><th id="439">439</th><td>  <a class="macro" href="lj_dispatch.h.html#157" title="(*__errno_location ()) = olderr;" data-ref="_M/ERRNO_RESTORE">ERRNO_RESTORE</a></td></tr>
<tr><th id="440">440</th><td>}</td></tr>
<tr><th id="441">441</th><td></td></tr>
<tr><th id="442">442</th><td><i  data-doc="call_init">/* Initialize call. Ensure stack space and return # of missing parameters. */</i></td></tr>
<tr><th id="443">443</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="call_init" title='call_init' data-type='int call_init(lua_State * L, GCfunc * fn)' data-ref="call_init" data-ref-filename="call_init">call_init</dfn>(<a class="typedef" href="lua.h.html#lua_State" title='lua_State' data-type='struct lua_State' data-ref="lua_State" data-ref-filename="lua_State">lua_State</a> *<dfn class="local col8 decl" id="68L" title='L' data-type='lua_State *' data-ref="68L" data-ref-filename="68L">L</dfn>, <a class="typedef" href="lj_obj.h.html#GCfunc" title='GCfunc' data-type='union GCfunc' data-ref="GCfunc" data-ref-filename="GCfunc">GCfunc</a> *<dfn class="local col9 decl" id="69fn" title='fn' data-type='GCfunc *' data-ref="69fn" data-ref-filename="69fn">fn</dfn>)</td></tr>
<tr><th id="444">444</th><td>{</td></tr>
<tr><th id="445">445</th><td>  <b>if</b> (<a class="macro" href="lj_obj.h.html#473" title="((fn)-&gt;c.ffid == 0)" data-ref="_M/isluafunc">isluafunc</a>(<a class="local col9 ref" href="#69fn" title='fn' data-ref="69fn" data-ref-filename="69fn">fn</a>)) {</td></tr>
<tr><th id="446">446</th><td>    <a class="typedef" href="lj_obj.h.html#GCproto" title='GCproto' data-type='struct GCproto' data-ref="GCproto" data-ref-filename="GCproto">GCproto</a> *<dfn class="local col0 decl" id="70pt" title='pt' data-type='GCproto *' data-ref="70pt" data-ref-filename="70pt">pt</dfn> = <a class="macro" href="lj_obj.h.html#476" title="((GCproto *)(((char *)(void *)((fn)-&gt;l.pc).ptr64)-sizeof(GCproto)))" data-ref="_M/funcproto">funcproto</a>(<a class="local col9 ref" href="#69fn" title='fn' data-ref="69fn" data-ref-filename="69fn">fn</a>);</td></tr>
<tr><th id="447">447</th><td>    <em>int</em> <dfn class="local col1 decl" id="71numparams" title='numparams' data-type='int' data-ref="71numparams" data-ref-filename="71numparams">numparams</dfn> = <a class="local col0 ref" href="#70pt" title='pt' data-ref="70pt" data-ref-filename="70pt">pt</a>-&gt;<a class="ref field" href="lj_obj.h.html#GCproto::numparams" title='GCproto::numparams' data-ref="GCproto::numparams" data-ref-filename="GCproto..numparams">numparams</a>;</td></tr>
<tr><th id="448">448</th><td>    <em>int</em> <dfn class="local col2 decl" id="72gotparams" title='gotparams' data-type='int' data-ref="72gotparams" data-ref-filename="72gotparams">gotparams</dfn> = (<em>int</em>)(<a class="local col8 ref" href="#68L" title='L' data-ref="68L" data-ref-filename="68L">L</a>-&gt;<a class="ref field" href="lj_obj.h.html#lua_State::top" title='lua_State::top' data-ref="lua_State::top" data-ref-filename="lua_State..top">top</a> - <a class="local col8 ref" href="#68L" title='L' data-ref="68L" data-ref-filename="68L">L</a>-&gt;<a class="ref field" href="lj_obj.h.html#lua_State::base" title='lua_State::base' data-ref="lua_State::base" data-ref-filename="lua_State..base">base</a>);</td></tr>
<tr><th id="449">449</th><td>    <em>int</em> <dfn class="local col3 decl" id="73need" title='need' data-type='int' data-ref="73need" data-ref-filename="73need">need</dfn> = <a class="local col0 ref" href="#70pt" title='pt' data-ref="70pt" data-ref-filename="70pt">pt</a>-&gt;<a class="ref field" href="lj_obj.h.html#GCproto::framesize" title='GCproto::framesize' data-ref="GCproto::framesize" data-ref-filename="GCproto..framesize">framesize</a>;</td></tr>
<tr><th id="450">450</th><td>    <b>if</b> ((<a class="local col0 ref" href="#70pt" title='pt' data-ref="70pt" data-ref-filename="70pt">pt</a>-&gt;<a class="ref field" href="lj_obj.h.html#GCproto::flags" title='GCproto::flags' data-ref="GCproto::flags" data-ref-filename="GCproto..flags">flags</a> &amp; <a class="macro" href="lj_obj.h.html#397" title="0x02" data-ref="_M/PROTO_VARARG">PROTO_VARARG</a>)) <a class="local col3 ref" href="#73need" title='need' data-ref="73need" data-ref-filename="73need">need</a> += <var>1</var>+<a class="local col2 ref" href="#72gotparams" title='gotparams' data-ref="72gotparams" data-ref-filename="72gotparams">gotparams</a>;</td></tr>
<tr><th id="451">451</th><td>    <a class="ref fn" href="lj_state.h.html#lj_state_checkstack" title='lj_state_checkstack' data-ref="lj_state_checkstack" data-ref-filename="lj_state_checkstack">lj_state_checkstack</a>(<a class="local col8 ref" href="#68L" title='L' data-ref="68L" data-ref-filename="68L">L</a>, (<a class="typedef" href="lj_obj.h.html#MSize" title='MSize' data-type='uint32_t' data-ref="MSize" data-ref-filename="MSize">MSize</a>)<a class="local col3 ref" href="#73need" title='need' data-ref="73need" data-ref-filename="73need">need</a>);</td></tr>
<tr><th id="452">452</th><td>    <a class="local col1 ref" href="#71numparams" title='numparams' data-ref="71numparams" data-ref-filename="71numparams">numparams</a> -= <a class="local col2 ref" href="#72gotparams" title='gotparams' data-ref="72gotparams" data-ref-filename="72gotparams">gotparams</a>;</td></tr>
<tr><th id="453">453</th><td>    <b>return</b> <a class="local col1 ref" href="#71numparams" title='numparams' data-ref="71numparams" data-ref-filename="71numparams">numparams</a> &gt;= <var>0</var> ? <a class="local col1 ref" href="#71numparams" title='numparams' data-ref="71numparams" data-ref-filename="71numparams">numparams</a> : <var>0</var>;</td></tr>
<tr><th id="454">454</th><td>  } <b>else</b> {</td></tr>
<tr><th id="455">455</th><td>    <a class="ref fn" href="lj_state.h.html#lj_state_checkstack" title='lj_state_checkstack' data-ref="lj_state_checkstack" data-ref-filename="lj_state_checkstack">lj_state_checkstack</a>(<a class="local col8 ref" href="#68L" title='L' data-ref="68L" data-ref-filename="68L">L</a>, <a class="macro" href="lua.h.html#88" title="20" data-ref="_M/LUA_MINSTACK">LUA_MINSTACK</a>);</td></tr>
<tr><th id="456">456</th><td>    <b>return</b> <var>0</var>;</td></tr>
<tr><th id="457">457</th><td>  }</td></tr>
<tr><th id="458">458</th><td>}</td></tr>
<tr><th id="459">459</th><td></td></tr>
<tr><th id="460">460</th><td><i>/* Call dispatch. Used by call hooks, hot calls or when recording. */</i></td></tr>
<tr><th id="461">461</th><td><a class="typedef" href="lj_obj.h.html#ASMFunction" title='ASMFunction' data-type='void (*)(void)' data-ref="ASMFunction" data-ref-filename="ASMFunction">ASMFunction</a> <a class="macro" href="lj_def.h.html#314" title="" data-ref="_M/LJ_FASTCALL">LJ_FASTCALL</a> <dfn class="decl def fn" id="lj_dispatch_call" title='lj_dispatch_call' data-ref="lj_dispatch_call" data-ref-filename="lj_dispatch_call">lj_dispatch_call</dfn>(<a class="typedef" href="lua.h.html#lua_State" title='lua_State' data-type='struct lua_State' data-ref="lua_State" data-ref-filename="lua_State">lua_State</a> *<dfn class="local col4 decl" id="74L" title='L' data-type='lua_State *' data-ref="74L" data-ref-filename="74L">L</dfn>, <em>const</em> <a class="typedef" href="lj_obj.h.html#BCIns" title='BCIns' data-type='uint32_t' data-ref="BCIns" data-ref-filename="BCIns">BCIns</a> *<dfn class="local col5 decl" id="75pc" title='pc' data-type='const BCIns *' data-ref="75pc" data-ref-filename="75pc">pc</dfn>)</td></tr>
<tr><th id="462">462</th><td>{</td></tr>
<tr><th id="463">463</th><td>  <a class="macro" href="lj_dispatch.h.html#156" title="int olderr = (*__errno_location ());" data-ref="_M/ERRNO_SAVE">ERRNO_SAVE</a></td></tr>
<tr><th id="464">464</th><td>  <a class="typedef" href="lj_obj.h.html#GCfunc" title='GCfunc' data-type='union GCfunc' data-ref="GCfunc" data-ref-filename="GCfunc">GCfunc</a> *<dfn class="local col6 decl" id="76fn" title='fn' data-type='GCfunc *' data-ref="76fn" data-ref-filename="76fn">fn</dfn> = <a class="macro" href="lj_obj.h.html#704" title="(&amp;((GCobj *)((((L-&gt;base-2)-&gt;gcr).gcptr64) &amp; (((uint64_t)1 &lt;&lt; 47) - 1)))-&gt;fn)" data-ref="_M/curr_func">curr_func</a>(<a class="local col4 ref" href="#74L" title='L' data-ref="74L" data-ref-filename="74L">L</a>);</td></tr>
<tr><th id="465">465</th><td>  <a class="typedef" href="lj_bc.h.html#BCOp" title='BCOp' data-type='enum BCOp' data-ref="BCOp" data-ref-filename="BCOp">BCOp</a> <dfn class="local col7 decl" id="77op" title='op' data-type='BCOp' data-ref="77op" data-ref-filename="77op">op</dfn>;</td></tr>
<tr><th id="466">466</th><td>  <a class="typedef" href="lj_obj.h.html#global_State" title='global_State' data-type='struct global_State' data-ref="global_State" data-ref-filename="global_State">global_State</a> *<dfn class="local col8 decl" id="78g" title='g' data-type='global_State *' data-ref="78g" data-ref-filename="78g">g</dfn> = <a class="macro" href="lj_obj.h.html#699" title="(((global_State *)(void *)(L-&gt;glref).ptr64))" data-ref="_M/G">G</a>(<a class="local col4 ref" href="#74L" title='L' data-ref="74L" data-ref-filename="74L">L</a>);</td></tr>
<tr><th id="467">467</th><td><u>#<span data-ppcond="467">if</span> <a class="macro" href="lj_arch.h.html#542" title="1" data-ref="_M/LJ_HASJIT">LJ_HASJIT</a></u></td></tr>
<tr><th id="468">468</th><td>  <a class="typedef" href="lj_jit.h.html#jit_State" title='jit_State' data-type='struct jit_State' data-ref="jit_State" data-ref-filename="jit_State">jit_State</a> *<dfn class="local col9 decl" id="79J" title='J' data-type='jit_State *' data-ref="79J" data-ref-filename="79J">J</dfn> = <a class="macro" href="lj_dispatch.h.html#116" title="(&amp;((GG_State *)((char *)(g) - ((int)__builtin_offsetof(GG_State, g))))-&gt;J)" data-ref="_M/G2J">G2J</a>(<a class="local col8 ref" href="#78g" title='g' data-ref="78g" data-ref-filename="78g">g</a>);</td></tr>
<tr><th id="469">469</th><td><u>#<span data-ppcond="467">endif</span></u></td></tr>
<tr><th id="470">470</th><td>  <em>int</em> <dfn class="local col0 decl" id="80missing" title='missing' data-type='int' data-ref="80missing" data-ref-filename="80missing">missing</dfn> = <a class="tu ref fn" href="#call_init" title='call_init' data-use='c' data-ref="call_init" data-ref-filename="call_init">call_init</a>(<a class="local col4 ref" href="#74L" title='L' data-ref="74L" data-ref-filename="74L">L</a>, <a class="local col6 ref" href="#76fn" title='fn' data-ref="76fn" data-ref-filename="76fn">fn</a>);</td></tr>
<tr><th id="471">471</th><td><u>#<span data-ppcond="471">if</span> <a class="macro" href="lj_arch.h.html#542" title="1" data-ref="_M/LJ_HASJIT">LJ_HASJIT</a></u></td></tr>
<tr><th id="472">472</th><td>  <a class="local col9 ref" href="#79J" title='J' data-ref="79J" data-ref-filename="79J">J</a>-&gt;<a class="ref field" href="lj_jit.h.html#jit_State::L" title='jit_State::L' data-ref="jit_State::L" data-ref-filename="jit_State..L">L</a> = <a class="local col4 ref" href="#74L" title='L' data-ref="74L" data-ref-filename="74L">L</a>;</td></tr>
<tr><th id="473">473</th><td>  <b>if</b> ((<a class="typedef" href="../include/stdint.h.html#uintptr_t" title='uintptr_t' data-type='unsigned long' data-ref="uintptr_t" data-ref-filename="uintptr_t">uintptr_t</a>)<a class="local col5 ref" href="#75pc" title='pc' data-ref="75pc" data-ref-filename="75pc">pc</a> &amp; <var>1</var>) {  <i>/* Marker for hot call. */</i></td></tr>
<tr><th id="474">474</th><td><u>#<span data-ppcond="474">ifdef</span> <span class="macro" data-ref="_M/LUA_USE_ASSERT">LUA_USE_ASSERT</span></u></td></tr>
<tr><th id="475">475</th><td>    ptrdiff_t delta = L-&gt;top - L-&gt;base;</td></tr>
<tr><th id="476">476</th><td><u>#<span data-ppcond="474">endif</span></u></td></tr>
<tr><th id="477">477</th><td>    <a class="local col5 ref" href="#75pc" title='pc' data-ref="75pc" data-ref-filename="75pc">pc</a> = (<em>const</em> <a class="typedef" href="lj_obj.h.html#BCIns" title='BCIns' data-type='uint32_t' data-ref="BCIns" data-ref-filename="BCIns">BCIns</a> *)((<a class="typedef" href="../include/stdint.h.html#uintptr_t" title='uintptr_t' data-type='unsigned long' data-ref="uintptr_t" data-ref-filename="uintptr_t">uintptr_t</a>)<a class="local col5 ref" href="#75pc" title='pc' data-ref="75pc" data-ref-filename="75pc">pc</a> &amp; ~(<a class="typedef" href="../include/stdint.h.html#uintptr_t" title='uintptr_t' data-type='unsigned long' data-ref="uintptr_t" data-ref-filename="uintptr_t">uintptr_t</a>)<var>1</var>);</td></tr>
<tr><th id="478">478</th><td>    <a class="ref fn" href="lj_trace.h.html#lj_trace_hot" title='lj_trace_hot' data-ref="lj_trace_hot" data-ref-filename="lj_trace_hot">lj_trace_hot</a>(<a class="local col9 ref" href="#79J" title='J' data-ref="79J" data-ref-filename="79J">J</a>, <a class="local col5 ref" href="#75pc" title='pc' data-ref="75pc" data-ref-filename="75pc">pc</a>);</td></tr>
<tr><th id="479">479</th><td>    <a class="macro" href="lj_def.h.html#359" title="((void)g)" data-ref="_M/lj_assertG">lj_assertG</a>(L-&gt;top - L-&gt;base == delta,</td></tr>
<tr><th id="480">480</th><td>	       <q>"unbalanced stack after hot call"</q>);</td></tr>
<tr><th id="481">481</th><td>    <b>goto</b> <a class="lbl" href="#81out" data-ref="81out" data-ref-filename="81out">out</a>;</td></tr>
<tr><th id="482">482</th><td>  } <b>else</b> <b>if</b> (<a class="local col9 ref" href="#79J" title='J' data-ref="79J" data-ref-filename="79J">J</a>-&gt;<a class="ref field" href="lj_jit.h.html#jit_State::state" title='jit_State::state' data-ref="jit_State::state" data-ref-filename="jit_State..state">state</a> != <a class="enum" href="lj_jit.h.html#LJ_TRACE_IDLE" title='LJ_TRACE_IDLE' data-ref="LJ_TRACE_IDLE" data-ref-filename="LJ_TRACE_IDLE">LJ_TRACE_IDLE</a> &amp;&amp;</td></tr>
<tr><th id="483">483</th><td>	     !(<a class="local col8 ref" href="#78g" title='g' data-ref="78g" data-ref-filename="78g">g</a>-&gt;<a class="ref field" href="lj_obj.h.html#global_State::hookmask" title='global_State::hookmask' data-ref="global_State::hookmask" data-ref-filename="global_State..hookmask">hookmask</a> &amp; (<a class="macro" href="lj_obj.h.html#670" title="0x40" data-ref="_M/HOOK_GC">HOOK_GC</a>|<a class="macro" href="lj_obj.h.html#669" title="0x20" data-ref="_M/HOOK_VMEVENT">HOOK_VMEVENT</a>))) {</td></tr>
<tr><th id="484">484</th><td><u>#<span data-ppcond="484">ifdef</span> <span class="macro" data-ref="_M/LUA_USE_ASSERT">LUA_USE_ASSERT</span></u></td></tr>
<tr><th id="485">485</th><td>    ptrdiff_t delta = L-&gt;top - L-&gt;base;</td></tr>
<tr><th id="486">486</th><td><u>#<span data-ppcond="484">endif</span></u></td></tr>
<tr><th id="487">487</th><td>    <i>/* Record the FUNC* bytecodes, too. */</i></td></tr>
<tr><th id="488">488</th><td>    <a class="ref fn" href="lj_trace.h.html#lj_trace_ins" title='lj_trace_ins' data-ref="lj_trace_ins" data-ref-filename="lj_trace_ins">lj_trace_ins</a>(<a class="local col9 ref" href="#79J" title='J' data-ref="79J" data-ref-filename="79J">J</a>, <a class="local col5 ref" href="#75pc" title='pc' data-ref="75pc" data-ref-filename="75pc">pc</a>-<var>1</var>);  <i>/* The interpreter bytecode PC is offset by 1. */</i></td></tr>
<tr><th id="489">489</th><td>    <a class="macro" href="lj_def.h.html#359" title="((void)g)" data-ref="_M/lj_assertG">lj_assertG</a>(L-&gt;top - L-&gt;base == delta,</td></tr>
<tr><th id="490">490</th><td>	       <q>"unbalanced stack after hot instruction"</q>);</td></tr>
<tr><th id="491">491</th><td>  }</td></tr>
<tr><th id="492">492</th><td><u>#<span data-ppcond="471">endif</span></u></td></tr>
<tr><th id="493">493</th><td>  <b>if</b> ((<a class="local col8 ref" href="#78g" title='g' data-ref="78g" data-ref-filename="78g">g</a>-&gt;<a class="ref field" href="lj_obj.h.html#global_State::hookmask" title='global_State::hookmask' data-ref="global_State::hookmask" data-ref-filename="global_State..hookmask">hookmask</a> &amp; <a class="macro" href="lua.h.html#323" title="(1 &lt;&lt; 0)" data-ref="_M/LUA_MASKCALL">LUA_MASKCALL</a>)) {</td></tr>
<tr><th id="494">494</th><td>    <em>int</em> <dfn class="local col2 decl" id="82i" title='i' data-type='int' data-ref="82i" data-ref-filename="82i">i</dfn>;</td></tr>
<tr><th id="495">495</th><td>    <b>for</b> (<a class="local col2 ref" href="#82i" title='i' data-ref="82i" data-ref-filename="82i">i</a> = <var>0</var>; <a class="local col2 ref" href="#82i" title='i' data-ref="82i" data-ref-filename="82i">i</a> &lt; <a class="local col0 ref" href="#80missing" title='missing' data-ref="80missing" data-ref-filename="80missing">missing</a>; <a class="local col2 ref" href="#82i" title='i' data-ref="82i" data-ref-filename="82i">i</a>++)  <i>/* Add missing parameters. */</i></td></tr>
<tr><th id="496">496</th><td>      <a class="macro" href="lj_obj.h.html#865" title="((L-&gt;top++)-&gt;it64 = -1)" data-ref="_M/setnilV">setnilV</a>(<a class="local col4 ref" href="#74L" title='L' data-ref="74L" data-ref-filename="74L">L</a>-&gt;<a class="ref field" href="lj_obj.h.html#lua_State::top" title='lua_State::top' data-ref="lua_State::top" data-ref-filename="lua_State..top">top</a>++);</td></tr>
<tr><th id="497">497</th><td>    <a class="tu ref fn" href="#callhook" title='callhook' data-use='c' data-ref="callhook" data-ref-filename="callhook">callhook</a>(<a class="local col4 ref" href="#74L" title='L' data-ref="74L" data-ref-filename="74L">L</a>, <a class="macro" href="lua.h.html#313" title="0" data-ref="_M/LUA_HOOKCALL">LUA_HOOKCALL</a>, -<var>1</var>);</td></tr>
<tr><th id="498">498</th><td>    <i>/* Preserve modifications of missing parameters by lua_setlocal(). */</i></td></tr>
<tr><th id="499">499</th><td>    <b>while</b> (<a class="local col0 ref" href="#80missing" title='missing' data-ref="80missing" data-ref-filename="80missing">missing</a>-- &gt; <var>0</var> &amp;&amp; <a class="macro" href="lj_obj.h.html#776" title="((L-&gt;top - 1)-&gt;it64 == -1)" data-ref="_M/tvisnil">tvisnil</a>(<a class="local col4 ref" href="#74L" title='L' data-ref="74L" data-ref-filename="74L">L</a>-&gt;<a class="ref field" href="lj_obj.h.html#lua_State::top" title='lua_State::top' data-ref="lua_State::top" data-ref-filename="lua_State..top">top</a> - <var>1</var>))</td></tr>
<tr><th id="500">500</th><td>      <a class="local col4 ref" href="#74L" title='L' data-ref="74L" data-ref-filename="74L">L</a>-&gt;<a class="ref field" href="lj_obj.h.html#lua_State::top" title='lua_State::top' data-ref="lua_State::top" data-ref-filename="lua_State..top">top</a>--;</td></tr>
<tr><th id="501">501</th><td>  }</td></tr>
<tr><th id="502">502</th><td><u>#<span data-ppcond="502">if</span> <a class="macro" href="lj_arch.h.html#542" title="1" data-ref="_M/LJ_HASJIT">LJ_HASJIT</a></u></td></tr>
<tr><th id="503">503</th><td><dfn class="lbl" id="81out" data-ref="81out" data-ref-filename="81out">out</dfn>:</td></tr>
<tr><th id="504">504</th><td><u>#<span data-ppcond="502">endif</span></u></td></tr>
<tr><th id="505">505</th><td>  <a class="local col7 ref" href="#77op" title='op' data-ref="77op" data-ref-filename="77op">op</a> = <a class="macro" href="lj_bc.h.html#34" title="((BCOp)((pc[-1])&amp;0xff))" data-ref="_M/bc_op">bc_op</a>(<a class="local col5 ref" href="#75pc" title='pc' data-ref="75pc" data-ref-filename="75pc">pc</a>[-<var>1</var>]);  <i>/* Get FUNC* op. */</i></td></tr>
<tr><th id="506">506</th><td><u>#<span data-ppcond="506">if</span> <a class="macro" href="lj_arch.h.html#542" title="1" data-ref="_M/LJ_HASJIT">LJ_HASJIT</a></u></td></tr>
<tr><th id="507">507</th><td>  <i>/* Use the non-hotcounting variants if JIT is off or while recording. */</i></td></tr>
<tr><th id="508">508</th><td>  <b>if</b> ((!(<a class="local col9 ref" href="#79J" title='J' data-ref="79J" data-ref-filename="79J">J</a>-&gt;<a class="ref field" href="lj_jit.h.html#jit_State::flags" title='jit_State::flags' data-ref="jit_State::flags" data-ref-filename="jit_State..flags">flags</a> &amp; <a class="macro" href="lj_jit.h.html#15" title="0x00000001" data-ref="_M/JIT_F_ON">JIT_F_ON</a>) || <a class="local col9 ref" href="#79J" title='J' data-ref="79J" data-ref-filename="79J">J</a>-&gt;<a class="ref field" href="lj_jit.h.html#jit_State::state" title='jit_State::state' data-ref="jit_State::state" data-ref-filename="jit_State..state">state</a> != <a class="enum" href="lj_jit.h.html#LJ_TRACE_IDLE" title='LJ_TRACE_IDLE' data-ref="LJ_TRACE_IDLE" data-ref-filename="LJ_TRACE_IDLE">LJ_TRACE_IDLE</a>) &amp;&amp;</td></tr>
<tr><th id="509">509</th><td>      (<a class="local col7 ref" href="#77op" title='op' data-ref="77op" data-ref-filename="77op">op</a> == <a class="enum" href="lj_bc.h.html#202" title='BC_FUNCF' data-ref="BC_FUNCF" data-ref-filename="BC_FUNCF">BC_FUNCF</a> || <a class="local col7 ref" href="#77op" title='op' data-ref="77op" data-ref-filename="77op">op</a> == <a class="enum" href="lj_bc.h.html#202" title='BC_FUNCV' data-ref="BC_FUNCV" data-ref-filename="BC_FUNCV">BC_FUNCV</a>))</td></tr>
<tr><th id="510">510</th><td>    <a class="local col7 ref" href="#77op" title='op' data-ref="77op" data-ref-filename="77op">op</a> = (<a class="typedef" href="lj_bc.h.html#BCOp" title='BCOp' data-type='enum BCOp' data-ref="BCOp" data-ref-filename="BCOp">BCOp</a>)((<em>int</em>)<a class="local col7 ref" href="#77op" title='op' data-ref="77op" data-ref-filename="77op">op</a>+(<em>int</em>)<a class="enum" href="lj_bc.h.html#202" title='BC_IFUNCF' data-ref="BC_IFUNCF" data-ref-filename="BC_IFUNCF">BC_IFUNCF</a>-(<em>int</em>)<a class="enum" href="lj_bc.h.html#202" title='BC_FUNCF' data-ref="BC_FUNCF" data-ref-filename="BC_FUNCF">BC_FUNCF</a>);</td></tr>
<tr><th id="511">511</th><td><u>#<span data-ppcond="506">endif</span></u></td></tr>
<tr><th id="512">512</th><td>  <a class="macro" href="lj_dispatch.h.html#157" title="(*__errno_location ()) = olderr;" data-ref="_M/ERRNO_RESTORE">ERRNO_RESTORE</a></td></tr>
<tr><th id="513">513</th><td>  <b>return</b> <a class="macro" href="lj_vm.h.html#116" title="((ASMFunction)(lj_vm_asm_begin + (lj_bc_ofs[op])))" data-ref="_M/makeasmfunc">makeasmfunc</a>(<a class="ref" href="lj_bc.h.html#lj_bc_ofs" title='lj_bc_ofs' data-ref="lj_bc_ofs" data-ref-filename="lj_bc_ofs">lj_bc_ofs</a>[<a class="local col7 ref" href="#77op" title='op' data-ref="77op" data-ref-filename="77op">op</a>]);  <i>/* Return static dispatch target. */</i></td></tr>
<tr><th id="514">514</th><td>}</td></tr>
<tr><th id="515">515</th><td></td></tr>
<tr><th id="516">516</th><td><u>#<span data-ppcond="516">if</span> <a class="macro" href="lj_arch.h.html#542" title="1" data-ref="_M/LJ_HASJIT">LJ_HASJIT</a></u></td></tr>
<tr><th id="517">517</th><td><i>/* Stitch a new trace. */</i></td></tr>
<tr><th id="518">518</th><td><em>void</em> <a class="macro" href="lj_def.h.html#314" title="" data-ref="_M/LJ_FASTCALL">LJ_FASTCALL</a> <dfn class="decl def fn" id="lj_dispatch_stitch" title='lj_dispatch_stitch' data-ref="lj_dispatch_stitch" data-ref-filename="lj_dispatch_stitch">lj_dispatch_stitch</dfn>(<a class="typedef" href="lj_jit.h.html#jit_State" title='jit_State' data-type='struct jit_State' data-ref="jit_State" data-ref-filename="jit_State">jit_State</a> *<dfn class="local col3 decl" id="83J" title='J' data-type='jit_State *' data-ref="83J" data-ref-filename="83J">J</dfn>, <em>const</em> <a class="typedef" href="lj_obj.h.html#BCIns" title='BCIns' data-type='uint32_t' data-ref="BCIns" data-ref-filename="BCIns">BCIns</a> *<dfn class="local col4 decl" id="84pc" title='pc' data-type='const BCIns *' data-ref="84pc" data-ref-filename="84pc">pc</dfn>)</td></tr>
<tr><th id="519">519</th><td>{</td></tr>
<tr><th id="520">520</th><td>  <a class="macro" href="lj_dispatch.h.html#156" title="int olderr = (*__errno_location ());" data-ref="_M/ERRNO_SAVE">ERRNO_SAVE</a></td></tr>
<tr><th id="521">521</th><td>  <a class="typedef" href="lua.h.html#lua_State" title='lua_State' data-type='struct lua_State' data-ref="lua_State" data-ref-filename="lua_State">lua_State</a> *<dfn class="local col5 decl" id="85L" title='L' data-type='lua_State *' data-ref="85L" data-ref-filename="85L">L</dfn> = <a class="local col3 ref" href="#83J" title='J' data-ref="83J" data-ref-filename="83J">J</a>-&gt;<a class="ref field" href="lj_jit.h.html#jit_State::L" title='jit_State::L' data-ref="jit_State::L" data-ref-filename="jit_State..L">L</a>;</td></tr>
<tr><th id="522">522</th><td>  <em>void</em> *<dfn class="local col6 decl" id="86cf" title='cf' data-type='void *' data-ref="86cf" data-ref-filename="86cf">cf</dfn> = <a class="macro" href="lj_frame.h.html#294" title="((void *)((intptr_t)(L-&gt;cframe) &amp; (~(intptr_t)(1|2))))" data-ref="_M/cframe_raw">cframe_raw</a>(<a class="local col5 ref" href="#85L" title='L' data-ref="85L" data-ref-filename="85L">L</a>-&gt;<a class="ref field" href="lj_obj.h.html#lua_State::cframe" title='lua_State::cframe' data-ref="lua_State::cframe" data-ref-filename="lua_State..cframe">cframe</a>);</td></tr>
<tr><th id="523">523</th><td>  <em>const</em> <a class="typedef" href="lj_obj.h.html#BCIns" title='BCIns' data-type='uint32_t' data-ref="BCIns" data-ref-filename="BCIns">BCIns</a> *<dfn class="local col7 decl" id="87oldpc" title='oldpc' data-type='const BCIns *' data-ref="87oldpc" data-ref-filename="87oldpc">oldpc</dfn> = <a class="macro" href="lj_frame.h.html#286" title="(((const BCIns *)(void *)(*(MRef *)(((char *)(cf))+(3*8))).ptr64))" data-ref="_M/cframe_pc">cframe_pc</a>(<a class="local col6 ref" href="#86cf" title='cf' data-ref="86cf" data-ref-filename="86cf">cf</a>);</td></tr>
<tr><th id="524">524</th><td>  <a class="macro" href="lj_frame.h.html#290" title="(((*(MRef *)(((char *)(cf))+(3*8))).ptr64 = (uint64_t)(void *)((pc))))" data-ref="_M/setcframe_pc">setcframe_pc</a>(<a class="local col6 ref" href="#86cf" title='cf' data-ref="86cf" data-ref-filename="86cf">cf</a>, <a class="local col4 ref" href="#84pc" title='pc' data-ref="84pc" data-ref-filename="84pc">pc</a>);</td></tr>
<tr><th id="525">525</th><td>  <i>/* Before dispatch, have to bias PC by 1. */</i></td></tr>
<tr><th id="526">526</th><td>  <a class="local col5 ref" href="#85L" title='L' data-ref="85L" data-ref-filename="85L">L</a>-&gt;<a class="ref field" href="lj_obj.h.html#lua_State::top" title='lua_State::top' data-ref="lua_State::top" data-ref-filename="lua_State..top">top</a> = <a class="local col5 ref" href="#85L" title='L' data-ref="85L" data-ref-filename="85L">L</a>-&gt;<a class="ref field" href="lj_obj.h.html#lua_State::base" title='lua_State::base' data-ref="lua_State::base" data-ref-filename="lua_State..base">base</a> + <a class="tu ref fn" href="#cur_topslot" title='cur_topslot' data-use='c' data-ref="cur_topslot" data-ref-filename="cur_topslot">cur_topslot</a>(<a class="macro" href="lj_obj.h.html#711" title="(((GCproto *)(((char *)(void *)(((&amp;((GCobj *)((((L-&gt;base-2)-&gt;gcr).gcptr64) &amp; (((uint64_t)1 &lt;&lt; 47) - 1)))-&gt;fn))-&gt;l.pc).ptr64)-sizeof(GCproto))))" data-ref="_M/curr_proto">curr_proto</a>(<a class="local col5 ref" href="#85L" title='L' data-ref="85L" data-ref-filename="85L">L</a>), <a class="local col4 ref" href="#84pc" title='pc' data-ref="84pc" data-ref-filename="84pc">pc</a>+<var>1</var>, <a class="macro" href="lj_frame.h.html#283" title="((*(uint32_t *)(((char *)((cf)))+(0*4))) &gt;&gt; 0)" data-ref="_M/cframe_multres_n">cframe_multres_n</a>(<a class="local col6 ref" href="#86cf" title='cf' data-ref="86cf" data-ref-filename="86cf">cf</a>));</td></tr>
<tr><th id="527">527</th><td>  <a class="ref fn" href="lj_trace.h.html#lj_trace_stitch" title='lj_trace_stitch' data-ref="lj_trace_stitch" data-ref-filename="lj_trace_stitch">lj_trace_stitch</a>(<a class="local col3 ref" href="#83J" title='J' data-ref="83J" data-ref-filename="83J">J</a>, <a class="local col4 ref" href="#84pc" title='pc' data-ref="84pc" data-ref-filename="84pc">pc</a>-<var>1</var>);  <i>/* Point to the CALL instruction. */</i></td></tr>
<tr><th id="528">528</th><td>  <a class="macro" href="lj_frame.h.html#290" title="(((*(MRef *)(((char *)(cf))+(3*8))).ptr64 = (uint64_t)(void *)((oldpc))))" data-ref="_M/setcframe_pc">setcframe_pc</a>(<a class="local col6 ref" href="#86cf" title='cf' data-ref="86cf" data-ref-filename="86cf">cf</a>, <a class="local col7 ref" href="#87oldpc" title='oldpc' data-ref="87oldpc" data-ref-filename="87oldpc">oldpc</a>);</td></tr>
<tr><th id="529">529</th><td>  <a class="macro" href="lj_dispatch.h.html#157" title="(*__errno_location ()) = olderr;" data-ref="_M/ERRNO_RESTORE">ERRNO_RESTORE</a></td></tr>
<tr><th id="530">530</th><td>}</td></tr>
<tr><th id="531">531</th><td><u>#<span data-ppcond="516">endif</span></u></td></tr>
<tr><th id="532">532</th><td></td></tr>
<tr><th id="533">533</th><td><u>#<span data-ppcond="533">if</span> <a class="macro" href="lj_arch.h.html#562" title="1" data-ref="_M/LJ_HASPROFILE">LJ_HASPROFILE</a></u></td></tr>
<tr><th id="534">534</th><td><i>/* Profile dispatch. */</i></td></tr>
<tr><th id="535">535</th><td><em>void</em> <a class="macro" href="lj_def.h.html#314" title="" data-ref="_M/LJ_FASTCALL">LJ_FASTCALL</a> <dfn class="decl def fn" id="lj_dispatch_profile" title='lj_dispatch_profile' data-ref="lj_dispatch_profile" data-ref-filename="lj_dispatch_profile">lj_dispatch_profile</dfn>(<a class="typedef" href="lua.h.html#lua_State" title='lua_State' data-type='struct lua_State' data-ref="lua_State" data-ref-filename="lua_State">lua_State</a> *<dfn class="local col8 decl" id="88L" title='L' data-type='lua_State *' data-ref="88L" data-ref-filename="88L">L</dfn>, <em>const</em> <a class="typedef" href="lj_obj.h.html#BCIns" title='BCIns' data-type='uint32_t' data-ref="BCIns" data-ref-filename="BCIns">BCIns</a> *<dfn class="local col9 decl" id="89pc" title='pc' data-type='const BCIns *' data-ref="89pc" data-ref-filename="89pc">pc</dfn>)</td></tr>
<tr><th id="536">536</th><td>{</td></tr>
<tr><th id="537">537</th><td>  <a class="macro" href="lj_dispatch.h.html#156" title="int olderr = (*__errno_location ());" data-ref="_M/ERRNO_SAVE">ERRNO_SAVE</a></td></tr>
<tr><th id="538">538</th><td>  <a class="typedef" href="lj_obj.h.html#GCfunc" title='GCfunc' data-type='union GCfunc' data-ref="GCfunc" data-ref-filename="GCfunc">GCfunc</a> *<dfn class="local col0 decl" id="90fn" title='fn' data-type='GCfunc *' data-ref="90fn" data-ref-filename="90fn">fn</dfn> = <a class="macro" href="lj_obj.h.html#704" title="(&amp;((GCobj *)((((L-&gt;base-2)-&gt;gcr).gcptr64) &amp; (((uint64_t)1 &lt;&lt; 47) - 1)))-&gt;fn)" data-ref="_M/curr_func">curr_func</a>(<a class="local col8 ref" href="#88L" title='L' data-ref="88L" data-ref-filename="88L">L</a>);</td></tr>
<tr><th id="539">539</th><td>  <a class="typedef" href="lj_obj.h.html#GCproto" title='GCproto' data-type='struct GCproto' data-ref="GCproto" data-ref-filename="GCproto">GCproto</a> *<dfn class="local col1 decl" id="91pt" title='pt' data-type='GCproto *' data-ref="91pt" data-ref-filename="91pt">pt</dfn> = <a class="macro" href="lj_obj.h.html#476" title="((GCproto *)(((char *)(void *)((fn)-&gt;l.pc).ptr64)-sizeof(GCproto)))" data-ref="_M/funcproto">funcproto</a>(<a class="local col0 ref" href="#90fn" title='fn' data-ref="90fn" data-ref-filename="90fn">fn</a>);</td></tr>
<tr><th id="540">540</th><td>  <em>void</em> *<dfn class="local col2 decl" id="92cf" title='cf' data-type='void *' data-ref="92cf" data-ref-filename="92cf">cf</dfn> = <a class="macro" href="lj_frame.h.html#294" title="((void *)((intptr_t)(L-&gt;cframe) &amp; (~(intptr_t)(1|2))))" data-ref="_M/cframe_raw">cframe_raw</a>(<a class="local col8 ref" href="#88L" title='L' data-ref="88L" data-ref-filename="88L">L</a>-&gt;<a class="ref field" href="lj_obj.h.html#lua_State::cframe" title='lua_State::cframe' data-ref="lua_State::cframe" data-ref-filename="lua_State..cframe">cframe</a>);</td></tr>
<tr><th id="541">541</th><td>  <em>const</em> <a class="typedef" href="lj_obj.h.html#BCIns" title='BCIns' data-type='uint32_t' data-ref="BCIns" data-ref-filename="BCIns">BCIns</a> *<dfn class="local col3 decl" id="93oldpc" title='oldpc' data-type='const BCIns *' data-ref="93oldpc" data-ref-filename="93oldpc">oldpc</dfn> = <a class="macro" href="lj_frame.h.html#286" title="(((const BCIns *)(void *)(*(MRef *)(((char *)(cf))+(3*8))).ptr64))" data-ref="_M/cframe_pc">cframe_pc</a>(<a class="local col2 ref" href="#92cf" title='cf' data-ref="92cf" data-ref-filename="92cf">cf</a>);</td></tr>
<tr><th id="542">542</th><td>  <a class="typedef" href="lj_obj.h.html#global_State" title='global_State' data-type='struct global_State' data-ref="global_State" data-ref-filename="global_State">global_State</a> *<dfn class="local col4 decl" id="94g" title='g' data-type='global_State *' data-ref="94g" data-ref-filename="94g">g</dfn>;</td></tr>
<tr><th id="543">543</th><td>  <a class="macro" href="lj_frame.h.html#290" title="(((*(MRef *)(((char *)(cf))+(3*8))).ptr64 = (uint64_t)(void *)((pc))))" data-ref="_M/setcframe_pc">setcframe_pc</a>(<a class="local col2 ref" href="#92cf" title='cf' data-ref="92cf" data-ref-filename="92cf">cf</a>, <a class="local col9 ref" href="#89pc" title='pc' data-ref="89pc" data-ref-filename="89pc">pc</a>);</td></tr>
<tr><th id="544">544</th><td>  <a class="local col8 ref" href="#88L" title='L' data-ref="88L" data-ref-filename="88L">L</a>-&gt;<a class="ref field" href="lj_obj.h.html#lua_State::top" title='lua_State::top' data-ref="lua_State::top" data-ref-filename="lua_State..top">top</a> = <a class="local col8 ref" href="#88L" title='L' data-ref="88L" data-ref-filename="88L">L</a>-&gt;<a class="ref field" href="lj_obj.h.html#lua_State::base" title='lua_State::base' data-ref="lua_State::base" data-ref-filename="lua_State..base">base</a> + <a class="tu ref fn" href="#cur_topslot" title='cur_topslot' data-use='c' data-ref="cur_topslot" data-ref-filename="cur_topslot">cur_topslot</a>(<a class="local col1 ref" href="#91pt" title='pt' data-ref="91pt" data-ref-filename="91pt">pt</a>, <a class="local col9 ref" href="#89pc" title='pc' data-ref="89pc" data-ref-filename="89pc">pc</a>, <a class="macro" href="lj_frame.h.html#283" title="((*(uint32_t *)(((char *)((cf)))+(0*4))) &gt;&gt; 0)" data-ref="_M/cframe_multres_n">cframe_multres_n</a>(<a class="local col2 ref" href="#92cf" title='cf' data-ref="92cf" data-ref-filename="92cf">cf</a>));</td></tr>
<tr><th id="545">545</th><td>  <a class="ref fn" href="lj_profile.h.html#lj_profile_interpreter" title='lj_profile_interpreter' data-ref="lj_profile_interpreter" data-ref-filename="lj_profile_interpreter">lj_profile_interpreter</a>(<a class="local col8 ref" href="#88L" title='L' data-ref="88L" data-ref-filename="88L">L</a>);</td></tr>
<tr><th id="546">546</th><td>  <a class="macro" href="lj_frame.h.html#290" title="(((*(MRef *)(((char *)(cf))+(3*8))).ptr64 = (uint64_t)(void *)((oldpc))))" data-ref="_M/setcframe_pc">setcframe_pc</a>(<a class="local col2 ref" href="#92cf" title='cf' data-ref="92cf" data-ref-filename="92cf">cf</a>, <a class="local col3 ref" href="#93oldpc" title='oldpc' data-ref="93oldpc" data-ref-filename="93oldpc">oldpc</a>);</td></tr>
<tr><th id="547">547</th><td>  <a class="local col4 ref" href="#94g" title='g' data-ref="94g" data-ref-filename="94g">g</a> = <a class="macro" href="lj_obj.h.html#699" title="(((global_State *)(void *)(L-&gt;glref).ptr64))" data-ref="_M/G">G</a>(<a class="local col8 ref" href="#88L" title='L' data-ref="88L" data-ref-filename="88L">L</a>);</td></tr>
<tr><th id="548">548</th><td>  <a class="macro" href="lj_obj.h.html#72" title="((g-&gt;cur_L).gcptr64 = (uint64_t)&amp;(((GCobj *)(L)))-&gt;gch)" data-ref="_M/setgcref">setgcref</a>(<a class="local col4 ref" href="#94g" title='g' data-ref="94g" data-ref-filename="94g">g</a>-&gt;<a class="ref field" href="lj_obj.h.html#global_State::cur_L" title='global_State::cur_L' data-ref="global_State::cur_L" data-ref-filename="global_State..cur_L">cur_L</a>, <a class="macro" href="lj_obj.h.html#769" title="((GCobj *)(L))" data-ref="_M/obj2gco">obj2gco</a>(<a class="local col8 ref" href="#88L" title='L' data-ref="88L" data-ref-filename="88L">L</a>));</td></tr>
<tr><th id="549">549</th><td>  <a class="macro" href="lj_obj.h.html#536" title="((g)-&gt;vmstate = ~LJ_VMST_INTERP)" data-ref="_M/setvmstate">setvmstate</a>(<a class="local col4 ref" href="#94g" title='g' data-ref="94g" data-ref-filename="94g">g</a>, INTERP);</td></tr>
<tr><th id="550">550</th><td>  <a class="macro" href="lj_dispatch.h.html#157" title="(*__errno_location ()) = olderr;" data-ref="_M/ERRNO_RESTORE">ERRNO_RESTORE</a></td></tr>
<tr><th id="551">551</th><td>}</td></tr>
<tr><th id="552">552</th><td><u>#<span data-ppcond="533">endif</span></u></td></tr>
<tr><th id="553">553</th><td></td></tr>
<tr><th id="554">554</th><td></td></tr>
</table><hr/><p id='footer'>
Generated on <em>2022-Jun-23</em> from project luajit revision <em>v2.1.0-beta3-294-ge9577376</em><br />Powered by <a href='https://woboq.com'><img alt='Woboq' src='https://code.woboq.org/woboq-16.png' width='41' height='16' /></a> <a href='https://code.woboq.org'>Code Browser</a> 2.1
<br/>Generator usage only permitted with license.</p>
</div></body></html>
