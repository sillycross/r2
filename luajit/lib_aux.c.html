<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"><title>lib_aux.c source code [luajit/lib_aux.c] - Woboq Code Browser</title>
<link rel="stylesheet" href=".././data/qtcreator.css" title="QtCreator"/>
<link rel="alternate stylesheet" href=".././data/kdevelop.css" title="KDevelop"/>
<script type="text/javascript" src=".././data/jquery/jquery.min.js"></script>
<script type="text/javascript" src=".././data/jquery/jquery-ui.min.js"></script>
<script>var file = 'luajit/lib_aux.c'; var root_path = '..'; var data_path = '.././data'; var ecma_script_api_version = 2;</script>
<script src='.././data/codebrowser.js'></script>
</head>
<body><div id='header'><h1 id='breadcrumb'><span>Browse the source code of </span><a href='./'>luajit</a>/<a href='lib_aux.c.html'>lib_aux.c</a></h1></div>
<hr/><div id='content'><table class="code">
<tr><th id="1">1</th><td><i>/*</i></td></tr>
<tr><th id="2">2</th><td><i>** Auxiliary library for the Lua/C API.</i></td></tr>
<tr><th id="3">3</th><td><i>** Copyright (C) 2005-2021 Mike Pall. See Copyright Notice in luajit.h</i></td></tr>
<tr><th id="4">4</th><td><i>**</i></td></tr>
<tr><th id="5">5</th><td><i>** Major parts taken verbatim or adapted from the Lua interpreter.</i></td></tr>
<tr><th id="6">6</th><td><i>** Copyright (C) 1994-2008 Lua.org, PUC-Rio. See Copyright Notice in lua.h</i></td></tr>
<tr><th id="7">7</th><td><i>*/</i></td></tr>
<tr><th id="8">8</th><td></td></tr>
<tr><th id="9">9</th><td><u>#include <a href="../include/errno.h.html">&lt;errno.h&gt;</a></u></td></tr>
<tr><th id="10">10</th><td><u>#include &lt;stdarg.h&gt;</u></td></tr>
<tr><th id="11">11</th><td><u>#include <a href="../include/stdio.h.html">&lt;stdio.h&gt;</a></u></td></tr>
<tr><th id="12">12</th><td></td></tr>
<tr><th id="13">13</th><td><u>#define <dfn class="macro" id="_M/lib_aux_c" data-ref="_M/lib_aux_c">lib_aux_c</dfn></u></td></tr>
<tr><th id="14">14</th><td><u>#define <dfn class="macro" id="_M/LUA_LIB" data-ref="_M/LUA_LIB">LUA_LIB</dfn></u></td></tr>
<tr><th id="15">15</th><td></td></tr>
<tr><th id="16">16</th><td><u>#include <a href="lua.h.html">"lua.h"</a></u></td></tr>
<tr><th id="17">17</th><td><u>#include <a href="lauxlib.h.html">"lauxlib.h"</a></u></td></tr>
<tr><th id="18">18</th><td></td></tr>
<tr><th id="19">19</th><td><u>#include <a href="lj_obj.h.html">"lj_obj.h"</a></u></td></tr>
<tr><th id="20">20</th><td><u>#include <a href="lj_err.h.html">"lj_err.h"</a></u></td></tr>
<tr><th id="21">21</th><td><u>#include <a href="lj_state.h.html">"lj_state.h"</a></u></td></tr>
<tr><th id="22">22</th><td><u>#include <a href="lj_trace.h.html">"lj_trace.h"</a></u></td></tr>
<tr><th id="23">23</th><td><u>#include <a href="lj_lib.h.html">"lj_lib.h"</a></u></td></tr>
<tr><th id="24">24</th><td></td></tr>
<tr><th id="25">25</th><td><u>#<span data-ppcond="25">if</span> <a class="macro" href="lj_arch.h.html#121" title="(2 &gt; 1)" data-ref="_M/LJ_TARGET_POSIX">LJ_TARGET_POSIX</a></u></td></tr>
<tr><th id="26">26</th><td><u>#include <a href="../include/x86_64-linux-gnu/sys/wait.h.html">&lt;sys/wait.h&gt;</a></u></td></tr>
<tr><th id="27">27</th><td><u>#<span data-ppcond="25">endif</span></u></td></tr>
<tr><th id="28">28</th><td></td></tr>
<tr><th id="29">29</th><td><i>/* -- I/O error handling -------------------------------------------------- */</i></td></tr>
<tr><th id="30">30</th><td></td></tr>
<tr><th id="31">31</th><td><a class="macro" href="luaconf.h.html#137" title="extern" data-ref="_M/LUALIB_API">LUALIB_API</a> <em>int</em> <dfn class="decl def fn" id="luaL_fileresult" title='luaL_fileresult' data-ref="luaL_fileresult" data-ref-filename="luaL_fileresult">luaL_fileresult</dfn>(<a class="typedef" href="lua.h.html#lua_State" title='lua_State' data-type='struct lua_State' data-ref="lua_State" data-ref-filename="lua_State">lua_State</a> *<dfn class="local col4 decl" id="274L" title='L' data-type='lua_State *' data-ref="274L" data-ref-filename="274L">L</dfn>, <em>int</em> <dfn class="local col5 decl" id="275stat" title='stat' data-type='int' data-ref="275stat" data-ref-filename="275stat">stat</dfn>, <em>const</em> <em>char</em> *<dfn class="local col6 decl" id="276fname" title='fname' data-type='const char *' data-ref="276fname" data-ref-filename="276fname">fname</dfn>)</td></tr>
<tr><th id="32">32</th><td>{</td></tr>
<tr><th id="33">33</th><td>  <b>if</b> (<a class="local col5 ref" href="#275stat" title='stat' data-ref="275stat" data-ref-filename="275stat">stat</a>) {</td></tr>
<tr><th id="34">34</th><td>    <a class="macro" href="lj_obj.h.html#867" title="((L-&gt;top++)-&gt;it64 = (int64_t)~((uint64_t)((1)+1)&lt;&lt;47))" data-ref="_M/setboolV">setboolV</a>(<a class="local col4 ref" href="#274L" title='L' data-ref="274L" data-ref-filename="274L">L</a>-&gt;<a class="ref field" href="lj_obj.h.html#lua_State::top" title='lua_State::top' data-ref="lua_State::top" data-ref-filename="lua_State..top">top</a>++, <var>1</var>);</td></tr>
<tr><th id="35">35</th><td>    <b>return</b> <var>1</var>;</td></tr>
<tr><th id="36">36</th><td>  } <b>else</b> {</td></tr>
<tr><th id="37">37</th><td>    <em>int</em> <dfn class="local col7 decl" id="277en" title='en' data-type='int' data-ref="277en" data-ref-filename="277en">en</dfn> = <a class="macro" href="../include/errno.h.html#38" title="(*__errno_location ())" data-ref="_M/errno">errno</a>;  <i>/* Lua API calls may change this value. */</i></td></tr>
<tr><th id="38">38</th><td>    <a class="macro" href="lj_obj.h.html#865" title="((L-&gt;top++)-&gt;it64 = -1)" data-ref="_M/setnilV">setnilV</a>(<a class="local col4 ref" href="#274L" title='L' data-ref="274L" data-ref-filename="274L">L</a>-&gt;<a class="ref field" href="lj_obj.h.html#lua_State::top" title='lua_State::top' data-ref="lua_State::top" data-ref-filename="lua_State..top">top</a>++);</td></tr>
<tr><th id="39">39</th><td>    <b>if</b> (<a class="local col6 ref" href="#276fname" title='fname' data-ref="276fname" data-ref-filename="276fname">fname</a>)</td></tr>
<tr><th id="40">40</th><td>      <a class="ref fn" href="lua.h.html#lua_pushfstring" title='lua_pushfstring' data-ref="lua_pushfstring" data-ref-filename="lua_pushfstring">lua_pushfstring</a>(<a class="local col4 ref" href="#274L" title='L' data-ref="274L" data-ref-filename="274L">L</a>, <q>"%s: %s"</q>, <a class="local col6 ref" href="#276fname" title='fname' data-ref="276fname" data-ref-filename="276fname">fname</a>, <a class="ref fn" href="../include/string.h.html#strerror" title='strerror' data-ref="strerror" data-ref-filename="strerror">strerror</a>(<a class="local col7 ref" href="#277en" title='en' data-ref="277en" data-ref-filename="277en">en</a>));</td></tr>
<tr><th id="41">41</th><td>    <b>else</b></td></tr>
<tr><th id="42">42</th><td>      <a class="ref fn" href="lua.h.html#lua_pushfstring" title='lua_pushfstring' data-ref="lua_pushfstring" data-ref-filename="lua_pushfstring">lua_pushfstring</a>(<a class="local col4 ref" href="#274L" title='L' data-ref="274L" data-ref-filename="274L">L</a>, <q>"%s"</q>, <a class="ref fn" href="../include/string.h.html#strerror" title='strerror' data-ref="strerror" data-ref-filename="strerror">strerror</a>(<a class="local col7 ref" href="#277en" title='en' data-ref="277en" data-ref-filename="277en">en</a>));</td></tr>
<tr><th id="43">43</th><td>    <a class="ref fn" href="lj_obj.h.html#setintV" title='setintV' data-ref="setintV" data-ref-filename="setintV">setintV</a>(<a class="local col4 ref" href="#274L" title='L' data-ref="274L" data-ref-filename="274L">L</a>-&gt;<a class="ref field" href="lj_obj.h.html#lua_State::top" title='lua_State::top' data-ref="lua_State::top" data-ref-filename="lua_State..top">top</a>++, <a class="local col7 ref" href="#277en" title='en' data-ref="277en" data-ref-filename="277en">en</a>);</td></tr>
<tr><th id="44">44</th><td>    <a class="macro" href="lj_trace.h.html#45" title="((&amp;((GG_State *)((char *)((((global_State *)(void *)(L-&gt;glref).ptr64))) - ((int)__builtin_offsetof(GG_State, g))))-&gt;J)-&gt;state &amp;= ~LJ_TRACE_ACTIVE)" data-ref="_M/lj_trace_abort">lj_trace_abort</a>(<a class="macro" href="lj_obj.h.html#699" title="(((global_State *)(void *)(L-&gt;glref).ptr64))" data-ref="_M/G">G</a>(<a class="local col4 ref" href="#274L" title='L' data-ref="274L" data-ref-filename="274L">L</a>));</td></tr>
<tr><th id="45">45</th><td>    <b>return</b> <var>3</var>;</td></tr>
<tr><th id="46">46</th><td>  }</td></tr>
<tr><th id="47">47</th><td>}</td></tr>
<tr><th id="48">48</th><td></td></tr>
<tr><th id="49">49</th><td><a class="macro" href="luaconf.h.html#137" title="extern" data-ref="_M/LUALIB_API">LUALIB_API</a> <em>int</em> <dfn class="decl def fn" id="luaL_execresult" title='luaL_execresult' data-ref="luaL_execresult" data-ref-filename="luaL_execresult">luaL_execresult</dfn>(<a class="typedef" href="lua.h.html#lua_State" title='lua_State' data-type='struct lua_State' data-ref="lua_State" data-ref-filename="lua_State">lua_State</a> *<dfn class="local col8 decl" id="278L" title='L' data-type='lua_State *' data-ref="278L" data-ref-filename="278L">L</dfn>, <em>int</em> <dfn class="local col9 decl" id="279stat" title='stat' data-type='int' data-ref="279stat" data-ref-filename="279stat">stat</dfn>)</td></tr>
<tr><th id="50">50</th><td>{</td></tr>
<tr><th id="51">51</th><td>  <b>if</b> (<a class="local col9 ref" href="#279stat" title='stat' data-ref="279stat" data-ref-filename="279stat">stat</a> != -<var>1</var>) {</td></tr>
<tr><th id="52">52</th><td><u>#<span data-ppcond="52">if</span> <a class="macro" href="lj_arch.h.html#121" title="(2 &gt; 1)" data-ref="_M/LJ_TARGET_POSIX">LJ_TARGET_POSIX</a></u></td></tr>
<tr><th id="53">53</th><td>    <b>if</b> (<a class="macro" href="../include/stdlib.h.html#47" title="(((signed char) (((stat) &amp; 0x7f) + 1) &gt;&gt; 1) &gt; 0)" data-ref="_M/WIFSIGNALED">WIFSIGNALED</a>(<a class="local col9 ref" href="#279stat" title='stat' data-ref="279stat" data-ref-filename="279stat">stat</a>)) {</td></tr>
<tr><th id="54">54</th><td>      <a class="local col9 ref" href="#279stat" title='stat' data-ref="279stat" data-ref-filename="279stat">stat</a> = <a class="macro" href="../include/stdlib.h.html#44" title="((stat) &amp; 0x7f)" data-ref="_M/WTERMSIG">WTERMSIG</a>(<a class="local col9 ref" href="#279stat" title='stat' data-ref="279stat" data-ref-filename="279stat">stat</a>);</td></tr>
<tr><th id="55">55</th><td>      <a class="macro" href="lj_obj.h.html#865" title="((L-&gt;top++)-&gt;it64 = -1)" data-ref="_M/setnilV">setnilV</a>(<a class="local col8 ref" href="#278L" title='L' data-ref="278L" data-ref-filename="278L">L</a>-&gt;<a class="ref field" href="lj_obj.h.html#lua_State::top" title='lua_State::top' data-ref="lua_State::top" data-ref-filename="lua_State..top">top</a>++);</td></tr>
<tr><th id="56">56</th><td>      <a class="macro" href="lua.h.html#275" title="lua_pushlstring(L, &quot;&quot; &quot;signal&quot;, (sizeof(&quot;signal&quot;)/sizeof(char))-1)" data-ref="_M/lua_pushliteral">lua_pushliteral</a>(<a class="local col8 ref" href="#278L" title='L' data-ref="278L" data-ref-filename="278L">L</a>, <q>"signal"</q>);</td></tr>
<tr><th id="57">57</th><td>    } <b>else</b> {</td></tr>
<tr><th id="58">58</th><td>      <b>if</b> (<a class="macro" href="../include/stdlib.h.html#46" title="(((stat) &amp; 0x7f) == 0)" data-ref="_M/WIFEXITED">WIFEXITED</a>(<a class="local col9 ref" href="#279stat" title='stat' data-ref="279stat" data-ref-filename="279stat">stat</a>))</td></tr>
<tr><th id="59">59</th><td>	<a class="local col9 ref" href="#279stat" title='stat' data-ref="279stat" data-ref-filename="279stat">stat</a> = <a class="macro" href="../include/stdlib.h.html#43" title="(((stat) &amp; 0xff00) &gt;&gt; 8)" data-ref="_M/WEXITSTATUS">WEXITSTATUS</a>(<a class="local col9 ref" href="#279stat" title='stat' data-ref="279stat" data-ref-filename="279stat">stat</a>);</td></tr>
<tr><th id="60">60</th><td>      <b>if</b> (<a class="local col9 ref" href="#279stat" title='stat' data-ref="279stat" data-ref-filename="279stat">stat</a> == <var>0</var>)</td></tr>
<tr><th id="61">61</th><td>	<a class="macro" href="lj_obj.h.html#867" title="((L-&gt;top++)-&gt;it64 = (int64_t)~((uint64_t)((1)+1)&lt;&lt;47))" data-ref="_M/setboolV">setboolV</a>(<a class="local col8 ref" href="#278L" title='L' data-ref="278L" data-ref-filename="278L">L</a>-&gt;<a class="ref field" href="lj_obj.h.html#lua_State::top" title='lua_State::top' data-ref="lua_State::top" data-ref-filename="lua_State..top">top</a>++, <var>1</var>);</td></tr>
<tr><th id="62">62</th><td>      <b>else</b></td></tr>
<tr><th id="63">63</th><td>	<a class="macro" href="lj_obj.h.html#865" title="((L-&gt;top++)-&gt;it64 = -1)" data-ref="_M/setnilV">setnilV</a>(<a class="local col8 ref" href="#278L" title='L' data-ref="278L" data-ref-filename="278L">L</a>-&gt;<a class="ref field" href="lj_obj.h.html#lua_State::top" title='lua_State::top' data-ref="lua_State::top" data-ref-filename="lua_State..top">top</a>++);</td></tr>
<tr><th id="64">64</th><td>      <a class="macro" href="lua.h.html#275" title="lua_pushlstring(L, &quot;&quot; &quot;exit&quot;, (sizeof(&quot;exit&quot;)/sizeof(char))-1)" data-ref="_M/lua_pushliteral">lua_pushliteral</a>(<a class="local col8 ref" href="#278L" title='L' data-ref="278L" data-ref-filename="278L">L</a>, <q>"exit"</q>);</td></tr>
<tr><th id="65">65</th><td>    }</td></tr>
<tr><th id="66">66</th><td><u>#<span data-ppcond="52">else</span></u></td></tr>
<tr><th id="67">67</th><td>    <b>if</b> (stat == <var>0</var>)</td></tr>
<tr><th id="68">68</th><td>      setboolV(L-&gt;top++, <var>1</var>);</td></tr>
<tr><th id="69">69</th><td>    <b>else</b></td></tr>
<tr><th id="70">70</th><td>      setnilV(L-&gt;top++);</td></tr>
<tr><th id="71">71</th><td>    lua_pushliteral(L, <q>"exit"</q>);</td></tr>
<tr><th id="72">72</th><td><u>#<span data-ppcond="52">endif</span></u></td></tr>
<tr><th id="73">73</th><td>    <a class="ref fn" href="lj_obj.h.html#setintV" title='setintV' data-ref="setintV" data-ref-filename="setintV">setintV</a>(<a class="local col8 ref" href="#278L" title='L' data-ref="278L" data-ref-filename="278L">L</a>-&gt;<a class="ref field" href="lj_obj.h.html#lua_State::top" title='lua_State::top' data-ref="lua_State::top" data-ref-filename="lua_State..top">top</a>++, <a class="local col9 ref" href="#279stat" title='stat' data-ref="279stat" data-ref-filename="279stat">stat</a>);</td></tr>
<tr><th id="74">74</th><td>    <b>return</b> <var>3</var>;</td></tr>
<tr><th id="75">75</th><td>  }</td></tr>
<tr><th id="76">76</th><td>  <b>return</b> <a class="ref fn" href="#luaL_fileresult" title='luaL_fileresult' data-ref="luaL_fileresult" data-ref-filename="luaL_fileresult">luaL_fileresult</a>(<a class="local col8 ref" href="#278L" title='L' data-ref="278L" data-ref-filename="278L">L</a>, <var>0</var>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>);</td></tr>
<tr><th id="77">77</th><td>}</td></tr>
<tr><th id="78">78</th><td></td></tr>
<tr><th id="79">79</th><td><i>/* -- Module registration ------------------------------------------------- */</i></td></tr>
<tr><th id="80">80</th><td></td></tr>
<tr><th id="81">81</th><td><a class="macro" href="luaconf.h.html#137" title="extern" data-ref="_M/LUALIB_API">LUALIB_API</a> <em>const</em> <em>char</em> *<dfn class="decl def fn" id="luaL_findtable" title='luaL_findtable' data-ref="luaL_findtable" data-ref-filename="luaL_findtable">luaL_findtable</dfn>(<a class="typedef" href="lua.h.html#lua_State" title='lua_State' data-type='struct lua_State' data-ref="lua_State" data-ref-filename="lua_State">lua_State</a> *<dfn class="local col0 decl" id="280L" title='L' data-type='lua_State *' data-ref="280L" data-ref-filename="280L">L</dfn>, <em>int</em> <dfn class="local col1 decl" id="281idx" title='idx' data-type='int' data-ref="281idx" data-ref-filename="281idx">idx</dfn>,</td></tr>
<tr><th id="82">82</th><td>				      <em>const</em> <em>char</em> *<dfn class="local col2 decl" id="282fname" title='fname' data-type='const char *' data-ref="282fname" data-ref-filename="282fname">fname</dfn>, <em>int</em> <dfn class="local col3 decl" id="283szhint" title='szhint' data-type='int' data-ref="283szhint" data-ref-filename="283szhint">szhint</dfn>)</td></tr>
<tr><th id="83">83</th><td>{</td></tr>
<tr><th id="84">84</th><td>  <em>const</em> <em>char</em> *<dfn class="local col4 decl" id="284e" title='e' data-type='const char *' data-ref="284e" data-ref-filename="284e">e</dfn>;</td></tr>
<tr><th id="85">85</th><td>  <a class="ref fn" href="lua.h.html#lua_pushvalue" title='lua_pushvalue' data-ref="lua_pushvalue" data-ref-filename="lua_pushvalue">lua_pushvalue</a>(<a class="local col0 ref" href="#280L" title='L' data-ref="280L" data-ref-filename="280L">L</a>, <a class="local col1 ref" href="#281idx" title='idx' data-ref="281idx" data-ref-filename="281idx">idx</a>);</td></tr>
<tr><th id="86">86</th><td>  <b>do</b> {</td></tr>
<tr><th id="87">87</th><td>    <a class="local col4 ref" href="#284e" title='e' data-ref="284e" data-ref-filename="284e">e</a> = <a class="ref fn" href="../include/string.h.html#strchr" title='strchr' data-ref="strchr" data-ref-filename="strchr">strchr</a>(<a class="local col2 ref" href="#282fname" title='fname' data-ref="282fname" data-ref-filename="282fname">fname</a>, <kbd>'.'</kbd>);</td></tr>
<tr><th id="88">88</th><td>    <b>if</b> (<a class="local col4 ref" href="#284e" title='e' data-ref="284e" data-ref-filename="284e">e</a> == <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>) <a class="local col4 ref" href="#284e" title='e' data-ref="284e" data-ref-filename="284e">e</a> = <a class="local col2 ref" href="#282fname" title='fname' data-ref="282fname" data-ref-filename="282fname">fname</a> + <a class="ref fn" href="../include/string.h.html#strlen" title='strlen' data-ref="strlen" data-ref-filename="strlen">strlen</a>(<a class="local col2 ref" href="#282fname" title='fname' data-ref="282fname" data-ref-filename="282fname">fname</a>);</td></tr>
<tr><th id="89">89</th><td>    <a class="ref fn" href="lua.h.html#lua_pushlstring" title='lua_pushlstring' data-ref="lua_pushlstring" data-ref-filename="lua_pushlstring">lua_pushlstring</a>(<a class="local col0 ref" href="#280L" title='L' data-ref="280L" data-ref-filename="280L">L</a>, <a class="local col2 ref" href="#282fname" title='fname' data-ref="282fname" data-ref-filename="282fname">fname</a>, (<span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t" data-ref-filename="size_t">size_t</span>)(<a class="local col4 ref" href="#284e" title='e' data-ref="284e" data-ref-filename="284e">e</a> - <a class="local col2 ref" href="#282fname" title='fname' data-ref="282fname" data-ref-filename="282fname">fname</a>));</td></tr>
<tr><th id="90">90</th><td>    <a class="ref fn" href="lua.h.html#lua_rawget" title='lua_rawget' data-ref="lua_rawget" data-ref-filename="lua_rawget">lua_rawget</a>(<a class="local col0 ref" href="#280L" title='L' data-ref="280L" data-ref-filename="280L">L</a>, -<var>2</var>);</td></tr>
<tr><th id="91">91</th><td>    <b>if</b> (<a class="macro" href="lua.h.html#269" title="(lua_type(L, (-1)) == 0)" data-ref="_M/lua_isnil">lua_isnil</a>(<a class="local col0 ref" href="#280L" title='L' data-ref="280L" data-ref-filename="280L">L</a>, -<var>1</var>)) {  <i>/* no such field? */</i></td></tr>
<tr><th id="92">92</th><td>      <a class="macro" href="lua.h.html#256" title="lua_settop(L, -(1)-1)" data-ref="_M/lua_pop">lua_pop</a>(<a class="local col0 ref" href="#280L" title='L' data-ref="280L" data-ref-filename="280L">L</a>, <var>1</var>);  <i>/* remove this nil */</i></td></tr>
<tr><th id="93">93</th><td>      <a class="ref fn" href="lua.h.html#lua_createtable" title='lua_createtable' data-ref="lua_createtable" data-ref-filename="lua_createtable">lua_createtable</a>(<a class="local col0 ref" href="#280L" title='L' data-ref="280L" data-ref-filename="280L">L</a>, <var>0</var>, (*<a class="local col4 ref" href="#284e" title='e' data-ref="284e" data-ref-filename="284e">e</a> == <kbd>'.'</kbd> ? <var>1</var> : <a class="local col3 ref" href="#283szhint" title='szhint' data-ref="283szhint" data-ref-filename="283szhint">szhint</a>)); <i>/* new table for field */</i></td></tr>
<tr><th id="94">94</th><td>      <a class="ref fn" href="lua.h.html#lua_pushlstring" title='lua_pushlstring' data-ref="lua_pushlstring" data-ref-filename="lua_pushlstring">lua_pushlstring</a>(<a class="local col0 ref" href="#280L" title='L' data-ref="280L" data-ref-filename="280L">L</a>, <a class="local col2 ref" href="#282fname" title='fname' data-ref="282fname" data-ref-filename="282fname">fname</a>, (<span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t" data-ref-filename="size_t">size_t</span>)(<a class="local col4 ref" href="#284e" title='e' data-ref="284e" data-ref-filename="284e">e</a> - <a class="local col2 ref" href="#282fname" title='fname' data-ref="282fname" data-ref-filename="282fname">fname</a>));</td></tr>
<tr><th id="95">95</th><td>      <a class="ref fn" href="lua.h.html#lua_pushvalue" title='lua_pushvalue' data-ref="lua_pushvalue" data-ref-filename="lua_pushvalue">lua_pushvalue</a>(<a class="local col0 ref" href="#280L" title='L' data-ref="280L" data-ref-filename="280L">L</a>, -<var>2</var>);</td></tr>
<tr><th id="96">96</th><td>      <a class="ref fn" href="lua.h.html#lua_settable" title='lua_settable' data-ref="lua_settable" data-ref-filename="lua_settable">lua_settable</a>(<a class="local col0 ref" href="#280L" title='L' data-ref="280L" data-ref-filename="280L">L</a>, -<var>4</var>);  <i>/* set new table into field */</i></td></tr>
<tr><th id="97">97</th><td>    } <b>else</b> <b>if</b> (!<a class="macro" href="lua.h.html#267" title="(lua_type(L, (-1)) == 5)" data-ref="_M/lua_istable">lua_istable</a>(<a class="local col0 ref" href="#280L" title='L' data-ref="280L" data-ref-filename="280L">L</a>, -<var>1</var>)) {  <i>/* field has a non-table value? */</i></td></tr>
<tr><th id="98">98</th><td>      <a class="macro" href="lua.h.html#256" title="lua_settop(L, -(2)-1)" data-ref="_M/lua_pop">lua_pop</a>(<a class="local col0 ref" href="#280L" title='L' data-ref="280L" data-ref-filename="280L">L</a>, <var>2</var>);  <i>/* remove table and value */</i></td></tr>
<tr><th id="99">99</th><td>      <b>return</b> <a class="local col2 ref" href="#282fname" title='fname' data-ref="282fname" data-ref-filename="282fname">fname</a>;  <i>/* return problematic part of the name */</i></td></tr>
<tr><th id="100">100</th><td>    }</td></tr>
<tr><th id="101">101</th><td>    <a class="ref fn" href="lua.h.html#lua_remove" title='lua_remove' data-ref="lua_remove" data-ref-filename="lua_remove">lua_remove</a>(<a class="local col0 ref" href="#280L" title='L' data-ref="280L" data-ref-filename="280L">L</a>, -<var>2</var>);  <i>/* remove previous table */</i></td></tr>
<tr><th id="102">102</th><td>    <a class="local col2 ref" href="#282fname" title='fname' data-ref="282fname" data-ref-filename="282fname">fname</a> = <a class="local col4 ref" href="#284e" title='e' data-ref="284e" data-ref-filename="284e">e</a> + <var>1</var>;</td></tr>
<tr><th id="103">103</th><td>  } <b>while</b> (*<a class="local col4 ref" href="#284e" title='e' data-ref="284e" data-ref-filename="284e">e</a> == <kbd>'.'</kbd>);</td></tr>
<tr><th id="104">104</th><td>  <b>return</b> <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="105">105</th><td>}</td></tr>
<tr><th id="106">106</th><td></td></tr>
<tr><th id="107">107</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="libsize" title='libsize' data-type='int libsize(const luaL_Reg * l)' data-ref="libsize" data-ref-filename="libsize">libsize</dfn>(<em>const</em> <a class="typedef" href="lauxlib.h.html#luaL_Reg" title='luaL_Reg' data-type='struct luaL_Reg' data-ref="luaL_Reg" data-ref-filename="luaL_Reg">luaL_Reg</a> *<dfn class="local col5 decl" id="285l" title='l' data-type='const luaL_Reg *' data-ref="285l" data-ref-filename="285l">l</dfn>)</td></tr>
<tr><th id="108">108</th><td>{</td></tr>
<tr><th id="109">109</th><td>  <em>int</em> <dfn class="local col6 decl" id="286size" title='size' data-type='int' data-ref="286size" data-ref-filename="286size">size</dfn> = <var>0</var>;</td></tr>
<tr><th id="110">110</th><td>  <b>for</b> (; <a class="local col5 ref" href="#285l" title='l' data-ref="285l" data-ref-filename="285l">l</a> &amp;&amp; <a class="local col5 ref" href="#285l" title='l' data-ref="285l" data-ref-filename="285l">l</a>-&gt;<a class="ref field" href="lauxlib.h.html#luaL_Reg::name" title='luaL_Reg::name' data-ref="luaL_Reg::name" data-ref-filename="luaL_Reg..name">name</a>; <a class="local col5 ref" href="#285l" title='l' data-ref="285l" data-ref-filename="285l">l</a>++) <a class="local col6 ref" href="#286size" title='size' data-ref="286size" data-ref-filename="286size">size</a>++;</td></tr>
<tr><th id="111">111</th><td>  <b>return</b> <a class="local col6 ref" href="#286size" title='size' data-ref="286size" data-ref-filename="286size">size</a>;</td></tr>
<tr><th id="112">112</th><td>}</td></tr>
<tr><th id="113">113</th><td></td></tr>
<tr><th id="114">114</th><td><a class="macro" href="luaconf.h.html#137" title="extern" data-ref="_M/LUALIB_API">LUALIB_API</a> <em>void</em> <dfn class="decl def fn" id="luaL_pushmodule" title='luaL_pushmodule' data-ref="luaL_pushmodule" data-ref-filename="luaL_pushmodule">luaL_pushmodule</dfn>(<a class="typedef" href="lua.h.html#lua_State" title='lua_State' data-type='struct lua_State' data-ref="lua_State" data-ref-filename="lua_State">lua_State</a> *<dfn class="local col7 decl" id="287L" title='L' data-type='lua_State *' data-ref="287L" data-ref-filename="287L">L</dfn>, <em>const</em> <em>char</em> *<dfn class="local col8 decl" id="288modname" title='modname' data-type='const char *' data-ref="288modname" data-ref-filename="288modname">modname</dfn>, <em>int</em> <dfn class="local col9 decl" id="289sizehint" title='sizehint' data-type='int' data-ref="289sizehint" data-ref-filename="289sizehint">sizehint</dfn>)</td></tr>
<tr><th id="115">115</th><td>{</td></tr>
<tr><th id="116">116</th><td>  <a class="ref fn" href="#luaL_findtable" title='luaL_findtable' data-ref="luaL_findtable" data-ref-filename="luaL_findtable">luaL_findtable</a>(<a class="local col7 ref" href="#287L" title='L' data-ref="287L" data-ref-filename="287L">L</a>, <a class="macro" href="lua.h.html#36" title="(-10000)" data-ref="_M/LUA_REGISTRYINDEX">LUA_REGISTRYINDEX</a>, <q>"_LOADED"</q>, <var>16</var>);</td></tr>
<tr><th id="117">117</th><td>  <a class="ref fn" href="lua.h.html#lua_getfield" title='lua_getfield' data-ref="lua_getfield" data-ref-filename="lua_getfield">lua_getfield</a>(<a class="local col7 ref" href="#287L" title='L' data-ref="287L" data-ref-filename="287L">L</a>, -<var>1</var>, <a class="local col8 ref" href="#288modname" title='modname' data-ref="288modname" data-ref-filename="288modname">modname</a>);</td></tr>
<tr><th id="118">118</th><td>  <b>if</b> (!<a class="macro" href="lua.h.html#267" title="(lua_type(L, (-1)) == 5)" data-ref="_M/lua_istable">lua_istable</a>(<a class="local col7 ref" href="#287L" title='L' data-ref="287L" data-ref-filename="287L">L</a>, -<var>1</var>)) {</td></tr>
<tr><th id="119">119</th><td>    <a class="macro" href="lua.h.html#256" title="lua_settop(L, -(1)-1)" data-ref="_M/lua_pop">lua_pop</a>(<a class="local col7 ref" href="#287L" title='L' data-ref="287L" data-ref-filename="287L">L</a>, <var>1</var>);</td></tr>
<tr><th id="120">120</th><td>    <b>if</b> (<a class="ref fn" href="#luaL_findtable" title='luaL_findtable' data-ref="luaL_findtable" data-ref-filename="luaL_findtable">luaL_findtable</a>(<a class="local col7 ref" href="#287L" title='L' data-ref="287L" data-ref-filename="287L">L</a>, <a class="macro" href="lua.h.html#38" title="(-10002)" data-ref="_M/LUA_GLOBALSINDEX">LUA_GLOBALSINDEX</a>, <a class="local col8 ref" href="#288modname" title='modname' data-ref="288modname" data-ref-filename="288modname">modname</a>, <a class="local col9 ref" href="#289sizehint" title='sizehint' data-ref="289sizehint" data-ref-filename="289sizehint">sizehint</a>) != <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>)</td></tr>
<tr><th id="121">121</th><td>      <a class="ref fn" href="lj_err.h.html#lj_err_callerv" title='lj_err_callerv' data-ref="lj_err_callerv" data-ref-filename="lj_err_callerv">lj_err_callerv</a>(<a class="local col7 ref" href="#287L" title='L' data-ref="287L" data-ref-filename="287L">L</a>, <a class="enum" href="lj_errmsg.h.html#102" title='LJ_ERR_BADMODN' data-ref="LJ_ERR_BADMODN" data-ref-filename="LJ_ERR_BADMODN">LJ_ERR_BADMODN</a>, <a class="local col8 ref" href="#288modname" title='modname' data-ref="288modname" data-ref-filename="288modname">modname</a>);</td></tr>
<tr><th id="122">122</th><td>    <a class="ref fn" href="lua.h.html#lua_pushvalue" title='lua_pushvalue' data-ref="lua_pushvalue" data-ref-filename="lua_pushvalue">lua_pushvalue</a>(<a class="local col7 ref" href="#287L" title='L' data-ref="287L" data-ref-filename="287L">L</a>, -<var>1</var>);</td></tr>
<tr><th id="123">123</th><td>    <a class="ref fn" href="lua.h.html#lua_setfield" title='lua_setfield' data-ref="lua_setfield" data-ref-filename="lua_setfield">lua_setfield</a>(<a class="local col7 ref" href="#287L" title='L' data-ref="287L" data-ref-filename="287L">L</a>, -<var>3</var>, <a class="local col8 ref" href="#288modname" title='modname' data-ref="288modname" data-ref-filename="288modname">modname</a>);  <i>/* _LOADED[modname] = new table. */</i></td></tr>
<tr><th id="124">124</th><td>  }</td></tr>
<tr><th id="125">125</th><td>  <a class="ref fn" href="lua.h.html#lua_remove" title='lua_remove' data-ref="lua_remove" data-ref-filename="lua_remove">lua_remove</a>(<a class="local col7 ref" href="#287L" title='L' data-ref="287L" data-ref-filename="287L">L</a>, -<var>2</var>);  <i>/* Remove _LOADED table. */</i></td></tr>
<tr><th id="126">126</th><td>}</td></tr>
<tr><th id="127">127</th><td></td></tr>
<tr><th id="128">128</th><td><a class="macro" href="luaconf.h.html#137" title="extern" data-ref="_M/LUALIB_API">LUALIB_API</a> <em>void</em> <dfn class="decl def fn" id="luaL_openlib" title='luaL_openlib' data-ref="luaL_openlib" data-ref-filename="luaL_openlib">luaL_openlib</dfn>(<a class="typedef" href="lua.h.html#lua_State" title='lua_State' data-type='struct lua_State' data-ref="lua_State" data-ref-filename="lua_State">lua_State</a> *<dfn class="local col0 decl" id="290L" title='L' data-type='lua_State *' data-ref="290L" data-ref-filename="290L">L</dfn>, <em>const</em> <em>char</em> *<dfn class="local col1 decl" id="291libname" title='libname' data-type='const char *' data-ref="291libname" data-ref-filename="291libname">libname</dfn>,</td></tr>
<tr><th id="129">129</th><td>			     <em>const</em> <a class="typedef" href="lauxlib.h.html#luaL_Reg" title='luaL_Reg' data-type='struct luaL_Reg' data-ref="luaL_Reg" data-ref-filename="luaL_Reg">luaL_Reg</a> *<dfn class="local col2 decl" id="292l" title='l' data-type='const luaL_Reg *' data-ref="292l" data-ref-filename="292l">l</dfn>, <em>int</em> <dfn class="local col3 decl" id="293nup" title='nup' data-type='int' data-ref="293nup" data-ref-filename="293nup">nup</dfn>)</td></tr>
<tr><th id="130">130</th><td>{</td></tr>
<tr><th id="131">131</th><td>  <a class="macro" href="lj_lib.h.html#73" title="((void)(L))" data-ref="_M/lj_lib_checkfpu">lj_lib_checkfpu</a>(<a class="local col0 ref" href="#290L" title='L' data-ref="290L" data-ref-filename="290L">L</a>);</td></tr>
<tr><th id="132">132</th><td>  <b>if</b> (<a class="local col1 ref" href="#291libname" title='libname' data-ref="291libname" data-ref-filename="291libname">libname</a>) {</td></tr>
<tr><th id="133">133</th><td>    <a class="ref fn" href="#luaL_pushmodule" title='luaL_pushmodule' data-ref="luaL_pushmodule" data-ref-filename="luaL_pushmodule">luaL_pushmodule</a>(<a class="local col0 ref" href="#290L" title='L' data-ref="290L" data-ref-filename="290L">L</a>, <a class="local col1 ref" href="#291libname" title='libname' data-ref="291libname" data-ref-filename="291libname">libname</a>, <a class="tu ref fn" href="#libsize" title='libsize' data-use='c' data-ref="libsize" data-ref-filename="libsize">libsize</a>(<a class="local col2 ref" href="#292l" title='l' data-ref="292l" data-ref-filename="292l">l</a>));</td></tr>
<tr><th id="134">134</th><td>    <a class="ref fn" href="lua.h.html#lua_insert" title='lua_insert' data-ref="lua_insert" data-ref-filename="lua_insert">lua_insert</a>(<a class="local col0 ref" href="#290L" title='L' data-ref="290L" data-ref-filename="290L">L</a>, -(<a class="local col3 ref" href="#293nup" title='nup' data-ref="293nup" data-ref-filename="293nup">nup</a> + <var>1</var>));  <i>/* Move module table below upvalues. */</i></td></tr>
<tr><th id="135">135</th><td>  }</td></tr>
<tr><th id="136">136</th><td>  <b>if</b> (<a class="local col2 ref" href="#292l" title='l' data-ref="292l" data-ref-filename="292l">l</a>)</td></tr>
<tr><th id="137">137</th><td>    <a class="ref fn" href="#luaL_setfuncs" title='luaL_setfuncs' data-ref="luaL_setfuncs" data-ref-filename="luaL_setfuncs">luaL_setfuncs</a>(<a class="local col0 ref" href="#290L" title='L' data-ref="290L" data-ref-filename="290L">L</a>, <a class="local col2 ref" href="#292l" title='l' data-ref="292l" data-ref-filename="292l">l</a>, <a class="local col3 ref" href="#293nup" title='nup' data-ref="293nup" data-ref-filename="293nup">nup</a>);</td></tr>
<tr><th id="138">138</th><td>  <b>else</b></td></tr>
<tr><th id="139">139</th><td>    <a class="macro" href="lua.h.html#256" title="lua_settop(L, -(nup)-1)" data-ref="_M/lua_pop">lua_pop</a>(<a class="local col0 ref" href="#290L" title='L' data-ref="290L" data-ref-filename="290L">L</a>, <a class="local col3 ref" href="#293nup" title='nup' data-ref="293nup" data-ref-filename="293nup">nup</a>);  <i>/* Remove upvalues. */</i></td></tr>
<tr><th id="140">140</th><td>}</td></tr>
<tr><th id="141">141</th><td></td></tr>
<tr><th id="142">142</th><td><a class="macro" href="luaconf.h.html#137" title="extern" data-ref="_M/LUALIB_API">LUALIB_API</a> <em>void</em> <dfn class="decl def fn" id="luaL_register" title='luaL_register' data-ref="luaL_register" data-ref-filename="luaL_register">luaL_register</dfn>(<a class="typedef" href="lua.h.html#lua_State" title='lua_State' data-type='struct lua_State' data-ref="lua_State" data-ref-filename="lua_State">lua_State</a> *<dfn class="local col4 decl" id="294L" title='L' data-type='lua_State *' data-ref="294L" data-ref-filename="294L">L</dfn>, <em>const</em> <em>char</em> *<dfn class="local col5 decl" id="295libname" title='libname' data-type='const char *' data-ref="295libname" data-ref-filename="295libname">libname</dfn>,</td></tr>
<tr><th id="143">143</th><td>			      <em>const</em> <a class="typedef" href="lauxlib.h.html#luaL_Reg" title='luaL_Reg' data-type='struct luaL_Reg' data-ref="luaL_Reg" data-ref-filename="luaL_Reg">luaL_Reg</a> *<dfn class="local col6 decl" id="296l" title='l' data-type='const luaL_Reg *' data-ref="296l" data-ref-filename="296l">l</dfn>)</td></tr>
<tr><th id="144">144</th><td>{</td></tr>
<tr><th id="145">145</th><td>  <a class="ref fn" href="#luaL_openlib" title='luaL_openlib' data-ref="luaL_openlib" data-ref-filename="luaL_openlib">luaL_openlib</a>(<a class="local col4 ref" href="#294L" title='L' data-ref="294L" data-ref-filename="294L">L</a>, <a class="local col5 ref" href="#295libname" title='libname' data-ref="295libname" data-ref-filename="295libname">libname</a>, <a class="local col6 ref" href="#296l" title='l' data-ref="296l" data-ref-filename="296l">l</a>, <var>0</var>);</td></tr>
<tr><th id="146">146</th><td>}</td></tr>
<tr><th id="147">147</th><td></td></tr>
<tr><th id="148">148</th><td><a class="macro" href="luaconf.h.html#137" title="extern" data-ref="_M/LUALIB_API">LUALIB_API</a> <em>void</em> <dfn class="decl def fn" id="luaL_setfuncs" title='luaL_setfuncs' data-ref="luaL_setfuncs" data-ref-filename="luaL_setfuncs">luaL_setfuncs</dfn>(<a class="typedef" href="lua.h.html#lua_State" title='lua_State' data-type='struct lua_State' data-ref="lua_State" data-ref-filename="lua_State">lua_State</a> *<dfn class="local col7 decl" id="297L" title='L' data-type='lua_State *' data-ref="297L" data-ref-filename="297L">L</dfn>, <em>const</em> <a class="typedef" href="lauxlib.h.html#luaL_Reg" title='luaL_Reg' data-type='struct luaL_Reg' data-ref="luaL_Reg" data-ref-filename="luaL_Reg">luaL_Reg</a> *<dfn class="local col8 decl" id="298l" title='l' data-type='const luaL_Reg *' data-ref="298l" data-ref-filename="298l">l</dfn>, <em>int</em> <dfn class="local col9 decl" id="299nup" title='nup' data-type='int' data-ref="299nup" data-ref-filename="299nup">nup</dfn>)</td></tr>
<tr><th id="149">149</th><td>{</td></tr>
<tr><th id="150">150</th><td>  <a class="ref fn" href="lauxlib.h.html#luaL_checkstack" title='luaL_checkstack' data-ref="luaL_checkstack" data-ref-filename="luaL_checkstack">luaL_checkstack</a>(<a class="local col7 ref" href="#297L" title='L' data-ref="297L" data-ref-filename="297L">L</a>, <a class="local col9 ref" href="#299nup" title='nup' data-ref="299nup" data-ref-filename="299nup">nup</a>, <q>"too many upvalues"</q>);</td></tr>
<tr><th id="151">151</th><td>  <b>for</b> (; <a class="local col8 ref" href="#298l" title='l' data-ref="298l" data-ref-filename="298l">l</a>-&gt;<a class="ref field" href="lauxlib.h.html#luaL_Reg::name" title='luaL_Reg::name' data-ref="luaL_Reg::name" data-ref-filename="luaL_Reg..name">name</a>; <a class="local col8 ref" href="#298l" title='l' data-ref="298l" data-ref-filename="298l">l</a>++) {</td></tr>
<tr><th id="152">152</th><td>    <em>int</em> <dfn class="local col0 decl" id="300i" title='i' data-type='int' data-ref="300i" data-ref-filename="300i">i</dfn>;</td></tr>
<tr><th id="153">153</th><td>    <b>for</b> (<a class="local col0 ref" href="#300i" title='i' data-ref="300i" data-ref-filename="300i">i</a> = <var>0</var>; <a class="local col0 ref" href="#300i" title='i' data-ref="300i" data-ref-filename="300i">i</a> &lt; <a class="local col9 ref" href="#299nup" title='nup' data-ref="299nup" data-ref-filename="299nup">nup</a>; <a class="local col0 ref" href="#300i" title='i' data-ref="300i" data-ref-filename="300i">i</a>++)  <i>/* Copy upvalues to the top. */</i></td></tr>
<tr><th id="154">154</th><td>      <a class="ref fn" href="lua.h.html#lua_pushvalue" title='lua_pushvalue' data-ref="lua_pushvalue" data-ref-filename="lua_pushvalue">lua_pushvalue</a>(<a class="local col7 ref" href="#297L" title='L' data-ref="297L" data-ref-filename="297L">L</a>, -<a class="local col9 ref" href="#299nup" title='nup' data-ref="299nup" data-ref-filename="299nup">nup</a>);</td></tr>
<tr><th id="155">155</th><td>    <a class="ref fn" href="lua.h.html#lua_pushcclosure" title='lua_pushcclosure' data-ref="lua_pushcclosure" data-ref-filename="lua_pushcclosure">lua_pushcclosure</a>(<a class="local col7 ref" href="#297L" title='L' data-ref="297L" data-ref-filename="297L">L</a>, <a class="local col8 ref" href="#298l" title='l' data-ref="298l" data-ref-filename="298l">l</a>-&gt;<a class="ref field" href="lauxlib.h.html#luaL_Reg::func" title='luaL_Reg::func' data-ref="luaL_Reg::func" data-ref-filename="luaL_Reg..func">func</a>, <a class="local col9 ref" href="#299nup" title='nup' data-ref="299nup" data-ref-filename="299nup">nup</a>);</td></tr>
<tr><th id="156">156</th><td>    <a class="ref fn" href="lua.h.html#lua_setfield" title='lua_setfield' data-ref="lua_setfield" data-ref-filename="lua_setfield">lua_setfield</a>(<a class="local col7 ref" href="#297L" title='L' data-ref="297L" data-ref-filename="297L">L</a>, -(<a class="local col9 ref" href="#299nup" title='nup' data-ref="299nup" data-ref-filename="299nup">nup</a> + <var>2</var>), <a class="local col8 ref" href="#298l" title='l' data-ref="298l" data-ref-filename="298l">l</a>-&gt;<a class="ref field" href="lauxlib.h.html#luaL_Reg::name" title='luaL_Reg::name' data-ref="luaL_Reg::name" data-ref-filename="luaL_Reg..name">name</a>);</td></tr>
<tr><th id="157">157</th><td>  }</td></tr>
<tr><th id="158">158</th><td>  <a class="macro" href="lua.h.html#256" title="lua_settop(L, -(nup)-1)" data-ref="_M/lua_pop">lua_pop</a>(<a class="local col7 ref" href="#297L" title='L' data-ref="297L" data-ref-filename="297L">L</a>, <a class="local col9 ref" href="#299nup" title='nup' data-ref="299nup" data-ref-filename="299nup">nup</a>);  <i>/* Remove upvalues. */</i></td></tr>
<tr><th id="159">159</th><td>}</td></tr>
<tr><th id="160">160</th><td></td></tr>
<tr><th id="161">161</th><td><a class="macro" href="luaconf.h.html#137" title="extern" data-ref="_M/LUALIB_API">LUALIB_API</a> <em>const</em> <em>char</em> *<dfn class="decl def fn" id="luaL_gsub" title='luaL_gsub' data-ref="luaL_gsub" data-ref-filename="luaL_gsub">luaL_gsub</dfn>(<a class="typedef" href="lua.h.html#lua_State" title='lua_State' data-type='struct lua_State' data-ref="lua_State" data-ref-filename="lua_State">lua_State</a> *<dfn class="local col1 decl" id="301L" title='L' data-type='lua_State *' data-ref="301L" data-ref-filename="301L">L</dfn>, <em>const</em> <em>char</em> *<dfn class="local col2 decl" id="302s" title='s' data-type='const char *' data-ref="302s" data-ref-filename="302s">s</dfn>,</td></tr>
<tr><th id="162">162</th><td>				 <em>const</em> <em>char</em> *<dfn class="local col3 decl" id="303p" title='p' data-type='const char *' data-ref="303p" data-ref-filename="303p">p</dfn>, <em>const</em> <em>char</em> *<dfn class="local col4 decl" id="304r" title='r' data-type='const char *' data-ref="304r" data-ref-filename="304r">r</dfn>)</td></tr>
<tr><th id="163">163</th><td>{</td></tr>
<tr><th id="164">164</th><td>  <em>const</em> <em>char</em> *<dfn class="local col5 decl" id="305wild" title='wild' data-type='const char *' data-ref="305wild" data-ref-filename="305wild">wild</dfn>;</td></tr>
<tr><th id="165">165</th><td>  <span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t" data-ref-filename="size_t">size_t</span> <dfn class="local col6 decl" id="306l" title='l' data-type='size_t' data-ref="306l" data-ref-filename="306l">l</dfn> = <a class="ref fn" href="../include/string.h.html#strlen" title='strlen' data-ref="strlen" data-ref-filename="strlen">strlen</a>(<a class="local col3 ref" href="#303p" title='p' data-ref="303p" data-ref-filename="303p">p</a>);</td></tr>
<tr><th id="166">166</th><td>  <a class="typedef" href="lauxlib.h.html#luaL_Buffer" title='luaL_Buffer' data-type='struct luaL_Buffer' data-ref="luaL_Buffer" data-ref-filename="luaL_Buffer">luaL_Buffer</a> <dfn class="local col7 decl" id="307b" title='b' data-type='luaL_Buffer' data-ref="307b" data-ref-filename="307b">b</dfn>;</td></tr>
<tr><th id="167">167</th><td>  <a class="ref fn" href="#luaL_buffinit" title='luaL_buffinit' data-ref="luaL_buffinit" data-ref-filename="luaL_buffinit">luaL_buffinit</a>(<a class="local col1 ref" href="#301L" title='L' data-ref="301L" data-ref-filename="301L">L</a>, &amp;<a class="local col7 ref" href="#307b" title='b' data-ref="307b" data-ref-filename="307b">b</a>);</td></tr>
<tr><th id="168">168</th><td>  <b>while</b> ((<a class="local col5 ref" href="#305wild" title='wild' data-ref="305wild" data-ref-filename="305wild">wild</a> = <a class="ref fn" href="../include/string.h.html#strstr" title='strstr' data-ref="strstr" data-ref-filename="strstr">strstr</a>(<a class="local col2 ref" href="#302s" title='s' data-ref="302s" data-ref-filename="302s">s</a>, <a class="local col3 ref" href="#303p" title='p' data-ref="303p" data-ref-filename="303p">p</a>)) != <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>) {</td></tr>
<tr><th id="169">169</th><td>    <a class="ref fn" href="#luaL_addlstring" title='luaL_addlstring' data-ref="luaL_addlstring" data-ref-filename="luaL_addlstring">luaL_addlstring</a>(&amp;<a class="local col7 ref" href="#307b" title='b' data-ref="307b" data-ref-filename="307b">b</a>, <a class="local col2 ref" href="#302s" title='s' data-ref="302s" data-ref-filename="302s">s</a>, (<span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t" data-ref-filename="size_t">size_t</span>)(<a class="local col5 ref" href="#305wild" title='wild' data-ref="305wild" data-ref-filename="305wild">wild</a> - <a class="local col2 ref" href="#302s" title='s' data-ref="302s" data-ref-filename="302s">s</a>));  <i>/* push prefix */</i></td></tr>
<tr><th id="170">170</th><td>    <a class="ref fn" href="#luaL_addstring" title='luaL_addstring' data-ref="luaL_addstring" data-ref-filename="luaL_addstring">luaL_addstring</a>(&amp;<a class="local col7 ref" href="#307b" title='b' data-ref="307b" data-ref-filename="307b">b</a>, <a class="local col4 ref" href="#304r" title='r' data-ref="304r" data-ref-filename="304r">r</a>);  <i>/* push replacement in place of pattern */</i></td></tr>
<tr><th id="171">171</th><td>    <a class="local col2 ref" href="#302s" title='s' data-ref="302s" data-ref-filename="302s">s</a> = <a class="local col5 ref" href="#305wild" title='wild' data-ref="305wild" data-ref-filename="305wild">wild</a> + <a class="local col6 ref" href="#306l" title='l' data-ref="306l" data-ref-filename="306l">l</a>;  <i>/* continue after `p' */</i></td></tr>
<tr><th id="172">172</th><td>  }</td></tr>
<tr><th id="173">173</th><td>  <a class="ref fn" href="#luaL_addstring" title='luaL_addstring' data-ref="luaL_addstring" data-ref-filename="luaL_addstring">luaL_addstring</a>(&amp;<a class="local col7 ref" href="#307b" title='b' data-ref="307b" data-ref-filename="307b">b</a>, <a class="local col2 ref" href="#302s" title='s' data-ref="302s" data-ref-filename="302s">s</a>);  <i>/* push last suffix */</i></td></tr>
<tr><th id="174">174</th><td>  <a class="ref fn" href="#luaL_pushresult" title='luaL_pushresult' data-ref="luaL_pushresult" data-ref-filename="luaL_pushresult">luaL_pushresult</a>(&amp;<a class="local col7 ref" href="#307b" title='b' data-ref="307b" data-ref-filename="307b">b</a>);</td></tr>
<tr><th id="175">175</th><td>  <b>return</b> <a class="macro" href="lua.h.html#281" title="lua_tolstring(L, (-1), ((void*)0))" data-ref="_M/lua_tostring">lua_tostring</a>(<a class="local col1 ref" href="#301L" title='L' data-ref="301L" data-ref-filename="301L">L</a>, -<var>1</var>);</td></tr>
<tr><th id="176">176</th><td>}</td></tr>
<tr><th id="177">177</th><td></td></tr>
<tr><th id="178">178</th><td><i>/* -- Buffer handling ----------------------------------------------------- */</i></td></tr>
<tr><th id="179">179</th><td></td></tr>
<tr><th id="180">180</th><td><u>#define <dfn class="macro" id="_M/bufflen" data-ref="_M/bufflen">bufflen</dfn>(B)	((<span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t" data-ref-filename="size_t">size_t</span>)((B)-&gt;<a class="ref field" href="lauxlib.h.html#luaL_Buffer::p" title='luaL_Buffer::p' data-ref="luaL_Buffer::p" data-ref-filename="luaL_Buffer..p">p</a> - (B)-&gt;<a class="ref field" href="lauxlib.h.html#luaL_Buffer::buffer" title='luaL_Buffer::buffer' data-ref="luaL_Buffer::buffer" data-ref-filename="luaL_Buffer..buffer">buffer</a>))</u></td></tr>
<tr><th id="181">181</th><td><u>#define <dfn class="macro" id="_M/bufffree" data-ref="_M/bufffree">bufffree</dfn>(B)	((<span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t" data-ref-filename="size_t">size_t</span>)(LUAL_BUFFERSIZE - bufflen(B)))</u></td></tr>
<tr><th id="182">182</th><td></td></tr>
<tr><th id="183">183</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="emptybuffer" title='emptybuffer' data-type='int emptybuffer(luaL_Buffer * B)' data-ref="emptybuffer" data-ref-filename="emptybuffer">emptybuffer</dfn>(<a class="typedef" href="lauxlib.h.html#luaL_Buffer" title='luaL_Buffer' data-type='struct luaL_Buffer' data-ref="luaL_Buffer" data-ref-filename="luaL_Buffer">luaL_Buffer</a> *<dfn class="local col8 decl" id="308B" title='B' data-type='luaL_Buffer *' data-ref="308B" data-ref-filename="308B">B</dfn>)</td></tr>
<tr><th id="184">184</th><td>{</td></tr>
<tr><th id="185">185</th><td>  <span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t" data-ref-filename="size_t">size_t</span> <dfn class="local col9 decl" id="309l" title='l' data-type='size_t' data-ref="309l" data-ref-filename="309l">l</dfn> = <a class="macro" href="#180" title="((size_t)((B)-&gt;p - (B)-&gt;buffer))" data-ref="_M/bufflen">bufflen</a>(<a class="local col8 ref" href="#308B" title='B' data-ref="308B" data-ref-filename="308B">B</a>);</td></tr>
<tr><th id="186">186</th><td>  <b>if</b> (<a class="local col9 ref" href="#309l" title='l' data-ref="309l" data-ref-filename="309l">l</a> == <var>0</var>)</td></tr>
<tr><th id="187">187</th><td>    <b>return</b> <var>0</var>;  <i>/* put nothing on stack */</i></td></tr>
<tr><th id="188">188</th><td>  <a class="ref fn" href="lua.h.html#lua_pushlstring" title='lua_pushlstring' data-ref="lua_pushlstring" data-ref-filename="lua_pushlstring">lua_pushlstring</a>(<a class="local col8 ref" href="#308B" title='B' data-ref="308B" data-ref-filename="308B">B</a>-&gt;<a class="ref field" href="lauxlib.h.html#luaL_Buffer::L" title='luaL_Buffer::L' data-ref="luaL_Buffer::L" data-ref-filename="luaL_Buffer..L">L</a>, <a class="local col8 ref" href="#308B" title='B' data-ref="308B" data-ref-filename="308B">B</a>-&gt;<a class="ref field" href="lauxlib.h.html#luaL_Buffer::buffer" title='luaL_Buffer::buffer' data-ref="luaL_Buffer::buffer" data-ref-filename="luaL_Buffer..buffer">buffer</a>, <a class="local col9 ref" href="#309l" title='l' data-ref="309l" data-ref-filename="309l">l</a>);</td></tr>
<tr><th id="189">189</th><td>  <a class="local col8 ref" href="#308B" title='B' data-ref="308B" data-ref-filename="308B">B</a>-&gt;<a class="ref field" href="lauxlib.h.html#luaL_Buffer::p" title='luaL_Buffer::p' data-ref="luaL_Buffer::p" data-ref-filename="luaL_Buffer..p">p</a> = <a class="local col8 ref" href="#308B" title='B' data-ref="308B" data-ref-filename="308B">B</a>-&gt;<a class="ref field" href="lauxlib.h.html#luaL_Buffer::buffer" title='luaL_Buffer::buffer' data-ref="luaL_Buffer::buffer" data-ref-filename="luaL_Buffer..buffer">buffer</a>;</td></tr>
<tr><th id="190">190</th><td>  <a class="local col8 ref" href="#308B" title='B' data-ref="308B" data-ref-filename="308B">B</a>-&gt;<a class="ref field" href="lauxlib.h.html#luaL_Buffer::lvl" title='luaL_Buffer::lvl' data-ref="luaL_Buffer::lvl" data-ref-filename="luaL_Buffer..lvl">lvl</a>++;</td></tr>
<tr><th id="191">191</th><td>  <b>return</b> <var>1</var>;</td></tr>
<tr><th id="192">192</th><td>}</td></tr>
<tr><th id="193">193</th><td></td></tr>
<tr><th id="194">194</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="adjuststack" title='adjuststack' data-type='void adjuststack(luaL_Buffer * B)' data-ref="adjuststack" data-ref-filename="adjuststack">adjuststack</dfn>(<a class="typedef" href="lauxlib.h.html#luaL_Buffer" title='luaL_Buffer' data-type='struct luaL_Buffer' data-ref="luaL_Buffer" data-ref-filename="luaL_Buffer">luaL_Buffer</a> *<dfn class="local col0 decl" id="310B" title='B' data-type='luaL_Buffer *' data-ref="310B" data-ref-filename="310B">B</dfn>)</td></tr>
<tr><th id="195">195</th><td>{</td></tr>
<tr><th id="196">196</th><td>  <b>if</b> (<a class="local col0 ref" href="#310B" title='B' data-ref="310B" data-ref-filename="310B">B</a>-&gt;<a class="ref field" href="lauxlib.h.html#luaL_Buffer::lvl" title='luaL_Buffer::lvl' data-ref="luaL_Buffer::lvl" data-ref-filename="luaL_Buffer..lvl">lvl</a> &gt; <var>1</var>) {</td></tr>
<tr><th id="197">197</th><td>    <a class="typedef" href="lua.h.html#lua_State" title='lua_State' data-type='struct lua_State' data-ref="lua_State" data-ref-filename="lua_State">lua_State</a> *<dfn class="local col1 decl" id="311L" title='L' data-type='lua_State *' data-ref="311L" data-ref-filename="311L">L</dfn> = <a class="local col0 ref" href="#310B" title='B' data-ref="310B" data-ref-filename="310B">B</a>-&gt;<a class="ref field" href="lauxlib.h.html#luaL_Buffer::L" title='luaL_Buffer::L' data-ref="luaL_Buffer::L" data-ref-filename="luaL_Buffer..L">L</a>;</td></tr>
<tr><th id="198">198</th><td>    <em>int</em> <dfn class="local col2 decl" id="312toget" title='toget' data-type='int' data-ref="312toget" data-ref-filename="312toget">toget</dfn> = <var>1</var>;  <i>/* number of levels to concat */</i></td></tr>
<tr><th id="199">199</th><td>    <span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t" data-ref-filename="size_t">size_t</span> <dfn class="local col3 decl" id="313toplen" title='toplen' data-type='size_t' data-ref="313toplen" data-ref-filename="313toplen">toplen</dfn> = <a class="macro" href="lua.h.html#264" title="lua_objlen(L, (-1))" data-ref="_M/lua_strlen">lua_strlen</a>(<a class="local col1 ref" href="#311L" title='L' data-ref="311L" data-ref-filename="311L">L</a>, -<var>1</var>);</td></tr>
<tr><th id="200">200</th><td>    <b>do</b> {</td></tr>
<tr><th id="201">201</th><td>      <span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t" data-ref-filename="size_t">size_t</span> <dfn class="local col4 decl" id="314l" title='l' data-type='size_t' data-ref="314l" data-ref-filename="314l">l</dfn> = <a class="macro" href="lua.h.html#264" title="lua_objlen(L, (-(toget+1)))" data-ref="_M/lua_strlen">lua_strlen</a>(<a class="local col1 ref" href="#311L" title='L' data-ref="311L" data-ref-filename="311L">L</a>, -(<a class="local col2 ref" href="#312toget" title='toget' data-ref="312toget" data-ref-filename="312toget">toget</a>+<var>1</var>));</td></tr>
<tr><th id="202">202</th><td>      <b>if</b> (!(<a class="local col0 ref" href="#310B" title='B' data-ref="310B" data-ref-filename="310B">B</a>-&gt;<a class="ref field" href="lauxlib.h.html#luaL_Buffer::lvl" title='luaL_Buffer::lvl' data-ref="luaL_Buffer::lvl" data-ref-filename="luaL_Buffer..lvl">lvl</a> - <a class="local col2 ref" href="#312toget" title='toget' data-ref="312toget" data-ref-filename="312toget">toget</a> + <var>1</var> &gt;= <a class="macro" href="lua.h.html#88" title="20" data-ref="_M/LUA_MINSTACK">LUA_MINSTACK</a>/<var>2</var> || <a class="local col3 ref" href="#313toplen" title='toplen' data-ref="313toplen" data-ref-filename="313toplen">toplen</a> &gt; <a class="local col4 ref" href="#314l" title='l' data-ref="314l" data-ref-filename="314l">l</a>))</td></tr>
<tr><th id="203">203</th><td>	<b>break</b>;</td></tr>
<tr><th id="204">204</th><td>      <a class="local col3 ref" href="#313toplen" title='toplen' data-ref="313toplen" data-ref-filename="313toplen">toplen</a> += <a class="local col4 ref" href="#314l" title='l' data-ref="314l" data-ref-filename="314l">l</a>;</td></tr>
<tr><th id="205">205</th><td>      <a class="local col2 ref" href="#312toget" title='toget' data-ref="312toget" data-ref-filename="312toget">toget</a>++;</td></tr>
<tr><th id="206">206</th><td>    } <b>while</b> (<a class="local col2 ref" href="#312toget" title='toget' data-ref="312toget" data-ref-filename="312toget">toget</a> &lt; <a class="local col0 ref" href="#310B" title='B' data-ref="310B" data-ref-filename="310B">B</a>-&gt;<a class="ref field" href="lauxlib.h.html#luaL_Buffer::lvl" title='luaL_Buffer::lvl' data-ref="luaL_Buffer::lvl" data-ref-filename="luaL_Buffer..lvl">lvl</a>);</td></tr>
<tr><th id="207">207</th><td>    <a class="ref fn" href="lua.h.html#lua_concat" title='lua_concat' data-ref="lua_concat" data-ref-filename="lua_concat">lua_concat</a>(<a class="local col1 ref" href="#311L" title='L' data-ref="311L" data-ref-filename="311L">L</a>, <a class="local col2 ref" href="#312toget" title='toget' data-ref="312toget" data-ref-filename="312toget">toget</a>);</td></tr>
<tr><th id="208">208</th><td>    <a class="local col0 ref" href="#310B" title='B' data-ref="310B" data-ref-filename="310B">B</a>-&gt;<a class="ref field" href="lauxlib.h.html#luaL_Buffer::lvl" title='luaL_Buffer::lvl' data-ref="luaL_Buffer::lvl" data-ref-filename="luaL_Buffer..lvl">lvl</a> = <a class="local col0 ref" href="#310B" title='B' data-ref="310B" data-ref-filename="310B">B</a>-&gt;<a class="ref field" href="lauxlib.h.html#luaL_Buffer::lvl" title='luaL_Buffer::lvl' data-ref="luaL_Buffer::lvl" data-ref-filename="luaL_Buffer..lvl">lvl</a> - <a class="local col2 ref" href="#312toget" title='toget' data-ref="312toget" data-ref-filename="312toget">toget</a> + <var>1</var>;</td></tr>
<tr><th id="209">209</th><td>  }</td></tr>
<tr><th id="210">210</th><td>}</td></tr>
<tr><th id="211">211</th><td></td></tr>
<tr><th id="212">212</th><td><a class="macro" href="luaconf.h.html#137" title="extern" data-ref="_M/LUALIB_API">LUALIB_API</a> <em>char</em> *<dfn class="decl def fn" id="luaL_prepbuffer" title='luaL_prepbuffer' data-ref="luaL_prepbuffer" data-ref-filename="luaL_prepbuffer">luaL_prepbuffer</dfn>(<a class="typedef" href="lauxlib.h.html#luaL_Buffer" title='luaL_Buffer' data-type='struct luaL_Buffer' data-ref="luaL_Buffer" data-ref-filename="luaL_Buffer">luaL_Buffer</a> *<dfn class="local col5 decl" id="315B" title='B' data-type='luaL_Buffer *' data-ref="315B" data-ref-filename="315B">B</dfn>)</td></tr>
<tr><th id="213">213</th><td>{</td></tr>
<tr><th id="214">214</th><td>  <b>if</b> (<a class="tu ref fn" href="#emptybuffer" title='emptybuffer' data-use='c' data-ref="emptybuffer" data-ref-filename="emptybuffer">emptybuffer</a>(<a class="local col5 ref" href="#315B" title='B' data-ref="315B" data-ref-filename="315B">B</a>))</td></tr>
<tr><th id="215">215</th><td>    <a class="tu ref fn" href="#adjuststack" title='adjuststack' data-use='c' data-ref="adjuststack" data-ref-filename="adjuststack">adjuststack</a>(<a class="local col5 ref" href="#315B" title='B' data-ref="315B" data-ref-filename="315B">B</a>);</td></tr>
<tr><th id="216">216</th><td>  <b>return</b> <a class="local col5 ref" href="#315B" title='B' data-ref="315B" data-ref-filename="315B">B</a>-&gt;<a class="ref field" href="lauxlib.h.html#luaL_Buffer::buffer" title='luaL_Buffer::buffer' data-ref="luaL_Buffer::buffer" data-ref-filename="luaL_Buffer..buffer">buffer</a>;</td></tr>
<tr><th id="217">217</th><td>}</td></tr>
<tr><th id="218">218</th><td></td></tr>
<tr><th id="219">219</th><td><a class="macro" href="luaconf.h.html#137" title="extern" data-ref="_M/LUALIB_API">LUALIB_API</a> <em>void</em> <dfn class="decl def fn" id="luaL_addlstring" title='luaL_addlstring' data-ref="luaL_addlstring" data-ref-filename="luaL_addlstring">luaL_addlstring</dfn>(<a class="typedef" href="lauxlib.h.html#luaL_Buffer" title='luaL_Buffer' data-type='struct luaL_Buffer' data-ref="luaL_Buffer" data-ref-filename="luaL_Buffer">luaL_Buffer</a> *<dfn class="local col6 decl" id="316B" title='B' data-type='luaL_Buffer *' data-ref="316B" data-ref-filename="316B">B</dfn>, <em>const</em> <em>char</em> *<dfn class="local col7 decl" id="317s" title='s' data-type='const char *' data-ref="317s" data-ref-filename="317s">s</dfn>, <span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t" data-ref-filename="size_t">size_t</span> <dfn class="local col8 decl" id="318l" title='l' data-type='size_t' data-ref="318l" data-ref-filename="318l">l</dfn>)</td></tr>
<tr><th id="220">220</th><td>{</td></tr>
<tr><th id="221">221</th><td>  <b>if</b> (<a class="local col8 ref" href="#318l" title='l' data-ref="318l" data-ref-filename="318l">l</a> &lt;= <a class="macro" href="#181" title="((size_t)((8192 &gt; 16384 ? 8192 : 8192) - ((size_t)((B)-&gt;p - (B)-&gt;buffer))))" data-ref="_M/bufffree">bufffree</a>(<a class="local col6 ref" href="#316B" title='B' data-ref="316B" data-ref-filename="316B">B</a>)) {</td></tr>
<tr><th id="222">222</th><td>    <a class="ref fn" href="../include/string.h.html#memcpy" title='memcpy' data-ref="memcpy" data-ref-filename="memcpy">memcpy</a>(<a class="local col6 ref" href="#316B" title='B' data-ref="316B" data-ref-filename="316B">B</a>-&gt;<a class="ref field" href="lauxlib.h.html#luaL_Buffer::p" title='luaL_Buffer::p' data-ref="luaL_Buffer::p" data-ref-filename="luaL_Buffer..p">p</a>, <a class="local col7 ref" href="#317s" title='s' data-ref="317s" data-ref-filename="317s">s</a>, <a class="local col8 ref" href="#318l" title='l' data-ref="318l" data-ref-filename="318l">l</a>);</td></tr>
<tr><th id="223">223</th><td>    <a class="local col6 ref" href="#316B" title='B' data-ref="316B" data-ref-filename="316B">B</a>-&gt;<a class="ref field" href="lauxlib.h.html#luaL_Buffer::p" title='luaL_Buffer::p' data-ref="luaL_Buffer::p" data-ref-filename="luaL_Buffer..p">p</a> += <a class="local col8 ref" href="#318l" title='l' data-ref="318l" data-ref-filename="318l">l</a>;</td></tr>
<tr><th id="224">224</th><td>  } <b>else</b> {</td></tr>
<tr><th id="225">225</th><td>    <a class="tu ref fn" href="#emptybuffer" title='emptybuffer' data-use='c' data-ref="emptybuffer" data-ref-filename="emptybuffer">emptybuffer</a>(<a class="local col6 ref" href="#316B" title='B' data-ref="316B" data-ref-filename="316B">B</a>);</td></tr>
<tr><th id="226">226</th><td>    <a class="ref fn" href="lua.h.html#lua_pushlstring" title='lua_pushlstring' data-ref="lua_pushlstring" data-ref-filename="lua_pushlstring">lua_pushlstring</a>(<a class="local col6 ref" href="#316B" title='B' data-ref="316B" data-ref-filename="316B">B</a>-&gt;<a class="ref field" href="lauxlib.h.html#luaL_Buffer::L" title='luaL_Buffer::L' data-ref="luaL_Buffer::L" data-ref-filename="luaL_Buffer..L">L</a>, <a class="local col7 ref" href="#317s" title='s' data-ref="317s" data-ref-filename="317s">s</a>, <a class="local col8 ref" href="#318l" title='l' data-ref="318l" data-ref-filename="318l">l</a>);</td></tr>
<tr><th id="227">227</th><td>    <a class="local col6 ref" href="#316B" title='B' data-ref="316B" data-ref-filename="316B">B</a>-&gt;<a class="ref field" href="lauxlib.h.html#luaL_Buffer::lvl" title='luaL_Buffer::lvl' data-ref="luaL_Buffer::lvl" data-ref-filename="luaL_Buffer..lvl">lvl</a>++;</td></tr>
<tr><th id="228">228</th><td>    <a class="tu ref fn" href="#adjuststack" title='adjuststack' data-use='c' data-ref="adjuststack" data-ref-filename="adjuststack">adjuststack</a>(<a class="local col6 ref" href="#316B" title='B' data-ref="316B" data-ref-filename="316B">B</a>);</td></tr>
<tr><th id="229">229</th><td>  }</td></tr>
<tr><th id="230">230</th><td>}</td></tr>
<tr><th id="231">231</th><td></td></tr>
<tr><th id="232">232</th><td><a class="macro" href="luaconf.h.html#137" title="extern" data-ref="_M/LUALIB_API">LUALIB_API</a> <em>void</em> <dfn class="decl def fn" id="luaL_addstring" title='luaL_addstring' data-ref="luaL_addstring" data-ref-filename="luaL_addstring">luaL_addstring</dfn>(<a class="typedef" href="lauxlib.h.html#luaL_Buffer" title='luaL_Buffer' data-type='struct luaL_Buffer' data-ref="luaL_Buffer" data-ref-filename="luaL_Buffer">luaL_Buffer</a> *<dfn class="local col9 decl" id="319B" title='B' data-type='luaL_Buffer *' data-ref="319B" data-ref-filename="319B">B</dfn>, <em>const</em> <em>char</em> *<dfn class="local col0 decl" id="320s" title='s' data-type='const char *' data-ref="320s" data-ref-filename="320s">s</dfn>)</td></tr>
<tr><th id="233">233</th><td>{</td></tr>
<tr><th id="234">234</th><td>  <a class="ref fn" href="#luaL_addlstring" title='luaL_addlstring' data-ref="luaL_addlstring" data-ref-filename="luaL_addlstring">luaL_addlstring</a>(<a class="local col9 ref" href="#319B" title='B' data-ref="319B" data-ref-filename="319B">B</a>, <a class="local col0 ref" href="#320s" title='s' data-ref="320s" data-ref-filename="320s">s</a>, <a class="ref fn" href="../include/string.h.html#strlen" title='strlen' data-ref="strlen" data-ref-filename="strlen">strlen</a>(<a class="local col0 ref" href="#320s" title='s' data-ref="320s" data-ref-filename="320s">s</a>));</td></tr>
<tr><th id="235">235</th><td>}</td></tr>
<tr><th id="236">236</th><td></td></tr>
<tr><th id="237">237</th><td><a class="macro" href="luaconf.h.html#137" title="extern" data-ref="_M/LUALIB_API">LUALIB_API</a> <em>void</em> <dfn class="decl def fn" id="luaL_pushresult" title='luaL_pushresult' data-ref="luaL_pushresult" data-ref-filename="luaL_pushresult">luaL_pushresult</dfn>(<a class="typedef" href="lauxlib.h.html#luaL_Buffer" title='luaL_Buffer' data-type='struct luaL_Buffer' data-ref="luaL_Buffer" data-ref-filename="luaL_Buffer">luaL_Buffer</a> *<dfn class="local col1 decl" id="321B" title='B' data-type='luaL_Buffer *' data-ref="321B" data-ref-filename="321B">B</dfn>)</td></tr>
<tr><th id="238">238</th><td>{</td></tr>
<tr><th id="239">239</th><td>  <a class="tu ref fn" href="#emptybuffer" title='emptybuffer' data-use='c' data-ref="emptybuffer" data-ref-filename="emptybuffer">emptybuffer</a>(<a class="local col1 ref" href="#321B" title='B' data-ref="321B" data-ref-filename="321B">B</a>);</td></tr>
<tr><th id="240">240</th><td>  <a class="ref fn" href="lua.h.html#lua_concat" title='lua_concat' data-ref="lua_concat" data-ref-filename="lua_concat">lua_concat</a>(<a class="local col1 ref" href="#321B" title='B' data-ref="321B" data-ref-filename="321B">B</a>-&gt;<a class="ref field" href="lauxlib.h.html#luaL_Buffer::L" title='luaL_Buffer::L' data-ref="luaL_Buffer::L" data-ref-filename="luaL_Buffer..L">L</a>, <a class="local col1 ref" href="#321B" title='B' data-ref="321B" data-ref-filename="321B">B</a>-&gt;<a class="ref field" href="lauxlib.h.html#luaL_Buffer::lvl" title='luaL_Buffer::lvl' data-ref="luaL_Buffer::lvl" data-ref-filename="luaL_Buffer..lvl">lvl</a>);</td></tr>
<tr><th id="241">241</th><td>  <a class="local col1 ref" href="#321B" title='B' data-ref="321B" data-ref-filename="321B">B</a>-&gt;<a class="ref field" href="lauxlib.h.html#luaL_Buffer::lvl" title='luaL_Buffer::lvl' data-ref="luaL_Buffer::lvl" data-ref-filename="luaL_Buffer..lvl">lvl</a> = <var>1</var>;</td></tr>
<tr><th id="242">242</th><td>}</td></tr>
<tr><th id="243">243</th><td></td></tr>
<tr><th id="244">244</th><td><a class="macro" href="luaconf.h.html#137" title="extern" data-ref="_M/LUALIB_API">LUALIB_API</a> <em>void</em> <dfn class="decl def fn" id="luaL_addvalue" title='luaL_addvalue' data-ref="luaL_addvalue" data-ref-filename="luaL_addvalue">luaL_addvalue</dfn>(<a class="typedef" href="lauxlib.h.html#luaL_Buffer" title='luaL_Buffer' data-type='struct luaL_Buffer' data-ref="luaL_Buffer" data-ref-filename="luaL_Buffer">luaL_Buffer</a> *<dfn class="local col2 decl" id="322B" title='B' data-type='luaL_Buffer *' data-ref="322B" data-ref-filename="322B">B</dfn>)</td></tr>
<tr><th id="245">245</th><td>{</td></tr>
<tr><th id="246">246</th><td>  <a class="typedef" href="lua.h.html#lua_State" title='lua_State' data-type='struct lua_State' data-ref="lua_State" data-ref-filename="lua_State">lua_State</a> *<dfn class="local col3 decl" id="323L" title='L' data-type='lua_State *' data-ref="323L" data-ref-filename="323L">L</dfn> = <a class="local col2 ref" href="#322B" title='B' data-ref="322B" data-ref-filename="322B">B</a>-&gt;<a class="ref field" href="lauxlib.h.html#luaL_Buffer::L" title='luaL_Buffer::L' data-ref="luaL_Buffer::L" data-ref-filename="luaL_Buffer..L">L</a>;</td></tr>
<tr><th id="247">247</th><td>  <span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t" data-ref-filename="size_t">size_t</span> <dfn class="local col4 decl" id="324vl" title='vl' data-type='size_t' data-ref="324vl" data-ref-filename="324vl">vl</dfn>;</td></tr>
<tr><th id="248">248</th><td>  <em>const</em> <em>char</em> *<dfn class="local col5 decl" id="325s" title='s' data-type='const char *' data-ref="325s" data-ref-filename="325s">s</dfn> = <a class="ref fn" href="lua.h.html#lua_tolstring" title='lua_tolstring' data-ref="lua_tolstring" data-ref-filename="lua_tolstring">lua_tolstring</a>(<a class="local col3 ref" href="#323L" title='L' data-ref="323L" data-ref-filename="323L">L</a>, -<var>1</var>, &amp;<a class="local col4 ref" href="#324vl" title='vl' data-ref="324vl" data-ref-filename="324vl">vl</a>);</td></tr>
<tr><th id="249">249</th><td>  <b>if</b> (<a class="local col4 ref" href="#324vl" title='vl' data-ref="324vl" data-ref-filename="324vl">vl</a> &lt;= <a class="macro" href="#181" title="((size_t)((8192 &gt; 16384 ? 8192 : 8192) - ((size_t)((B)-&gt;p - (B)-&gt;buffer))))" data-ref="_M/bufffree">bufffree</a>(<a class="local col2 ref" href="#322B" title='B' data-ref="322B" data-ref-filename="322B">B</a>)) {  <i>/* fit into buffer? */</i></td></tr>
<tr><th id="250">250</th><td>    <a class="ref fn" href="../include/string.h.html#memcpy" title='memcpy' data-ref="memcpy" data-ref-filename="memcpy">memcpy</a>(<a class="local col2 ref" href="#322B" title='B' data-ref="322B" data-ref-filename="322B">B</a>-&gt;<a class="ref field" href="lauxlib.h.html#luaL_Buffer::p" title='luaL_Buffer::p' data-ref="luaL_Buffer::p" data-ref-filename="luaL_Buffer..p">p</a>, <a class="local col5 ref" href="#325s" title='s' data-ref="325s" data-ref-filename="325s">s</a>, <a class="local col4 ref" href="#324vl" title='vl' data-ref="324vl" data-ref-filename="324vl">vl</a>);  <i>/* put it there */</i></td></tr>
<tr><th id="251">251</th><td>    <a class="local col2 ref" href="#322B" title='B' data-ref="322B" data-ref-filename="322B">B</a>-&gt;<a class="ref field" href="lauxlib.h.html#luaL_Buffer::p" title='luaL_Buffer::p' data-ref="luaL_Buffer::p" data-ref-filename="luaL_Buffer..p">p</a> += <a class="local col4 ref" href="#324vl" title='vl' data-ref="324vl" data-ref-filename="324vl">vl</a>;</td></tr>
<tr><th id="252">252</th><td>    <a class="macro" href="lua.h.html#256" title="lua_settop(L, -(1)-1)" data-ref="_M/lua_pop">lua_pop</a>(<a class="local col3 ref" href="#323L" title='L' data-ref="323L" data-ref-filename="323L">L</a>, <var>1</var>);  <i>/* remove from stack */</i></td></tr>
<tr><th id="253">253</th><td>  } <b>else</b> {</td></tr>
<tr><th id="254">254</th><td>    <b>if</b> (<a class="tu ref fn" href="#emptybuffer" title='emptybuffer' data-use='c' data-ref="emptybuffer" data-ref-filename="emptybuffer">emptybuffer</a>(<a class="local col2 ref" href="#322B" title='B' data-ref="322B" data-ref-filename="322B">B</a>))</td></tr>
<tr><th id="255">255</th><td>      <a class="ref fn" href="lua.h.html#lua_insert" title='lua_insert' data-ref="lua_insert" data-ref-filename="lua_insert">lua_insert</a>(<a class="local col3 ref" href="#323L" title='L' data-ref="323L" data-ref-filename="323L">L</a>, -<var>2</var>);  <i>/* put buffer before new value */</i></td></tr>
<tr><th id="256">256</th><td>    <a class="local col2 ref" href="#322B" title='B' data-ref="322B" data-ref-filename="322B">B</a>-&gt;<a class="ref field" href="lauxlib.h.html#luaL_Buffer::lvl" title='luaL_Buffer::lvl' data-ref="luaL_Buffer::lvl" data-ref-filename="luaL_Buffer..lvl">lvl</a>++;  <i>/* add new value into B stack */</i></td></tr>
<tr><th id="257">257</th><td>    <a class="tu ref fn" href="#adjuststack" title='adjuststack' data-use='c' data-ref="adjuststack" data-ref-filename="adjuststack">adjuststack</a>(<a class="local col2 ref" href="#322B" title='B' data-ref="322B" data-ref-filename="322B">B</a>);</td></tr>
<tr><th id="258">258</th><td>  }</td></tr>
<tr><th id="259">259</th><td>}</td></tr>
<tr><th id="260">260</th><td></td></tr>
<tr><th id="261">261</th><td><a class="macro" href="luaconf.h.html#137" title="extern" data-ref="_M/LUALIB_API">LUALIB_API</a> <em>void</em> <dfn class="decl def fn" id="luaL_buffinit" title='luaL_buffinit' data-ref="luaL_buffinit" data-ref-filename="luaL_buffinit">luaL_buffinit</dfn>(<a class="typedef" href="lua.h.html#lua_State" title='lua_State' data-type='struct lua_State' data-ref="lua_State" data-ref-filename="lua_State">lua_State</a> *<dfn class="local col6 decl" id="326L" title='L' data-type='lua_State *' data-ref="326L" data-ref-filename="326L">L</dfn>, <a class="typedef" href="lauxlib.h.html#luaL_Buffer" title='luaL_Buffer' data-type='struct luaL_Buffer' data-ref="luaL_Buffer" data-ref-filename="luaL_Buffer">luaL_Buffer</a> *<dfn class="local col7 decl" id="327B" title='B' data-type='luaL_Buffer *' data-ref="327B" data-ref-filename="327B">B</dfn>)</td></tr>
<tr><th id="262">262</th><td>{</td></tr>
<tr><th id="263">263</th><td>  <a class="local col7 ref" href="#327B" title='B' data-ref="327B" data-ref-filename="327B">B</a>-&gt;<a class="ref field" href="lauxlib.h.html#luaL_Buffer::L" title='luaL_Buffer::L' data-ref="luaL_Buffer::L" data-ref-filename="luaL_Buffer..L">L</a> = <a class="local col6 ref" href="#326L" title='L' data-ref="326L" data-ref-filename="326L">L</a>;</td></tr>
<tr><th id="264">264</th><td>  <a class="local col7 ref" href="#327B" title='B' data-ref="327B" data-ref-filename="327B">B</a>-&gt;<a class="ref field" href="lauxlib.h.html#luaL_Buffer::p" title='luaL_Buffer::p' data-ref="luaL_Buffer::p" data-ref-filename="luaL_Buffer..p">p</a> = <a class="local col7 ref" href="#327B" title='B' data-ref="327B" data-ref-filename="327B">B</a>-&gt;<a class="ref field" href="lauxlib.h.html#luaL_Buffer::buffer" title='luaL_Buffer::buffer' data-ref="luaL_Buffer::buffer" data-ref-filename="luaL_Buffer..buffer">buffer</a>;</td></tr>
<tr><th id="265">265</th><td>  <a class="local col7 ref" href="#327B" title='B' data-ref="327B" data-ref-filename="327B">B</a>-&gt;<a class="ref field" href="lauxlib.h.html#luaL_Buffer::lvl" title='luaL_Buffer::lvl' data-ref="luaL_Buffer::lvl" data-ref-filename="luaL_Buffer..lvl">lvl</a> = <var>0</var>;</td></tr>
<tr><th id="266">266</th><td>}</td></tr>
<tr><th id="267">267</th><td></td></tr>
<tr><th id="268">268</th><td><i>/* -- Reference management ------------------------------------------------ */</i></td></tr>
<tr><th id="269">269</th><td></td></tr>
<tr><th id="270">270</th><td><u>#define <dfn class="macro" id="_M/FREELIST_REF" data-ref="_M/FREELIST_REF">FREELIST_REF</dfn>	0</u></td></tr>
<tr><th id="271">271</th><td></td></tr>
<tr><th id="272">272</th><td><i>/* Convert a stack index to an absolute index. */</i></td></tr>
<tr><th id="273">273</th><td><u>#define <dfn class="macro" id="_M/abs_index" data-ref="_M/abs_index">abs_index</dfn>(L, i) \</u></td></tr>
<tr><th id="274">274</th><td><u>  ((i) &gt; 0 || (i) &lt;= LUA_REGISTRYINDEX ? (i) : <a class="ref fn" href="lua.h.html#lua_gettop" title='lua_gettop' data-ref="lua_gettop" data-ref-filename="lua_gettop">lua_gettop</a>(L) + (i) + 1)</u></td></tr>
<tr><th id="275">275</th><td></td></tr>
<tr><th id="276">276</th><td><a class="macro" href="luaconf.h.html#137" title="extern" data-ref="_M/LUALIB_API">LUALIB_API</a> <em>int</em> <dfn class="decl def fn" id="luaL_ref" title='luaL_ref' data-ref="luaL_ref" data-ref-filename="luaL_ref">luaL_ref</dfn>(<a class="typedef" href="lua.h.html#lua_State" title='lua_State' data-type='struct lua_State' data-ref="lua_State" data-ref-filename="lua_State">lua_State</a> *<dfn class="local col8 decl" id="328L" title='L' data-type='lua_State *' data-ref="328L" data-ref-filename="328L">L</dfn>, <em>int</em> <dfn class="local col9 decl" id="329t" title='t' data-type='int' data-ref="329t" data-ref-filename="329t">t</dfn>)</td></tr>
<tr><th id="277">277</th><td>{</td></tr>
<tr><th id="278">278</th><td>  <em>int</em> <dfn class="local col0 decl" id="330ref" title='ref' data-type='int' data-ref="330ref" data-ref-filename="330ref">ref</dfn>;</td></tr>
<tr><th id="279">279</th><td>  <a class="local col9 ref" href="#329t" title='t' data-ref="329t" data-ref-filename="329t">t</a> = <a class="macro" href="#273" title="((t) &gt; 0 || (t) &lt;= (-10000) ? (t) : lua_gettop(L) + (t) + 1)" data-ref="_M/abs_index">abs_index</a>(<a class="local col8 ref" href="#328L" title='L' data-ref="328L" data-ref-filename="328L">L</a>, <a class="local col9 ref" href="#329t" title='t' data-ref="329t" data-ref-filename="329t">t</a>);</td></tr>
<tr><th id="280">280</th><td>  <b>if</b> (<a class="macro" href="lua.h.html#269" title="(lua_type(L, (-1)) == 0)" data-ref="_M/lua_isnil">lua_isnil</a>(<a class="local col8 ref" href="#328L" title='L' data-ref="328L" data-ref-filename="328L">L</a>, -<var>1</var>)) {</td></tr>
<tr><th id="281">281</th><td>    <a class="macro" href="lua.h.html#256" title="lua_settop(L, -(1)-1)" data-ref="_M/lua_pop">lua_pop</a>(<a class="local col8 ref" href="#328L" title='L' data-ref="328L" data-ref-filename="328L">L</a>, <var>1</var>);  <i>/* remove from stack */</i></td></tr>
<tr><th id="282">282</th><td>    <b>return</b> <a class="macro" href="lauxlib.h.html#60" title="(-1)" data-ref="_M/LUA_REFNIL">LUA_REFNIL</a>;  <i>/* `nil' has a unique fixed reference */</i></td></tr>
<tr><th id="283">283</th><td>  }</td></tr>
<tr><th id="284">284</th><td>  <a class="ref fn" href="lua.h.html#lua_rawgeti" title='lua_rawgeti' data-ref="lua_rawgeti" data-ref-filename="lua_rawgeti">lua_rawgeti</a>(<a class="local col8 ref" href="#328L" title='L' data-ref="328L" data-ref-filename="328L">L</a>, <a class="local col9 ref" href="#329t" title='t' data-ref="329t" data-ref-filename="329t">t</a>, <a class="macro" href="#270" title="0" data-ref="_M/FREELIST_REF">FREELIST_REF</a>);  <i>/* get first free element */</i></td></tr>
<tr><th id="285">285</th><td>  <a class="local col0 ref" href="#330ref" title='ref' data-ref="330ref" data-ref-filename="330ref">ref</a> = (<em>int</em>)<a class="ref fn" href="lua.h.html#lua_tointeger" title='lua_tointeger' data-ref="lua_tointeger" data-ref-filename="lua_tointeger">lua_tointeger</a>(<a class="local col8 ref" href="#328L" title='L' data-ref="328L" data-ref-filename="328L">L</a>, -<var>1</var>);  <i>/* ref = t[FREELIST_REF] */</i></td></tr>
<tr><th id="286">286</th><td>  <a class="macro" href="lua.h.html#256" title="lua_settop(L, -(1)-1)" data-ref="_M/lua_pop">lua_pop</a>(<a class="local col8 ref" href="#328L" title='L' data-ref="328L" data-ref-filename="328L">L</a>, <var>1</var>);  <i>/* remove it from stack */</i></td></tr>
<tr><th id="287">287</th><td>  <b>if</b> (<a class="local col0 ref" href="#330ref" title='ref' data-ref="330ref" data-ref-filename="330ref">ref</a> != <var>0</var>) {  <i>/* any free element? */</i></td></tr>
<tr><th id="288">288</th><td>    <a class="ref fn" href="lua.h.html#lua_rawgeti" title='lua_rawgeti' data-ref="lua_rawgeti" data-ref-filename="lua_rawgeti">lua_rawgeti</a>(<a class="local col8 ref" href="#328L" title='L' data-ref="328L" data-ref-filename="328L">L</a>, <a class="local col9 ref" href="#329t" title='t' data-ref="329t" data-ref-filename="329t">t</a>, <a class="local col0 ref" href="#330ref" title='ref' data-ref="330ref" data-ref-filename="330ref">ref</a>);  <i>/* remove it from list */</i></td></tr>
<tr><th id="289">289</th><td>    <a class="ref fn" href="lua.h.html#lua_rawseti" title='lua_rawseti' data-ref="lua_rawseti" data-ref-filename="lua_rawseti">lua_rawseti</a>(<a class="local col8 ref" href="#328L" title='L' data-ref="328L" data-ref-filename="328L">L</a>, <a class="local col9 ref" href="#329t" title='t' data-ref="329t" data-ref-filename="329t">t</a>, <a class="macro" href="#270" title="0" data-ref="_M/FREELIST_REF">FREELIST_REF</a>);  <i>/* (t[FREELIST_REF] = t[ref]) */</i></td></tr>
<tr><th id="290">290</th><td>  } <b>else</b> {  <i>/* no free elements */</i></td></tr>
<tr><th id="291">291</th><td>    <a class="local col0 ref" href="#330ref" title='ref' data-ref="330ref" data-ref-filename="330ref">ref</a> = (<em>int</em>)<a class="ref fn" href="lua.h.html#lua_objlen" title='lua_objlen' data-ref="lua_objlen" data-ref-filename="lua_objlen">lua_objlen</a>(<a class="local col8 ref" href="#328L" title='L' data-ref="328L" data-ref-filename="328L">L</a>, <a class="local col9 ref" href="#329t" title='t' data-ref="329t" data-ref-filename="329t">t</a>);</td></tr>
<tr><th id="292">292</th><td>    <a class="local col0 ref" href="#330ref" title='ref' data-ref="330ref" data-ref-filename="330ref">ref</a>++;  <i>/* create new reference */</i></td></tr>
<tr><th id="293">293</th><td>  }</td></tr>
<tr><th id="294">294</th><td>  <a class="ref fn" href="lua.h.html#lua_rawseti" title='lua_rawseti' data-ref="lua_rawseti" data-ref-filename="lua_rawseti">lua_rawseti</a>(<a class="local col8 ref" href="#328L" title='L' data-ref="328L" data-ref-filename="328L">L</a>, <a class="local col9 ref" href="#329t" title='t' data-ref="329t" data-ref-filename="329t">t</a>, <a class="local col0 ref" href="#330ref" title='ref' data-ref="330ref" data-ref-filename="330ref">ref</a>);</td></tr>
<tr><th id="295">295</th><td>  <b>return</b> <a class="local col0 ref" href="#330ref" title='ref' data-ref="330ref" data-ref-filename="330ref">ref</a>;</td></tr>
<tr><th id="296">296</th><td>}</td></tr>
<tr><th id="297">297</th><td></td></tr>
<tr><th id="298">298</th><td><a class="macro" href="luaconf.h.html#137" title="extern" data-ref="_M/LUALIB_API">LUALIB_API</a> <em>void</em> <dfn class="decl def fn" id="luaL_unref" title='luaL_unref' data-ref="luaL_unref" data-ref-filename="luaL_unref">luaL_unref</dfn>(<a class="typedef" href="lua.h.html#lua_State" title='lua_State' data-type='struct lua_State' data-ref="lua_State" data-ref-filename="lua_State">lua_State</a> *<dfn class="local col1 decl" id="331L" title='L' data-type='lua_State *' data-ref="331L" data-ref-filename="331L">L</dfn>, <em>int</em> <dfn class="local col2 decl" id="332t" title='t' data-type='int' data-ref="332t" data-ref-filename="332t">t</dfn>, <em>int</em> <dfn class="local col3 decl" id="333ref" title='ref' data-type='int' data-ref="333ref" data-ref-filename="333ref">ref</dfn>)</td></tr>
<tr><th id="299">299</th><td>{</td></tr>
<tr><th id="300">300</th><td>  <b>if</b> (<a class="local col3 ref" href="#333ref" title='ref' data-ref="333ref" data-ref-filename="333ref">ref</a> &gt;= <var>0</var>) {</td></tr>
<tr><th id="301">301</th><td>    <a class="local col2 ref" href="#332t" title='t' data-ref="332t" data-ref-filename="332t">t</a> = <a class="macro" href="#273" title="((t) &gt; 0 || (t) &lt;= (-10000) ? (t) : lua_gettop(L) + (t) + 1)" data-ref="_M/abs_index">abs_index</a>(<a class="local col1 ref" href="#331L" title='L' data-ref="331L" data-ref-filename="331L">L</a>, <a class="local col2 ref" href="#332t" title='t' data-ref="332t" data-ref-filename="332t">t</a>);</td></tr>
<tr><th id="302">302</th><td>    <a class="ref fn" href="lua.h.html#lua_rawgeti" title='lua_rawgeti' data-ref="lua_rawgeti" data-ref-filename="lua_rawgeti">lua_rawgeti</a>(<a class="local col1 ref" href="#331L" title='L' data-ref="331L" data-ref-filename="331L">L</a>, <a class="local col2 ref" href="#332t" title='t' data-ref="332t" data-ref-filename="332t">t</a>, <a class="macro" href="#270" title="0" data-ref="_M/FREELIST_REF">FREELIST_REF</a>);</td></tr>
<tr><th id="303">303</th><td>    <a class="ref fn" href="lua.h.html#lua_rawseti" title='lua_rawseti' data-ref="lua_rawseti" data-ref-filename="lua_rawseti">lua_rawseti</a>(<a class="local col1 ref" href="#331L" title='L' data-ref="331L" data-ref-filename="331L">L</a>, <a class="local col2 ref" href="#332t" title='t' data-ref="332t" data-ref-filename="332t">t</a>, <a class="local col3 ref" href="#333ref" title='ref' data-ref="333ref" data-ref-filename="333ref">ref</a>);  <i>/* t[ref] = t[FREELIST_REF] */</i></td></tr>
<tr><th id="304">304</th><td>    <a class="ref fn" href="lua.h.html#lua_pushinteger" title='lua_pushinteger' data-ref="lua_pushinteger" data-ref-filename="lua_pushinteger">lua_pushinteger</a>(<a class="local col1 ref" href="#331L" title='L' data-ref="331L" data-ref-filename="331L">L</a>, <a class="local col3 ref" href="#333ref" title='ref' data-ref="333ref" data-ref-filename="333ref">ref</a>);</td></tr>
<tr><th id="305">305</th><td>    <a class="ref fn" href="lua.h.html#lua_rawseti" title='lua_rawseti' data-ref="lua_rawseti" data-ref-filename="lua_rawseti">lua_rawseti</a>(<a class="local col1 ref" href="#331L" title='L' data-ref="331L" data-ref-filename="331L">L</a>, <a class="local col2 ref" href="#332t" title='t' data-ref="332t" data-ref-filename="332t">t</a>, <a class="macro" href="#270" title="0" data-ref="_M/FREELIST_REF">FREELIST_REF</a>);  <i>/* t[FREELIST_REF] = ref */</i></td></tr>
<tr><th id="306">306</th><td>  }</td></tr>
<tr><th id="307">307</th><td>}</td></tr>
<tr><th id="308">308</th><td></td></tr>
<tr><th id="309">309</th><td><i  data-doc="panic">/* -- Default allocator and panic function -------------------------------- */</i></td></tr>
<tr><th id="310">310</th><td></td></tr>
<tr><th id="311">311</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="panic" title='panic' data-type='int panic(lua_State * L)' data-ref="panic" data-ref-filename="panic">panic</dfn>(<a class="typedef" href="lua.h.html#lua_State" title='lua_State' data-type='struct lua_State' data-ref="lua_State" data-ref-filename="lua_State">lua_State</a> *<dfn class="local col4 decl" id="334L" title='L' data-type='lua_State *' data-ref="334L" data-ref-filename="334L">L</dfn>)</td></tr>
<tr><th id="312">312</th><td>{</td></tr>
<tr><th id="313">313</th><td>  <em>const</em> <em>char</em> *<dfn class="local col5 decl" id="335s" title='s' data-type='const char *' data-ref="335s" data-ref-filename="335s">s</dfn> = <a class="macro" href="lua.h.html#281" title="lua_tolstring(L, (-1), ((void*)0))" data-ref="_M/lua_tostring">lua_tostring</a>(<a class="local col4 ref" href="#334L" title='L' data-ref="334L" data-ref-filename="334L">L</a>, -<var>1</var>);</td></tr>
<tr><th id="314">314</th><td>  <a class="ref fn" href="../include/stdio.h.html#fputs" title='fputs' data-ref="fputs" data-ref-filename="fputs">fputs</a>(<q>"PANIC: unprotected error in call to Lua API ("</q>, <a class="macro" href="../include/stdio.h.html#141" title="stderr" data-ref="_M/stderr">stderr</a>);</td></tr>
<tr><th id="315">315</th><td>  <a class="ref fn" href="../include/stdio.h.html#fputs" title='fputs' data-ref="fputs" data-ref-filename="fputs">fputs</a>(<a class="local col5 ref" href="#335s" title='s' data-ref="335s" data-ref-filename="335s">s</a> ? <a class="local col5 ref" href="#335s" title='s' data-ref="335s" data-ref-filename="335s">s</a> : <q>"?"</q>, <a class="macro" href="../include/stdio.h.html#141" title="stderr" data-ref="_M/stderr">stderr</a>);</td></tr>
<tr><th id="316">316</th><td>  <a class="ref fn" href="../include/stdio.h.html#fputc" title='fputc' data-ref="fputc" data-ref-filename="fputc">fputc</a>(<kbd>')'</kbd>, <a class="macro" href="../include/stdio.h.html#141" title="stderr" data-ref="_M/stderr">stderr</a>); <a class="ref fn" href="../include/stdio.h.html#fputc" title='fputc' data-ref="fputc" data-ref-filename="fputc">fputc</a>(<kbd>'\n'</kbd>, <a class="macro" href="../include/stdio.h.html#141" title="stderr" data-ref="_M/stderr">stderr</a>);</td></tr>
<tr><th id="317">317</th><td>  <a class="ref fn" href="../include/stdio.h.html#fflush" title='fflush' data-ref="fflush" data-ref-filename="fflush">fflush</a>(<a class="macro" href="../include/stdio.h.html#141" title="stderr" data-ref="_M/stderr">stderr</a>);</td></tr>
<tr><th id="318">318</th><td>  <b>return</b> <var>0</var>;</td></tr>
<tr><th id="319">319</th><td>}</td></tr>
<tr><th id="320">320</th><td></td></tr>
<tr><th id="321">321</th><td><u>#<span data-ppcond="321">ifdef</span> <span class="macro" data-ref="_M/LUAJIT_USE_SYSMALLOC">LUAJIT_USE_SYSMALLOC</span></u></td></tr>
<tr><th id="322">322</th><td></td></tr>
<tr><th id="323">323</th><td><u>#if LJ_64 &amp;&amp; !LJ_GC64 &amp;&amp; !defined(LUAJIT_USE_VALGRIND)</u></td></tr>
<tr><th id="324">324</th><td><u>#error "Must use builtin allocator for 64 bit target"</u></td></tr>
<tr><th id="325">325</th><td><u>#endif</u></td></tr>
<tr><th id="326">326</th><td></td></tr>
<tr><th id="327">327</th><td><em>static</em> <em>void</em> *mem_alloc(<em>void</em> *ud, <em>void</em> *ptr, size_t osize, size_t nsize)</td></tr>
<tr><th id="328">328</th><td>{</td></tr>
<tr><th id="329">329</th><td>  (<em>void</em>)ud;</td></tr>
<tr><th id="330">330</th><td>  (<em>void</em>)osize;</td></tr>
<tr><th id="331">331</th><td>  <b>if</b> (nsize == <var>0</var>) {</td></tr>
<tr><th id="332">332</th><td>    free(ptr);</td></tr>
<tr><th id="333">333</th><td>    <b>return</b> NULL;</td></tr>
<tr><th id="334">334</th><td>  } <b>else</b> {</td></tr>
<tr><th id="335">335</th><td>    <b>return</b> realloc(ptr, nsize);</td></tr>
<tr><th id="336">336</th><td>  }</td></tr>
<tr><th id="337">337</th><td>}</td></tr>
<tr><th id="338">338</th><td></td></tr>
<tr><th id="339">339</th><td>LUALIB_API lua_State *luaL_newstate(<em>void</em>)</td></tr>
<tr><th id="340">340</th><td>{</td></tr>
<tr><th id="341">341</th><td>  lua_State *L = lua_newstate(mem_alloc, NULL);</td></tr>
<tr><th id="342">342</th><td>  <b>if</b> (L) G(L)-&gt;panic = panic;</td></tr>
<tr><th id="343">343</th><td>  <b>return</b> L;</td></tr>
<tr><th id="344">344</th><td>}</td></tr>
<tr><th id="345">345</th><td></td></tr>
<tr><th id="346">346</th><td><u>#<span data-ppcond="321">else</span></u></td></tr>
<tr><th id="347">347</th><td></td></tr>
<tr><th id="348">348</th><td><a class="macro" href="luaconf.h.html#137" title="extern" data-ref="_M/LUALIB_API">LUALIB_API</a> <a class="typedef" href="lua.h.html#lua_State" title='lua_State' data-type='struct lua_State' data-ref="lua_State" data-ref-filename="lua_State">lua_State</a> *<dfn class="decl def fn" id="luaL_newstate" title='luaL_newstate' data-ref="luaL_newstate" data-ref-filename="luaL_newstate">luaL_newstate</dfn>(<em>void</em>)</td></tr>
<tr><th id="349">349</th><td>{</td></tr>
<tr><th id="350">350</th><td>  <a class="typedef" href="lua.h.html#lua_State" title='lua_State' data-type='struct lua_State' data-ref="lua_State" data-ref-filename="lua_State">lua_State</a> *<dfn class="local col6 decl" id="336L" title='L' data-type='lua_State *' data-ref="336L" data-ref-filename="336L">L</dfn>;</td></tr>
<tr><th id="351">351</th><td><u>#<span data-ppcond="351">if</span> <a class="macro" href="lj_arch.h.html#600" title="1" data-ref="_M/LJ_64">LJ_64</a> &amp;&amp; !<a class="macro" href="lj_arch.h.html#526" title="1" data-ref="_M/LJ_GC64">LJ_GC64</a></u></td></tr>
<tr><th id="352">352</th><td>  L = lj_state_newstate(LJ_ALLOCF_INTERNAL, NULL);</td></tr>
<tr><th id="353">353</th><td><u>#<span data-ppcond="351">else</span></u></td></tr>
<tr><th id="354">354</th><td>  <a class="local col6 ref" href="#336L" title='L' data-ref="336L" data-ref-filename="336L">L</a> = <a class="ref fn" href="lua.h.html#lua_newstate" title='lua_newstate' data-ref="lua_newstate" data-ref-filename="lua_newstate">lua_newstate</a>(<a class="macro" href="lj_state.h.html#35" title="((lua_Alloc)(void *)(uintptr_t)(1237&lt;&lt;4))" data-ref="_M/LJ_ALLOCF_INTERNAL">LJ_ALLOCF_INTERNAL</a>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>);</td></tr>
<tr><th id="355">355</th><td><u>#<span data-ppcond="351">endif</span></u></td></tr>
<tr><th id="356">356</th><td>  <b>if</b> (<a class="local col6 ref" href="#336L" title='L' data-ref="336L" data-ref-filename="336L">L</a>) <a class="macro" href="lj_obj.h.html#699" title="(((global_State *)(void *)(L-&gt;glref).ptr64))" data-ref="_M/G">G</a>(<a class="local col6 ref" href="#336L" title='L' data-ref="336L" data-ref-filename="336L">L</a>)-&gt;<a class="ref field" href="lj_obj.h.html#global_State::panic" title='global_State::panic' data-ref="global_State::panic" data-ref-filename="global_State..panic">panic</a> = <a class="tu ref fn" href="#panic" title='panic' data-use='r' data-ref="panic" data-ref-filename="panic">panic</a>;</td></tr>
<tr><th id="357">357</th><td>  <b>return</b> <a class="local col6 ref" href="#336L" title='L' data-ref="336L" data-ref-filename="336L">L</a>;</td></tr>
<tr><th id="358">358</th><td>}</td></tr>
<tr><th id="359">359</th><td></td></tr>
<tr><th id="360">360</th><td><u>#<span data-ppcond="360">if</span> <a class="macro" href="lj_arch.h.html#600" title="1" data-ref="_M/LJ_64">LJ_64</a> &amp;&amp; !<a class="macro" href="lj_arch.h.html#526" title="1" data-ref="_M/LJ_GC64">LJ_GC64</a></u></td></tr>
<tr><th id="361">361</th><td>LUA_API lua_State *lua_newstate(lua_Alloc f, <em>void</em> *ud)</td></tr>
<tr><th id="362">362</th><td>{</td></tr>
<tr><th id="363">363</th><td>  UNUSED(f); UNUSED(ud);</td></tr>
<tr><th id="364">364</th><td>  fputs(<q>"Must use luaL_newstate() for 64 bit target\n"</q>, stderr);</td></tr>
<tr><th id="365">365</th><td>  <b>return</b> NULL;</td></tr>
<tr><th id="366">366</th><td>}</td></tr>
<tr><th id="367">367</th><td><u>#<span data-ppcond="360">endif</span></u></td></tr>
<tr><th id="368">368</th><td></td></tr>
<tr><th id="369">369</th><td><u>#<span data-ppcond="321">endif</span></u></td></tr>
<tr><th id="370">370</th><td></td></tr>
<tr><th id="371">371</th><td></td></tr>
</table><hr/><p id='footer'>
Generated on <em>2022-Jun-23</em> from project luajit revision <em>v2.1.0-beta3-294-ge9577376</em><br />Powered by <a href='https://woboq.com'><img alt='Woboq' src='https://code.woboq.org/woboq-16.png' width='41' height='16' /></a> <a href='https://code.woboq.org'>Code Browser</a> 2.1
<br/>Generator usage only permitted with license.</p>
</div></body></html>
